<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"chengming0916.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="准备工作制作启动盘官方镜像Minimal CD Stage国内加速清华大学开源软件镜像站中国科技大学开源镜像站 使用Rufus制作启动U盘.   连接网络Linux配置网络及SSH配置  分区规划参考 Linux硬盘分区 挂载分区12345678mkdir &#x2F;mnt&#x2F;gentoomount &#x2F;dev&#x2F;sdx? &#x2F;mnt&#x2F;gentoomkdir &#x2F;mnt&#x2F;gentoo&#x2F;homemount &#x2F;dev&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="Gentoo安装">
<meta property="og:url" content="http://chengming0916.github.io/2023/05/23/Linux/Gentoo%E5%AE%89%E8%A3%85/index.html">
<meta property="og:site_name" content="Chemmy&#39;s Blog">
<meta property="og:description" content="准备工作制作启动盘官方镜像Minimal CD Stage国内加速清华大学开源软件镜像站中国科技大学开源镜像站 使用Rufus制作启动U盘.   连接网络Linux配置网络及SSH配置  分区规划参考 Linux硬盘分区 挂载分区12345678mkdir &#x2F;mnt&#x2F;gentoomount &#x2F;dev&#x2F;sdx? &#x2F;mnt&#x2F;gentoomkdir &#x2F;mnt&#x2F;gentoo&#x2F;homemount &#x2F;dev&#x2F;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://chengming0916.github.io/2023/05/23/Linux/Gentoo%E5%AE%89%E8%A3%85/IMG-20241210170128574.png">
<meta property="article:published_time" content="2023-05-22T16:00:00.000Z">
<meta property="article:modified_time" content="2025-09-10T05:11:16.918Z">
<meta property="article:author" content="Chemmy">
<meta property="article:tag" content="Gentoo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://chengming0916.github.io/2023/05/23/Linux/Gentoo%E5%AE%89%E8%A3%85/IMG-20241210170128574.png">


<link rel="canonical" href="http://chengming0916.github.io/2023/05/23/Linux/Gentoo%E5%AE%89%E8%A3%85/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://chengming0916.github.io/2023/05/23/Linux/Gentoo%E5%AE%89%E8%A3%85/","path":"2023/05/23/Linux/Gentoo安装/","title":"Gentoo安装"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Gentoo安装 | Chemmy's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Chemmy's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">chengming0916@outlook.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.</span> <span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E5%90%AF%E5%8A%A8%E7%9B%98"><span class="nav-number">1.1.</span> <span class="nav-text">制作启动盘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E7%BD%91%E7%BB%9C"><span class="nav-number">1.2.</span> <span class="nav-text">连接网络</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E5%8C%BA%E8%A7%84%E5%88%92"><span class="nav-number">1.3.</span> <span class="nav-text">分区规划</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%82%E8%BD%BD%E5%88%86%E5%8C%BA"><span class="nav-number">1.4.</span> <span class="nav-text">挂载分区</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEPortage"><span class="nav-number">2.</span> <span class="nav-text">配置Portage</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8A%E6%94%BEstage"><span class="nav-number">2.1.</span> <span class="nav-text">释放stage</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%82%E8%BD%BD%E7%B3%BB%E7%BB%9F%E5%BF%85%E8%A6%81%E7%8E%AF%E5%A2%83"><span class="nav-number">2.2.</span> <span class="nav-text">挂载系统必要环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6DNS"><span class="nav-number">2.3.</span> <span class="nav-text">复制DNS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%BD%AF%E4%BB%B6%E6%BA%90"><span class="nav-number">2.4.</span> <span class="nav-text">配置软件源</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E6%BA%90"><span class="nav-number">2.4.1.</span> <span class="nav-text">常规源</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%BB%E4%BB%93%E5%BA%93"><span class="nav-number">2.4.2.</span> <span class="nav-text">创建主仓库</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BA%90"><span class="nav-number">2.4.3.</span> <span class="nav-text">二进制源</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90fstab"><span class="nav-number">2.5.</span> <span class="nav-text">生成fstab</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">系统配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9B%E5%85%A5%E6%96%B0%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83"><span class="nav-number">3.1.</span> <span class="nav-text">进入新系统环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5stage"><span class="nav-number">3.2.</span> <span class="nav-text">同步stage</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEprofile"><span class="nav-number">3.3.</span> <span class="nav-text">设置profile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A3%80%E6%B5%8Bcpu%E6%8C%87%E4%BB%A4%E9%9B%86"><span class="nav-number">3.4.</span> <span class="nav-text">检测cpu指令集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85CCache-%E5%8F%AF%E9%80%89%EF%BC%8C%E5%8A%A0%E9%80%9F%E7%BC%96%E8%AF%91"><span class="nav-number">3.5.</span> <span class="nav-text">安装CCache(可选，加速编译)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85Aria2-%E5%8F%AF%E9%80%89%EF%BC%8C%E5%8A%A0%E5%BF%AB%E5%8C%85%E4%B8%8B%E8%BD%BD"><span class="nav-number">3.6.</span> <span class="nav-text">安装Aria2(可选，加快包下载)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91%E9%80%89%E9%A1%B9"><span class="nav-number">3.7.</span> <span class="nav-text">配置编译选项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B0%B8%E4%B9%85%E7%A6%81%E7%94%A8nouveau%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9D%97"><span class="nav-number">3.8.</span> <span class="nav-text">永久禁用nouveau驱动模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E6%A0%B8%E9%85%8D%E7%BD%AE%E5%92%8C%E7%BC%96%E8%AF%91"><span class="nav-number">3.9.</span> <span class="nav-text">内核配置和编译</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">4.</span> <span class="nav-text">系统环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="nav-number">4.1.</span> <span class="nav-text">配置主机名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8C%BA"><span class="nav-number">4.2.</span> <span class="nav-text">配置系统时区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BC%96%E7%A0%81"><span class="nav-number">4.3.</span> <span class="nav-text">配置编码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%B3%BB%E7%BB%9Flocale"><span class="nav-number">4.4.</span> <span class="nav-text">设置系统locale</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEsudo%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="nav-number">4.5.</span> <span class="nav-text">配置sudo自动补全</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7"><span class="nav-number">4.6.</span> <span class="nav-text">安装网络工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%BF%85%E8%A6%81%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="nav-number">4.7.</span> <span class="nav-text">安装必要的工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7"><span class="nav-number">4.8.</span> <span class="nav-text">配置系统用户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E9%A1%B9"><span class="nav-number">4.9.</span> <span class="nav-text">添加操作系统启动项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B8%85%E7%90%86"><span class="nav-number">4.10.</span> <span class="nav-text">清理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%8C%E9%9D%A2%E7%8E%AF%E5%A2%83"><span class="nav-number">5.</span> <span class="nav-text">桌面环境</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83"><span class="nav-number">5.1.</span> <span class="nav-text">安装基础环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LightDM"><span class="nav-number">5.2.</span> <span class="nav-text">LightDM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KDE"><span class="nav-number">5.3.</span> <span class="nav-text">KDE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Awesome"><span class="nav-number">5.4.</span> <span class="nav-text">Awesome</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mate"><span class="nav-number">5.5.</span> <span class="nav-text">Mate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Xfce"><span class="nav-number">5.6.</span> <span class="nav-text">Xfce</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9F%B3%E9%A2%91%E6%8E%A7%E5%88%B6"><span class="nav-number">5.7.</span> <span class="nav-text">音频控制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93"><span class="nav-number">5.8.</span> <span class="nav-text">中文字体</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%B3%95"><span class="nav-number">5.9.</span> <span class="nav-text">输入法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">6.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#USE%E5%8F%98%E9%87%8F%E8%AF%B4%E6%98%8E-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="nav-number">7.</span> <span class="nav-text">USE变量说明 官方文档</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Chemmy"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Chemmy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">192</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">178</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/chengming0916" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chengming0916" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/chengming0916@outlook.com" title="E-Mail → chengming0916@outlook.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2023/05/23/Linux/Gentoo%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Gentoo安装 | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Gentoo安装
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-23 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-23T00:00:00+08:00">2023-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-10 13:11:16" itemprop="dateModified" datetime="2025-09-10T13:11:16+08:00">2025-09-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="制作启动盘"><a href="#制作启动盘" class="headerlink" title="制作启动盘"></a>制作启动盘</h4><p>官方镜像<br><a target="_blank" rel="noopener" href="https://distfiles.gentoo.org/releases/amd64/autobuilds/20241208T163323Z/install-amd64-minimal-20241208T163323Z.iso">Minimal CD</a> <a target="_blank" rel="noopener" href="https://distfiles.gentoo.org/releases/amd64/autobuilds/20241208T163323Z/stage3-amd64-openrc-20241208T163323Z.tar.xz">Stage</a><br>国内加速<br><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/gentoo/releases/amd64/autobuilds/">清华大学开源软件镜像站</a><br><a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/gentoo/releases/amd64/autobuilds/">中国科技大学开源镜像站</a></p>
<p>使用Rufus制作启动U盘.</p>
<img src="/2023/05/23/Linux/Gentoo%E5%AE%89%E8%A3%85/IMG-20241210170128574.png" class="" title="image-20240829112011985">

<h4 id="连接网络"><a href="#连接网络" class="headerlink" title="连接网络"></a>连接网络</h4><a href="/2018/05/24/Linux/Linux%E9%85%8D%E7%BD%AE%E7%BD%91%E7%BB%9C%E5%8F%8ASSH%E9%85%8D%E7%BD%AE/" title="Linux配置网络及SSH配置">Linux配置网络及SSH配置</a>

<h4 id="分区规划"><a href="#分区规划" class="headerlink" title="分区规划"></a>分区规划</h4><p>参考 <a href="/2018/03/22/Linux/Linux%E7%A1%AC%E7%9B%98%E5%88%86%E5%8C%BA/" title="Linux硬盘分区">Linux硬盘分区</a></p>
<h4 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /mnt/gentoo</span><br><span class="line">mount /dev/sdx? /mnt/gentoo</span><br><span class="line"><span class="built_in">mkdir</span> /mnt/gentoo/home</span><br><span class="line">mount /dev/sdx? /mnt/gentoo/home</span><br><span class="line"><span class="built_in">mkdir</span> /mnt/gentoo/boot</span><br><span class="line">mount /dev/sdx? /mnt/gentoo/boot</span><br><span class="line"><span class="built_in">mkdir</span> /mnt/gentoo/boot/efi</span><br><span class="line">mount /dev/sdx? /mnt/gentoo/boot/efi</span><br></pre></td></tr></table></figure>

<h3 id="配置Portage"><a href="#配置Portage" class="headerlink" title="配置Portage"></a>配置Portage</h3><h4 id="释放stage"><a href="#释放stage" class="headerlink" title="释放stage"></a>释放stage</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用命令行浏览器下载stage</span></span><br><span class="line">links http://www.gentoo.org/main/en/mirrors.xml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送stage3</span></span><br><span class="line">scp stage3-amd64-*.tar.xz root@192.168.0.2:/mnt/gentoo</span><br><span class="line"><span class="built_in">cd</span> /mnt/gentoo</span><br><span class="line"><span class="comment"># 释放stage3</span></span><br><span class="line">tar xpvf stage3-*.tar.bz2 --xattrs-include=<span class="string">&#x27;*.*&#x27;</span> --numeric-owner</span><br></pre></td></tr></table></figure>

<h4 id="挂载系统必要环境"><a href="#挂载系统必要环境" class="headerlink" title="挂载系统必要环境"></a>挂载系统必要环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mount --types proc /proc /mnt/gentoo/proc</span><br><span class="line">mount --rbind /sys /mnt/gentoo/sys</span><br><span class="line"><span class="comment">#mount --make-rslave /mnt/gentoo/sys (不使用systemd，所以注释掉)</span></span><br><span class="line">mount --rbind /dev /mnt/gentoo/dev</span><br><span class="line"><span class="comment">#mount --make-rslave /mnt/gentoo/dev (不使用systemd，所以注释掉)</span></span><br><span class="line">mount --rbind /run /mnt/gentoo/run</span><br><span class="line"><span class="comment">#mount --make-slave /mnt/gentoo/run (不使用systemd，所以注释掉)</span></span><br></pre></td></tr></table></figure>

<h4 id="复制DNS"><a href="#复制DNS" class="headerlink" title="复制DNS"></a>复制DNS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> --dereference /etc/resolv.conf /mnt/gentoo/etc/</span><br></pre></td></tr></table></figure>

<h4 id="配置软件源"><a href="#配置软件源" class="headerlink" title="配置软件源"></a>配置软件源</h4><h5 id="常规源"><a href="#常规源" class="headerlink" title="常规源"></a>常规源</h5><p>选择中国源，这一步是非必须的，提供的<code>/etc/portage/make.conf</code>里已经有中国的所有源了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/portage/make.conf   </span><br></pre></td></tr></table></figure>
<h5 id="创建主仓库"><a href="#创建主仓库" class="headerlink" title="创建主仓库"></a>创建主仓库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p -v /mnt/gentoo/etc/portage/repos.conf</span><br><span class="line"></span><br><span class="line">cp -v /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf</span><br><span class="line"></span><br><span class="line"># 加入中国源</span><br><span class="line">nano -w /mnt/gentoo/etc/portage/repos.conf/gentoo.conf：    </span><br><span class="line"></span><br><span class="line">## 源地址</span><br><span class="line">sync-uri = rsync://mirrors.tuna.tsinghua.edu.cn/gentoo-portage/</span><br><span class="line">#sync-uri = rsync://rsync.mirrors.ustc.edu.cn/gentoo-portage/</span><br><span class="line">#sync-uri = rsync://mirrors.yun-idc.com/gentoo-portage/</span><br></pre></td></tr></table></figure>

<h5 id="二进制源"><a href="#二进制源" class="headerlink" title="二进制源"></a>二进制源</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改二进制源地址为国内源</span></span><br><span class="line">nano -w /etc/portage/binrepos.conf/gentoobinhost.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原有内容</span></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line"><span class="comment"># These settings were set by the catalyst build script that automatically</span></span><br><span class="line"><span class="comment"># built this stage.</span></span><br><span class="line"><span class="comment"># Please consider using a local mirror.</span></span><br><span class="line"></span><br><span class="line">[gentoobinhost]</span><br><span class="line">priority = 1</span><br><span class="line"><span class="comment"># sync-uri = https://distfiles.gentoo.org/releases/amd64/binpackages/23.0/x86-64</span></span><br><span class="line">sync-uri = https://mirrors.tuna.tsinghua.edu.cn/gentoo/releases/amd64/binpackages/23.0/x86-64/</span><br><span class="line"><span class="comment"># sync-uri = https://mirrors.ustc.edu.cn/gentoo/releases/amd64/binpackages/23.0/x86-64/</span></span><br></pre></td></tr></table></figure>

<p>如果启用二进制源需要在<code>USE</code>中添加 <code>getbinpkg binpkg-request-signature </code></p>
<h4 id="生成fstab"><a href="#生成fstab" class="headerlink" title="生成fstab"></a>生成fstab</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genfstab -U /mnt/gentoo &gt;&gt; /mnt/gentoo/etc/fstab</span><br></pre></td></tr></table></figure>

<p>生成的fstab格式如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UUID=......      /boot/efi      vfat      noauto,defaults,noatime,<span class="built_in">umask</span>=0077                               0 2</span><br><span class="line">UUID=......      /              xfs       defaults,noatime                                                 0 1</span><br><span class="line">UUID=......      /home          xfs       noatime,discard    </span><br></pre></td></tr></table></figure>

<h3 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h3><h4 id="进入新系统环境"><a href="#进入新系统环境" class="headerlink" title="进入新系统环境"></a>进入新系统环境</h4><p><strong>从现在开始，所有的动作将立即在新 Gentoo Linux 环境里生效。</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chroot</span> /mnt/gentoo /bin/bash</span><br><span class="line">env-update						</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">export</span> PS1=<span class="string">&quot;(chroot) <span class="variable">$&#123;PS1&#125;</span>&quot;</span> <span class="comment"># 切换提示符，避免混淆</span></span><br></pre></td></tr></table></figure>

<h4 id="同步stage"><a href="#同步stage" class="headerlink" title="同步stage"></a>同步stage</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge-webrsync</span><br></pre></td></tr></table></figure>

<p><a href="**%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%B8%8D%E8%83%BD%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9fstab%E5%8E%BB%E6%8E%89%E9%87%8D%E5%A4%8D%E7%9A%84%E9%A1%B9%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%E5%BC%82%E5%B8%B8%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8**">^注意</a>: gentoo handbook上提到可以使用emerge -rsync升级软件包数据库到最近2小时的最新版，这是没有必要的，而且下载的速度会极其慢，所以不推荐这样做。单用emerge-webrsync就可以同步数据库到最近3～4天内的最新版了。</p>
<h4 id="设置profile"><a href="#设置profile" class="headerlink" title="设置profile"></a>设置profile</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eselect profile list     <span class="comment">#查看profile予设值</span></span><br><span class="line">eselect profile <span class="built_in">set</span> X    <span class="comment">#这里先保持选择默认值，即“default/linux/amd64/17.1 (stable)”</span></span><br></pre></td></tr></table></figure>

<h4 id="检测cpu指令集"><a href="#检测cpu指令集" class="headerlink" title="检测cpu指令集"></a>检测cpu指令集</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装cpuid2cpuflags</span></span><br><span class="line">emerge --ask app-portage/cpuid2cpuflags</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看CPU指令集</span></span><br><span class="line">cpuid2cpuflags   </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;*/* <span class="subst">$(cpuid2cpuflags)</span>&quot;</span> &gt; /etc/portage/package.use/00cpu-flags</span><br></pre></td></tr></table></figure>

<h4 id="安装CCache-可选，加速编译"><a href="#安装CCache-可选，加速编译" class="headerlink" title="安装CCache(可选，加速编译)"></a>安装CCache(可选，加速编译)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask ccache </span><br><span class="line"><span class="built_in">mkdir</span> -p /var/cache/ccache</span><br><span class="line"><span class="built_in">chown</span> root:portage /var/cache/ccache -R</span><br><span class="line"><span class="built_in">chmod</span> 2775 /var/cache/ccache -R</span><br></pre></td></tr></table></figure>

<p>在portage&#x2F;make.conf中添加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FEATURES=<span class="string">&quot;ccache -test&quot;</span> </span><br><span class="line">CCACHE_DIR=<span class="string">&quot;/var/cache/ccache&quot;</span></span><br><span class="line"></span><br><span class="line">USE=<span class="string">&quot;... <span class="variable">$&#123;FEATURES&#125;</span>&quot;</span> <span class="comment"># 在USE中添加$&#123;FEATURES&#125; </span></span><br></pre></td></tr></table></figure>

<h4 id="安装Aria2-可选，加快包下载"><a href="#安装Aria2-可选，加快包下载" class="headerlink" title="安装Aria2(可选，加快包下载)"></a>安装Aria2(可选，加快包下载)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask net-misc/aria2</span><br></pre></td></tr></table></figure>

<p>在portage&#x2F;make.conf中添加配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DISTDIR=&quot;/var/cache/distfiles&quot;</span><br><span class="line">FETCHCOMMAND=&quot;/usr/bin/aria2c -d \$&#123;DISTDIR&#125; -o \$&#123;FILE&#125; \</span><br><span class="line">    --allow-overwrite=true --max-tries=5 --max-file-not-found=2 \</span><br><span class="line">    --max-concurrent-downloads=5 --connect-timeout=5 --timeout=5 \</span><br><span class="line">    --split=5 --min-split-size=2M --lowest-speed-limit=20K \</span><br><span class="line">    --max-connection-per-server=9 --uri-selector=feedback \$&#123;URI&#125;&quot;</span><br><span class="line">RESUMECOMMAND=&quot;$&#123;FETCHCOMMAND&#125;&quot;</span><br></pre></td></tr></table></figure>

<h4 id="配置编译选项"><a href="#配置编译选项" class="headerlink" title="配置编译选项"></a>配置编译选项</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /mnt/gentoo/etc/portage/make.conf</span><br></pre></td></tr></table></figure>

<p><a href="**%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%B8%8D%E8%83%BD%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9fstab%E5%8E%BB%E6%8E%89%E9%87%8D%E5%A4%8D%E7%9A%84%E9%A1%B9%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%E5%BC%82%E5%B8%B8%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8**">^注意</a>: 设置编译标志 -march&#x3D;native (如果你知道自己处理器的代号，就用自己的处理器代号替换这里的native 比如我的是skylake，如果不确定就使用native)<br><a href="**%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%B8%8D%E8%83%BD%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9fstab%E5%8E%BB%E6%8E%89%E9%87%8D%E5%A4%8D%E7%9A%84%E9%A1%B9%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%E5%BC%82%E5%B8%B8%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8**">^注意</a>: 设置 <strong>MAKEOPTS&#x3D;”-j8”</strong> 来定义安装软件时并行编译的数量 这个数字等于你的CPU线程数（也称为逻辑CPU数）参考<a href="https://link.zhihu.com/?target=https://wiki.gentoo.org/wiki/MAKEOPTS">MAKEOPTS WiKi</a></p>
<p>完整的配置文件如下(转自<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/122222365">Gentoo安装流程分享(step by step)，第一篇之基本系统的安装</a>，修改了下注释格式，删除不用的部分)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># These settings were set by the catalyst build script that automatically</span></span><br><span class="line"><span class="comment"># built this stage.</span></span><br><span class="line"><span class="comment"># Please consult /usr/share/portage/config/make.conf.example for a more</span></span><br><span class="line"><span class="comment"># detailed example.</span></span><br><span class="line"><span class="comment"># GCC编译配置 -O3代表优化级别,如果采用更高的-Ofast可能会导致部分软件包编译错误, </span></span><br><span class="line"><span class="comment"># -march=native代表为本机cpu进行编译,如果是交叉编译需要去掉</span></span><br><span class="line">COMMON_FLAGS=<span class="string">&quot;-march=skylake -O2 -pipe&quot;</span></span><br><span class="line">CFLAGS=<span class="string">&quot;<span class="variable">$&#123;COMMON_FLAGS&#125;</span>&quot;</span></span><br><span class="line">CXXFLAGS=<span class="string">&quot;<span class="variable">$&#123;COMMON_FLAGS&#125;</span>&quot;</span></span><br><span class="line">FCFLAGS=<span class="string">&quot;<span class="variable">$&#123;COMMON_FLAGS&#125;</span>&quot;</span></span><br><span class="line">FFLAGS=<span class="string">&quot;<span class="variable">$&#123;COMMON_FLAGS&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 源代码包构建时传递给`make`的参数</span></span><br><span class="line"><span class="comment"># 同时编译的线程数,根据cpu线程数和内存大小/2中较小的</span></span><br><span class="line">MAKEOPTS=<span class="string">&quot;-j8&quot;</span>                </span><br><span class="line"></span><br><span class="line"><span class="comment"># 系统上托管的主软件包存储库,其默认值为 `/var/db/repos/gentoo`</span></span><br><span class="line">PORTDIR=<span class="string">&quot;/var/db/repos/gentoo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Portage存储下载的源代码归档的位置，默认为新安装的`/var/cache/distfiles`</span></span><br><span class="line">DISTDIR=<span class="string">&quot;/var/cache/distfiles&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Portage临时文件的位置，默认为`/var/tmp`</span></span><br><span class="line"><span class="comment"># 如果内存足够大(8G、16G)，那么建议把编译程序时存放临时中间文件的目录设置</span></span><br><span class="line"><span class="comment"># 为内存的tmpfs(/tmp目录)，以减少编译时对硬盘的大量读写、延长硬盘使用寿命、</span></span><br><span class="line"><span class="comment"># 并加快编译速度；但如果你的内存较小(&lt;=4G)，那么建议把此项注释掉，否则很多</span></span><br><span class="line"><span class="comment"># 程序会因内存容量不足而导致编译失败</span></span><br><span class="line">PORTAGE_TMPDIR=<span class="string">&quot;/tmp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># NOTE: This stage was built with the bindist Use flag enabled</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This sets the language of build output to English.</span></span><br><span class="line"><span class="comment"># Please keep this setting intact when reporting bugs.</span></span><br><span class="line">LC_MESSAGES=C</span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步镜像</span></span><br><span class="line">GENTOO_MIRRORS=<span class="string">&quot;https://mirrors.tuna.tsinghua.edu.cn/gentoo&quot;</span></span><br><span class="line"><span class="comment"># 备选</span></span><br><span class="line"><span class="comment"># GENTOO_MIRRORS=&quot;https://mirrors.ustc.edu.cn/gentoo/&quot;</span></span><br><span class="line"><span class="comment"># GENTOO_MIRRORS=&quot;https://mirrors.aliyun.com/gentoo/&quot;</span></span><br><span class="line"><span class="comment"># GENTOO_MIRRORS=&quot;https://mirrors.cloud.tencent.com/gentoo/&quot;</span></span><br><span class="line"><span class="comment"># GENTOO_MIRRORS=&quot;https://mirrors.huaweicloud.com/gentoo/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># emerge的默认选项</span></span><br><span class="line">EMERGE_DEFAULT_OPTS=<span class="string">&quot;--keep-going --with-bdeps=y --quiet --ask --verbose&quot;</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 每次安装完包之后自动清理</span></span><br><span class="line">AUTO_CLEAN=<span class="string">&quot;yes&quot;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定软件包的可用性和稳定性级别。</span></span><br><span class="line"><span class="comment"># 如果更喜欢最新那这里用~amd64(接受安装和更新处于测试阶段的软件包)</span></span><br><span class="line">ACCEPT_KEYWORDS=<span class="string">&quot;amd64&quot;</span>           </span><br><span class="line"><span class="comment"># 接受所有许可证的软件</span></span><br><span class="line">ACCEPT_LICENSE=<span class="string">&quot;*&quot;</span>                </span><br><span class="line"></span><br><span class="line"><span class="comment"># 语言设置</span></span><br><span class="line">L10N=<span class="string">&quot;en-US zh-CN en zh&quot;</span> </span><br><span class="line">LINGUAS=<span class="string">&quot;en_US zh_CN en zh&quot;</span>          </span><br><span class="line"></span><br><span class="line"><span class="comment"># intel集成显卡和nvidia显卡(不使用novueau)</span></span><br><span class="line">VIDEO_CARDS=<span class="string">&quot;intel i965 iris nvidia&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># intel声卡</span></span><br><span class="line">ALSA_CARDS=<span class="string">&quot;hda_intel&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入设备 非笔记本去除后面的synaptics</span></span><br><span class="line">INPUT_DEVICES=<span class="string">&quot;libinput synaptics&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置GRUB版本</span></span><br><span class="line">GRUB_PLATFORMS=<span class="string">&quot;efi-64&quot;</span>            </span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用ccache来大大提高重新编译时的速度,安装ccache后解除注释</span></span><br><span class="line"><span class="comment"># CCACHE=&quot;parallel-fetch ccache&quot;  </span></span><br><span class="line"><span class="comment"># ccache使用的目录</span></span><br><span class="line"><span class="comment"># CCACHE_DIR=&quot;/var/cache/ccache&quot;     </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用aria2提高下载速度（不设置也无大碍，设置的话一定要注意指令拼写正确）,</span></span><br><span class="line"><span class="comment"># 安装aria2后解除注释</span></span><br><span class="line"><span class="comment"># FETCHCOMMAND=&quot;/usr/bin/aria2c -d \$&#123;DISTDIR&#125; -o \$&#123;FILE&#125; \</span></span><br><span class="line"><span class="comment">#   --allow-overwrite=true --max-tries=5 --max-file-not-found=2 \</span></span><br><span class="line"><span class="comment">#	--max-concurrent-downloads=5 --connect-timeout=5  --timeout=5 \</span></span><br><span class="line"><span class="comment">#	--split=5 --min-split-size=2M --lowest-speed-limit=20K \</span></span><br><span class="line"><span class="comment">#	--max-connection-per-server=9 --uri-selector=feedback \$&#123;URI&#125;&quot;</span></span><br><span class="line"><span class="comment"># RESUMECOMMAND=&quot;$&#123;FETCHCOMMAND&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># USE变量</span></span><br><span class="line"><span class="comment"># 用户希望在系统中启用的Portage特性列表,影响Portage的行为。</span></span><br><span class="line"><span class="comment"># 由于这是一个增量变量，可以在不直接覆盖通过 Gentoo profile</span></span><br><span class="line"><span class="comment"># 实现的FEATURES值的情况下添加FEATURES值。</span></span><br><span class="line">FEATURES=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gnome和kde及其相关组件</span></span><br><span class="line">DESK_ENV=<span class="string">&quot;-gnome -gnome-shell -gnome-keyring -nautilus -kde icu&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不使用systemd plymouth consolekit 只使用elogind</span></span><br><span class="line"><span class="comment"># 旧教程会使用consolekit，elogind是consolekit未来的替代品</span></span><br><span class="line">FUCKSV=<span class="string">&quot;-systemd -bindist -mdev elogind -oss -grub -plymouth -consolekit&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于音频相关软件使用pulseaudio alsa jack特性</span></span><br><span class="line">AUDIO=<span class="string">&quot;alsa jack pulseaudio&quot;</span></span><br><span class="line"></span><br><span class="line">SOFTWARE=<span class="string">&quot;sudo client git openmp minizip udev blkid efi hwdb smack \</span></span><br><span class="line"><span class="string">    acpi ccache dbus policykit udisks cjk emoji -test&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 网络相关</span></span><br><span class="line">NET=<span class="string">&quot;network networkmanager connection-sharing wifi http2 dhclient \</span></span><br><span class="line"><span class="string">    -dhcpcd policykit nftables&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 图形相关</span></span><br><span class="line">VIDEO=<span class="string">&quot;X vulkan layers glamor nvidia gallium&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义需要的USE变量</span></span><br><span class="line">USE=<span class="string">&quot;<span class="variable">$&#123;DESK_ENV&#125;</span> <span class="variable">$&#123;FUCKSV&#125;</span> <span class="variable">$&#123;AUDIO&#125;</span> <span class="variable">$&#123;NET&#125;</span> <span class="variable">$&#123;VIDEO&#125;</span> <span class="variable">$&#123;SOFTWARE&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二进制包保存路径</span></span><br><span class="line"><span class="comment"># PKGDIR=&quot;/var/cache/binpkgs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用二进制软件包,加入USE生效</span></span><br><span class="line"><span class="comment"># BIN_PKG=&quot;getbinpkg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># emerge时用到的代理 需要代理时候自行设置</span></span><br><span class="line"><span class="comment"># http_proxy=&quot;http://127.0.0.1:8889&quot; </span></span><br><span class="line"><span class="comment"># https_proxy=&quot;http://127.0.0.1:8889&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="永久禁用nouveau驱动模块"><a href="#永久禁用nouveau驱动模块" class="headerlink" title="永久禁用nouveau驱动模块"></a>永久禁用nouveau驱动模块</h4><p><strong>强烈要求你禁用Nouveau驱动！！能省掉以后很多莫名其妙的麻烦！</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/modprobe.d/</span><br><span class="line">nano -w /etc/modprobe.d/blacklist.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入以下内容</span></span><br><span class="line">blacklist nouveau</span><br><span class="line">blacklist lbm-nouveau</span><br><span class="line">options nouveau modeset=0</span><br></pre></td></tr></table></figure>

<p>即便在编译内核前就已经设置内核禁用Nouveau驱动了，但是内核安装时还是会默认把nouveau驱动作为内核模块自动加载。启用了nouveau驱动模块的内核会出现各式各样的莫名其妙的数不清的问题，所以为了避免以后出现这些问题，必须禁用nouveau模块。</p>
<h4 id="内核配置和编译"><a href="#内核配置和编译" class="headerlink" title="内核配置和编译"></a>内核配置和编译</h4><p>安装内核源码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask sys-kernel/gentoo-sources</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果安装多个版本内核时执行</span></span><br><span class="line">eselect kernel list 	<span class="comment"># 查看内核列表</span></span><br><span class="line">eselect kernel <span class="built_in">set</span> 1 	<span class="comment"># 选择内核版本</span></span><br></pre></td></tr></table></figure>

<p>某些驱动程序在工作之前需要在系统上安装其他固件。这通常是网络接口的情况，尤其是无线网络接口。此外，在使用开源驱动程序时，来自AMD，Nvidia和Intel等供应商的现代视频芯片通常需要外部固件文件。大多数固件都封装在<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://packages.gentoo.org/packages/sys-kernel/linux-firmware">sys-kernel &#x2F; linux-firmware</a>中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask --quiet sys-kernel/linux-firmware</span><br></pre></td></tr></table></figure>

<p>除了独立显卡硬件和网络接口之外，CPU 可能也需要固件更新。通常这种固件被称为<em>微码（microcode）</em>。有时需要更新版本的微码来修补 CPU 硬件中的不稳定性、安全问题或其他复杂的错误。</p>
<p>AMD CPU 的微码更新在前面提到的 <a target="_blank" rel="noopener" href="https://packages.gentoo.org/packages/sys-kernel/linux-firmware">sys-kernel&#x2F;linux-firmware</a> 软件包内分发。Intel CPU 的微码可以在 <a target="_blank" rel="noopener" href="https://packages.gentoo.org/packages/sys-firmware/intel-microcode">sys-firmware&#x2F;intel-microcode</a> 包中找到，并且需要单独安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Intel CPU 执行</span></span><br><span class="line">emerge --ask sys-firmware/intel-microcode</span><br></pre></td></tr></table></figure>


<p>三种方法安装内核</p>
<p><strong>安装系统时可选择安装二进制内核，系统安装完后再配置编译内核，参考 <a target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel/zh-cn">配置Linux内核 - Gentoo Wiki</a></strong></p>
<ol>
<li><p>全自动安装</p>
<p>当为基于 amd64 的系统安装和编译内核时，Gentoo 推荐使用 <a target="_blank" rel="noopener" href="https://packages.gentoo.org/packages/sys-kernel/gentoo-sources">sys-kernel&#x2F;gentoo-sources</a> 软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask sys-kernel/installkernel</span><br></pre></td></tr></table></figure>
</li>
<li><p>混合安装(推荐方式)</p>
<p>生成内核配置文件</p>
<p>将genkernel的默认内核配置文件“generated-config”复制过来，里面已经设置好了绝大部分应用场景以及绝大部分硬件驱动的配置，非常方便，值得借过来使用，只需要在自己手动配置内核的时候将其加载，在其基础上做一点点轻微的修改或完全不修改都可以，对内核新手极其友好！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask sys-kernel/genkernel</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以genkernel的配置文件为基础进行自定义配置</span></span><br><span class="line"><span class="built_in">cp</span> /usr/share/genkernel/arch/x86_64/generated-config /usr/src/linux/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份</span></span><br><span class="line"><span class="built_in">cp</span> /usr/src/linux/generated-config /usr/src/linux/generated-config.bak </span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line">genkernel --mountboot --install all</span><br></pre></td></tr></table></figure>

<p><a href="**%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%B8%8D%E8%83%BD%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9fstab%E5%8E%BB%E6%8E%89%E9%87%8D%E5%A4%8D%E7%9A%84%E9%A1%B9%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%E5%BC%82%E5%B8%B8%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8**">^注意</a>如果想在以后支持jack低延迟实时音频组件（Jack-Audio-Connection-Kit），则需要vim generated-config，手动设置“CONFIG_CGROUPS&#x3D;y”、“CONFIG_CGROUP_SCHED&#x3D;y”、“CONFIG_RT_GROUP_SCHED&#x3D;y”，然后重新make menuconfig载入保存generated-config一遍，接下来再编译内核。<br><a href="**%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%B8%8D%E8%83%BD%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9fstab%E5%8E%BB%E6%8E%89%E9%87%8D%E5%A4%8D%E7%9A%84%E9%A1%B9%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%E5%BC%82%E5%B8%B8%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8**">^注意</a>: 使用nvidia显卡闭源驱动，需要将内核配置中“CONFIG_I2C_NVIDIA_GPU”这一项禁用，否则会和官方nvidia-drivers冲突！！！
</p>
</li>
<li><p>全手动安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">emerge sys-apps/pciutils</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/src/linux</span><br><span class="line"><span class="comment"># 配置内核</span></span><br><span class="line">make menuconfig </span><br></pre></td></tr></table></figure></li>
</ol>
<p>![[Gentoo安装&#x2F;IMG-20241210170128644.png]]<br>有些内核选项是必须的，必须编译到内核中，而不是作为模块加载。<code>*</code>表示包括到内核中，<code>M</code>表示作为模块加载，<code>[]</code>只有包括到内核中和排除在外两种选项，<code>&lt;&gt;</code>则有包括到内核中、排除在外和以模块加载三种选项。下面这些选项都必须以<code>*</code>方式编译到内核中。</p>
<p>devtmpfs支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Device Drivers ---&gt;</span><br><span class="line">  Generic Driver Options ---&gt;</span><br><span class="line">    [*] Maintain a devtmpfs filesystem to mount at /dev</span><br><span class="line">    [*]   Automount devtmpfs at /dev, after the kernel mounted the rootfs</span><br></pre></td></tr></table></figure>

<p>SCSI磁盘支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Device Drivers ---&gt;</span><br><span class="line">   SCSI device support  ---&gt;</span><br><span class="line">      &lt;*&gt; SCSI disk support</span><br></pre></td></tr></table></figure>
<p>选择支持的文件系统。<strong>因为ESP分区用的FAT32格式化的，根目录用的XFS格式化的，所以这里这两项（FAT32也就是VFAT）必须包括到内核中，虚拟内存和proc文件系统也是必选的</strong>。其实这里还可以取消掉不需要的文件系统，但是对于新手不建议取消任何自己不明白的东西，很容易弄的最后内核没办法启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">File systems ---&gt;</span><br><span class="line">  &lt; &gt; Second extended fs support</span><br><span class="line">  &lt; &gt; The Extended 3 (ext3) filesystem</span><br><span class="line">  &lt;*&gt; The Extended 4 (ext4) filesystem</span><br><span class="line">  &lt; &gt; Reiserfs support</span><br><span class="line">  &lt; &gt; JFS filesystem support</span><br><span class="line">  &lt; &gt; XFS filesystem support</span><br><span class="line">  &lt; &gt; Btrfs filesystem support</span><br><span class="line">  DOS/FAT/NT Filesystems  ---&gt;</span><br><span class="line">    &lt;*&gt; MSDOS fs support</span><br><span class="line">    &lt;*&gt; VFAT (Windows-95) fs support</span><br><span class="line"> </span><br><span class="line">Pseudo Filesystems ---&gt;</span><br><span class="line">    [*] /proc file system support</span><br><span class="line">    [*] Tmpfs virtual memory file system support (former shm fs)</span><br></pre></td></tr></table></figure>
<p>如果处理器是多核的，还需要开启SMP（对称多处理器支持）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Processor type and features  ---&gt;</span><br><span class="line">  [*] Symmetric multi-processing support</span><br></pre></td></tr></table></figure>
<p>USB也必须启用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Device Drivers ---&gt;</span><br><span class="line">  HID support  ---&gt;</span><br><span class="line">    -*- HID bus support</span><br><span class="line">    &lt;*&gt;   Generic HID driver</span><br><span class="line">    [*]   Battery level reporting for HID devices</span><br><span class="line">      USB HID support  ---&gt;</span><br><span class="line">        &lt;*&gt; USB HID transport layer</span><br><span class="line">  [*] USB support  ---&gt;</span><br><span class="line">    &lt;*&gt;     xHCI HCD (USB 3.0) support</span><br><span class="line">    &lt;*&gt;     EHCI HCD (USB 2.0) support</span><br><span class="line">    &lt;*&gt;     OHCI HCD (USB 1.1) support</span><br></pre></td></tr></table></figure>

<p><strong>系统体系相关的内核配置</strong></p>
<p>因为选择了multlib，所以32和64位的程序都会安装。为了支持32位程序，必须启用32位程序模拟功能。这里其实倒是不用怎么改，默认已经都选上了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Processor type and features  ---&gt;</span><br><span class="line">   [*] Machine Check / overheating reporting </span><br><span class="line">   [*]   Intel MCE Features</span><br><span class="line">   [*]   AMD MCE Features</span><br><span class="line">   Processor family (AMD-Opteron/Athlon64)  ---&gt;</span><br><span class="line">      ( ) Opteron/Athlon64/Hammer/K8</span><br><span class="line">      ( ) Intel P4 / older Netburst based Xeon</span><br><span class="line">      ( ) Core 2/newer Xeon</span><br><span class="line">      ( ) Intel Atom</span><br><span class="line">      (*) Generic-x86-64</span><br><span class="line">Binary Emulations  ---&gt;</span><br><span class="line">   [*] IA32 Emulation</span><br></pre></td></tr></table></figure>
<p>启用GPT支持，因为前面我用的GPT分区表，EFI启动方式，所以这两项也必须启用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-*- Enable the block layer ---&gt;</span><br><span class="line">   Partition Types ---&gt;</span><br><span class="line">      [*] Advanced partition selection</span><br><span class="line">      [*] EFI GUID Partition support</span><br></pre></td></tr></table></figure>

<p>EFI的支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Processor type and features  ---&gt;</span><br><span class="line">    [*] EFI runtime service support </span><br><span class="line">    [*]   EFI stub support</span><br><span class="line">    [*]     EFI mixed-mode support</span><br><span class="line"> </span><br><span class="line">Firmware Drivers  ---&gt;</span><br><span class="line">    EFI (Extensible Firmware Interface) Support  ---&gt;</span><br><span class="line">        &lt;*&gt; EFI Variable Support via sysfs</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 编译内核</span><br><span class="line">make -j12 #（CPU核心数根据机器cpu调整）      </span><br><span class="line">make modules_install</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>使用二进制内核</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装二进制内核</span></span><br><span class="line">emerge --ask sys-kernel/gentoo-kernel-bin</span><br></pre></td></tr></table></figure>

<p>可选：生成一个initramfs</p>
<p>在某些情况中需要建立一个initramfs——一个基于内存的初始化文件系统。最觉的原因是当重要的文件系统位置（如&#x2F;usr&#x2F;或&#x2F;var&#x2F;）在分离的分区。通过一个initramfs，这些分区可以使用initramfs里面的工具来完成挂载。</p>
<p>用dracut生成内核的initramfs，快速且方便，新手友好</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask sys-kernel/dracut</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /boot</span><br><span class="line"></span><br><span class="line">dracut --hostonly</span><br></pre></td></tr></table></figure>

<p>或者使用genkernel生成内核的initramfs</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/src/linux/generated-config /etc/kernels/kernel-config-&lt;内核版本号&gt;-gentoo-x86_64</span><br><span class="line">genkernel --install initramfs</span><br></pre></td></tr></table></figure>



<h3 id="系统环境配置"><a href="#系统环境配置" class="headerlink" title="系统环境配置"></a>系统环境配置</h3><h4 id="配置主机名"><a href="#配置主机名" class="headerlink" title="配置主机名"></a>配置主机名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#nano -w /etc/conf.d/hostname</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;HOSTNAME&quot;</span> &gt; /etc/hostname</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="配置系统时区"><a href="#配置系统时区" class="headerlink" title="配置系统时区"></a>配置系统时区</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /usr/share/zoneinfo</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Asia/Shanghai&quot;</span> &gt; /etc/timezone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决时间差8小时问题（双系统时会遇到Windows时间不对）</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/localtime</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">ln</span> -sv /usr/share/zoneinfo/Universal /etc/localtime</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> emerge --config sys-libs/timezone-data</span><br></pre></td></tr></table></figure>

<h4 id="配置编码"><a href="#配置编码" class="headerlink" title="配置编码"></a>配置编码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nano -w /etc/locale.gen 		<span class="comment">#将以下几项取消注释，如果没有手动输入</span></span><br><span class="line"></span><br><span class="line">en_US ISO-8859-1</span><br><span class="line">en_US.UTF-8 UTF-8</span><br><span class="line">zh_CN GBK </span><br><span class="line">zh_CN.UTF-8 UTF-8</span><br><span class="line"></span><br><span class="line">locale-gen 						<span class="comment"># 更新</span></span><br></pre></td></tr></table></figure>

<h4 id="设置系统locale"><a href="#设置系统locale" class="headerlink" title="设置系统locale"></a>设置系统locale</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看可用系统时区和地区配置</span></span><br><span class="line">eselect locale list  </span><br><span class="line"></span><br><span class="line"><span class="comment">#这里只能选择“en-US.utf8”！！假如设置成了中文后，整个系统的终端命令行会乱码！！！</span></span><br><span class="line">eselect locale <span class="built_in">set</span> X    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新环境</span></span><br><span class="line">env-update &amp;&amp; <span class="built_in">source</span> /etc/profile &amp;&amp; <span class="built_in">export</span> PS1=<span class="string">&quot;(chroot) <span class="variable">$&#123;PS1&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置sudo自动补全"><a href="#配置sudo自动补全" class="headerlink" title="配置sudo自动补全"></a>配置sudo自动补全</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> emerge --ask app-shells/bash-completion</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 bash-completion 全局 USE 标记</span></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/protage/make.conf</span><br><span class="line">USE=<span class="string">&quot;... bash-completion&quot;</span></span><br><span class="line"><span class="built_in">sudo</span> emerge --avuDN world</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用bash-completion的功能</span></span><br><span class="line"><span class="built_in">sudo</span> eselect bashcomp <span class="built_in">enable</span> base</span><br><span class="line"><span class="comment"># sudo bashcomp-config enable base</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看哪些命令支持bash-completion</span></span><br><span class="line"><span class="built_in">sudo</span> eselect bashcomp list</span><br></pre></td></tr></table></figure>

<h4 id="安装网络工具"><a href="#安装网络工具" class="headerlink" title="安装网络工具"></a>安装网络工具</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 无线</span></span><br><span class="line">emerge --ask net-wireless/iw</span><br><span class="line">emerge --ask net-wireless/wpa_supplicant</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有线</span></span><br><span class="line">emerge --ask net-misc/netifrc <span class="comment"># openrc 自带</span></span><br><span class="line"><span class="comment"># emerge --ask net-misc/systemd-networkd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PPPoE环境</span></span><br><span class="line">emerge --ask net-dialup/ppp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果使用GUI可跳过</span></span><br><span class="line"><span class="comment"># 要在引导时激活网络接口，需要将它们添加到默认运行级别</span></span><br><span class="line"><span class="comment"># 首先使用 ifconfig 查看网络接口名称</span></span><br><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"><span class="built_in">ln</span> -s net.lo net.eno1 <span class="comment"># 此处网卡名称需要和实际网卡名对应</span></span><br><span class="line">rc-update add net.eno1 default</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>![[Gentoo安装&#x2F;IMG-20241210170128726.png]]<br>安装配置networkmanager</p>
<p>最方便支持多种联网方式的工具是NetworkManager,基本满足所有需求，但同时它的依赖有点多。如果使用桌面环境的话建议安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">nano -w /etc/portage/make.conf:</span><br><span class="line">USE=“networkmanager connection-sharing dhclient policykit ppp wifi -dhcpcd”</span><br><span class="line"></span><br><span class="line">emerge net-misc/networkmanager </span><br><span class="line"></span><br><span class="line">nano -w /etc/dhcp/dhclient.conf：</span><br><span class="line">send host-name <span class="string">&quot;Gentoo&quot;</span>    <span class="comment">#your hostname</span></span><br><span class="line"></span><br><span class="line">nano -w /etc/NetworkManager/NetworkManager.conf</span><br><span class="line">[connectivity]</span><br><span class="line">uri=http://nmcheck.gnome.org/check_network_status.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nano -w /etc/NetworkManager/NetworkManager.conf</span><br><span class="line">[main]</span><br><span class="line">plugins=keyfile</span><br><span class="line">dns=dnsmasq</span><br><span class="line">hostname-mode=none</span><br><span class="line"></span><br><span class="line">rc-update del dhcpcd</span><br><span class="line">rc-update add NetworkManager default</span><br><span class="line"><span class="comment"># systemctl disable dhcpcd</span></span><br><span class="line"><span class="comment"># systemctl enable networkmanager</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gpasswd -a &lt;你的桌面使用用户名&gt; plugdev   #没有这一步，用户将不能使用networkmanager，也就不能上网。不过先跳过这一步，在设置系统用户的时候再做。</span></span><br><span class="line"></span><br><span class="line">nano -w /etc/dnsmasq.conf:</span><br><span class="line">server=114.114.114.114</span><br></pre></td></tr></table></figure>

<h4 id="安装必要的工具"><a href="#安装必要的工具" class="headerlink" title="安装必要的工具"></a>安装必要的工具</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统日志</span></span><br><span class="line">emerge --ask app-admin/sysklogd</span><br><span class="line">rc-update add sysklogd default</span><br><span class="line"><span class="comment"># systemctl enable sysklogd</span></span><br><span class="line"><span class="comment"># systemctl start sysklogd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计划任务管理</span></span><br><span class="line">emerge --ask sys-process/cronie</span><br><span class="line">rc-update add cronie default</span><br><span class="line"><span class="comment"># systemctl enable cronie</span></span><br><span class="line"><span class="comment"># systemctl start cronie</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件索引</span></span><br><span class="line">emerge --ask sys-apps/mlocate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 电源管理</span></span><br><span class="line">emerge --ask sys-power/acpid</span><br><span class="line">rc-update add acpid default</span><br><span class="line"><span class="comment"># systemctl enable acpid</span></span><br><span class="line"><span class="comment"># systemctl start acpid</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CPU温度管理</span></span><br><span class="line">emerge sys-power/thermald</span><br><span class="line">rc-update add thermald default</span><br><span class="line"><span class="comment"># systemctl enable thermald </span></span><br><span class="line"><span class="comment"># systemctl start thermald</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设备管理工具</span></span><br><span class="line">emerge --ask virtual/udev</span><br><span class="line">rc-update add udev sysinit</span><br><span class="line"><span class="comment"># systemctl enable udev</span></span><br><span class="line"><span class="comment"># systemctl start udev</span></span><br></pre></td></tr></table></figure>



<h4 id="配置系统用户"><a href="#配置系统用户" class="headerlink" title="配置系统用户"></a>配置系统用户</h4><p>安装sudo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">emerge app-admin/sudo</span><br><span class="line"></span><br><span class="line">nano -w /etc/sudoers</span><br></pre></td></tr></table></figure>

<p>把 <code>%wheel ALL=(ALL) ALL</code> 这一行去掉注释，如果希望执行sudu不需要密码则取消注释<code>%wheel ALL=(ALL) NOPASSWD:ALL</code></p>
<p>添加用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd <span class="built_in">sudo</span> </span><br><span class="line">useradd -m -G <span class="built_in">users</span>,wheel,usb,portage,video,audio,<span class="built_in">sudo</span> -s /bin/bash [用户名]</span><br><span class="line"><span class="built_in">chmod</span> 700 /home/[用户名] -R</span><br></pre></td></tr></table></figure>

<p>设置密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置root密码</span></span><br><span class="line">passwd root</span><br><span class="line"></span><br><span class="line">passwd &#123;用户名&#125;</span><br></pre></td></tr></table></figure>

<h4 id="添加操作系统启动项"><a href="#添加操作系统启动项" class="headerlink" title="添加操作系统启动项"></a>添加操作系统启动项</h4><p>在<code>/etc/portage/make.conf</code>中添加grub配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_PLATFORMS=<span class="string">&quot;efi-64&quot;</span></span><br></pre></td></tr></table></figure>

<p>安装grub2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask sys-boot/grub:2</span><br><span class="line">emerge --ask sys-boot/os-prober <span class="comment"># 用于识别其他分区的系统（双系统）</span></span><br></pre></td></tr></table></figure>

<p>grub安装到硬盘并生成开机启动项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=Gentoo</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o remount,rw /sys/firmware/efi/efivarsos-prober</span><br></pre></td></tr></table></figure>

<p>如果出现No space left on device，请运行以下命令，之后再重复上述步骤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount -t efivarfs efivarfs /sys/firmware/efi/efivars</span><br><span class="line"><span class="built_in">rm</span> /sys/firmware/efi/efivars/dump-*</span><br></pre></td></tr></table></figure>

<p>grub默认配置添加自定义配置，可提高intel cpu的稳定性和性能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nano -w /etc/default/grub：</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;intel_idle.max_cstate=0 processor.max_cstate=1&quot;</span></span><br><span class="line"></span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<h4 id="清理"><a href="#清理" class="headerlink" title="清理"></a>清理</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /stage3-*.tag.ge</span><br><span class="line"><span class="comment"># 退出chroot</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载</span></span><br><span class="line">umount -lR /mnt/gentoo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 成功开机并进入系统后</span></span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<p><strong>如果开机不正常参考挂载文件系统(不要执行分区和mkfs操作)，可重新chroot进入系统修改错误的配置。</strong></p>
<h3 id="桌面环境"><a href="#桌面环境" class="headerlink" title="桌面环境"></a>桌面环境</h3><h4 id="安装基础环境"><a href="#安装基础环境" class="headerlink" title="安装基础环境"></a>安装基础环境</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从 x11-base/xorg-drivers-21.1 开始,x11-base/xorg-drivers更改 [USE 标志]设置</span></span><br><span class="line"><span class="comment"># 这将弃用x11-drivers/xf86-video-intel驱动程序，以支持内置的通用模式设置DDX驱动程序</span></span><br><span class="line"><span class="comment"># 具有video_cards_i915USE 标志集将继续安装 Intel DDX 驱动程序。</span></span><br><span class="line">emerge --ask x11-base/xorg-drivers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 英伟达显卡</span></span><br><span class="line">emerge --ask x11-drivers/nvidia-drivers</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装xorg-server</span></span><br><span class="line">emerge --ask x11-base/xorg-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装双显卡设置工具</span></span><br><span class="line">emerge --ask x11-apps/xrandr </span><br><span class="line"></span><br><span class="line"><span class="comment"># 让nvidia自动设置双显卡prime配置</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/X11/xorg.conf </span><br><span class="line"><span class="built_in">sudo</span> nvidia-xconfig --prime </span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装完更新当前系统组件环境</span></span><br><span class="line">env-update &amp;&amp; <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>

<p><a href="**%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4%E4%B8%8D%E8%83%BD%E5%A4%9A%E6%AC%A1%E6%89%A7%E8%A1%8C%EF%BC%8C%E5%A6%82%E6%9E%9C%E9%87%8D%E5%A4%8D%E6%89%A7%E8%A1%8C%E9%9C%80%E8%A6%81%E6%89%8B%E5%8A%A8%E4%BF%AE%E6%94%B9fstab%E5%8E%BB%E6%8E%89%E9%87%8D%E5%A4%8D%E7%9A%84%E9%A1%B9%EF%BC%8C%E5%90%A6%E5%88%99%E4%BC%9A%E5%AF%BC%E8%87%B4%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%8C%82%E8%BD%BD%E5%BC%82%E5%B8%B8%EF%BC%8C%E7%B3%BB%E7%BB%9F%E6%97%A0%E6%B3%95%E5%90%AF%E5%8A%A8**">^注意</a>: 以后每次重新编译安装内核kernel后，均须要运行一遍“emerge @module-rebuild”，重新编译安装nvidia驱动模块加载到内核之中，否则nvidia驱动无法加载！！！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep nvidia</span><br><span class="line"><span class="built_in">sudo</span> rmmod nvidia</span><br><span class="line"><span class="built_in">sudo</span> modprobe nvidia</span><br><span class="line"></span><br><span class="line">lsmod|grep nvidia</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/modules-load.d/nvidia.conf:</span><br><span class="line">nvidia</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/modprobe.d/nvidia-drm.conf:</span><br><span class="line">options nvidia-drm modeset=1</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> rc-update add modules boot</span><br><span class="line"><span class="built_in">sudo</span> reboot </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="LightDM"><a href="#LightDM" class="headerlink" title="LightDM"></a>LightDM</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装LightDM，使用KDE可忽略</span></span><br><span class="line"><span class="built_in">sudo</span> emerge --ask gui-libs/display-manager-init</span><br><span class="line"><span class="built_in">sudo</span> emerge --ask x11-misc/lightdm </span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不安装桌面管理器需要加入环境，登录后自动启动桌面</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;XSESSION=\&quot;awesome\&quot;&quot;</span> &gt; /etc/env.d/90xsession</span><br><span class="line">env-update &amp;&amp; <span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># openrc</span></span><br><span class="line">nano -w /etc/conf.d/display-manager</span><br><span class="line">DISPLAYMANAGER=<span class="string">&quot;lightdm&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认开机启动</span></span><br><span class="line">rc-update add display-manager default</span><br><span class="line"><span class="comment"># 设置dubs默认开机启动，虽然display-manager也会启动它，但有时候会出现奇怪的问题</span></span><br><span class="line">rc-update add dbus default</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动启动</span></span><br><span class="line">rc-service dbus start </span><br><span class="line">rc-service display-manager start</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemd</span></span><br><span class="line"><span class="comment"># systemctl enable lightdm.service</span></span><br></pre></td></tr></table></figure>

<h4 id="KDE"><a href="#KDE" class="headerlink" title="KDE"></a>KDE</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装KDE桌面可忽略上边LightDM,同时需要删除USE中`-kde`</span></span><br><span class="line"><span class="built_in">sudo</span> emerge --ask x11-misc/sddm</span><br><span class="line"><span class="built_in">sudo</span> emerge --ask kde-plasma/plasma-meta</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Dock</span></span><br><span class="line"><span class="comment"># 安装完打开latte-dock后会自动设置为开机自启动</span></span><br><span class="line"><span class="built_in">sudo</span> emerge --ask kde-misc/latte-dock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改登陆管理器配置文件</span></span><br><span class="line">nano -w /etc/conf.d/display-manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- xdm内容</span></span><br><span class="line">DISPLAYMANAGER=<span class="string">&quot;sddm&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加SDDM开机启动</span></span><br><span class="line"><span class="built_in">sudo</span> rc-update add xdm default</span><br><span class="line"><span class="comment"># 启动SDDM</span></span><br><span class="line"><span class="built_in">sudo</span> rc-service xdm start </span><br><span class="line"></span><br><span class="line"><span class="comment"># Systemd</span></span><br><span class="line"><span class="comment"># sudo systemctl enable xdm</span></span><br><span class="line"><span class="comment"># sudo systemctl start xdm</span></span><br></pre></td></tr></table></figure>

<h4 id="Awesome"><a href="#Awesome" class="headerlink" title="Awesome"></a>Awesome</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># awesome 平铺式桌面</span></span><br><span class="line">emerge --ask x11-wm/awesome </span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.config/awesome/</span><br><span class="line"><span class="built_in">cp</span> /etc/xdg/awesome/rc.lua ~/.config/awesome/rc.lua</span><br><span class="line">awesome -k</span><br><span class="line"></span><br><span class="line"><span class="comment"># 壁纸支持</span></span><br><span class="line">emerge --ask media-gfx/feh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在~/.config/awesome/theme/theme中添加一下内容</span></span><br><span class="line">theme.wallpaper_cmd = &#123; <span class="string">&quot;wesetbg -f .config/awesome/themes/awesome-wallpaper.png&quot;</span> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Mate"><a href="#Mate" class="headerlink" title="Mate"></a>Mate</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择profile</span></span><br><span class="line">eselect profile list</span><br><span class="line">eselect profile <span class="built_in">set</span> 0 <span class="comment"># 选择default/linux/amd64/23.0/desktop</span></span><br><span class="line"><span class="comment"># 更新</span></span><br><span class="line">emerge -auvDU @world</span><br><span class="line"></span><br><span class="line"><span class="comment"># Meta 桌面</span></span><br><span class="line">emerge --ask mate-base/mate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改xsession配置</span></span><br><span class="line">nano -w /etc/env.d/90xsession</span><br><span class="line"><span class="comment">#--- 90xsession内容</span></span><br><span class="line">XSESSION=<span class="string">&quot;Mate&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#--- </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改LightDM配置(需要安装LightDM)</span></span><br><span class="line">nano -w /etc/conf.d/display-manager</span><br><span class="line"><span class="comment">#--- display-manager内容</span></span><br><span class="line">DISPLAYMANAGER=<span class="string">&quot;lightdm&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="Xfce"><a href="#Xfce" class="headerlink" title="Xfce"></a>Xfce</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># xfce4桌面</span></span><br><span class="line">emerge --ask xfce-base/xfce4-meta </span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试桌面启动指令</span></span><br><span class="line">startxfce4 <span class="comment"># 启动Xfce桌面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pulseaudio音量控制</span></span><br><span class="line">emerge --ask xfce-extra/xfce4-volumed-pulse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 蓝牙音乐播放组件</span></span><br><span class="line">emerge --ask xfce-extra/xfce4-pulseaudio-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示所有正在运行的程序的列表，以及每个程序占用的CPU和内存消耗。 </span></span><br><span class="line">emerge --ask xfce-extra/xfce4-taskmanager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监视和管理电源使用情况的应用程序。 这对笔记本电脑特别重要！</span></span><br><span class="line"><span class="comment"># 电源管理器允许用户调节屏幕亮度，选择最大性能或节电模式，</span></span><br><span class="line"><span class="comment"># 并在盖子关闭或按下按钮时设置休眠，暂停和关闭操作</span></span><br><span class="line">emerge --ask xfce-extra/xfce4-power-manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># 适合笔记本电脑用户。 它显示电池百分比，剩余时间，电源（交流或电池），风扇状态，警告，</span></span><br><span class="line"><span class="comment"># 甚至可以配置为在特定功率级别执行命令。 此功能可用于在电池电量几乎耗尽时将笔记本电脑置于休眠模式。</span></span><br><span class="line">xfce-extra/xfce4-battery-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加几个窗口管理器主题</span></span><br><span class="line">emerge --ask x11-themes/xfwm4-themes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个X11终端，比准系统更可配置和有用 xterm </span></span><br><span class="line">emerge --ask x11-terms/xfce4-terminal</span><br><span class="line"></span><br><span class="line"><span class="comment"># Xfce的默认图形文件管理器。</span></span><br><span class="line">emerge --ask xfce-base/thunar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许用户从Thunar内预览某些类型的文件，例如图像和字体。</span></span><br><span class="line">emerge --ask xfce-extra/tumbler</span><br><span class="line"></span><br><span class="line"><span class="comment"># manages自动挂载可移动介质和驱动器。</span></span><br><span class="line">emerge --ask xfce-extra/thunar-volman</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌入面板的一个小命令行。 它比打开终端运行命令更快。</span></span><br><span class="line">emerge --ask xfce-extra/xfce4-verve-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提供一种方便的方法，只需点击鼠标即可安装/etc/fstab中列出的设备。</span></span><br><span class="line">emerge --ask xfce-extra/xfce4-mount-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许用户监视硬件传感器，例如CPU温度，风扇RPM，硬盘驱动器温度，主板电压等。</span></span><br><span class="line">emerge --ask xfce-extra/xfce4-sensors-plugin</span><br></pre></td></tr></table></figure>

<h4 id="音频控制"><a href="#音频控制" class="headerlink" title="音频控制"></a>音频控制</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask alsa-utils</span><br><span class="line">emerge --ask alsa-plugins</span><br></pre></td></tr></table></figure>

<h4 id="中文字体"><a href="#中文字体" class="headerlink" title="中文字体"></a>中文字体</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask media-fonts/arphicfonts</span><br><span class="line">emerge --ask media-fonts/noto-cjk</span><br><span class="line">emerge --ask media-fonts/source-han-sans</span><br><span class="line">emerge --ask media-fonts/wqy-microhei</span><br><span class="line">emerge --ask media-fonts/wqy-zenhei</span><br><span class="line"></span><br><span class="line">eselect fontconfig list </span><br><span class="line">eselect fontconfig <span class="built_in">enable</span> X X X <span class="comment"># 选择所有wqy开头的项</span></span><br></pre></td></tr></table></figure>

<h4 id="输入法"><a href="#输入法" class="headerlink" title="输入法"></a>输入法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入法主题框架</span></span><br><span class="line"><span class="comment"># 其中， app-i18n/fcitx:5 是 fcitx 的主程序</span></span><br><span class="line"><span class="comment"># 　　　 app-i18n/fcitx-configtool:5 是它的配置工具</span></span><br><span class="line"><span class="comment"># 　　　 app-i18n/fcitx-qt:5 用于支持在 qt 程序上使用它</span></span><br><span class="line"><span class="comment"># 　　　 app-i18n/fcitx-gtk:5 用于支持在 gtk 程序上使用它</span></span><br><span class="line">emerge -vj app-i18n/fcitx:5 app-i18n/fcitx-configtool:5 app-i18n/fcitx-qt:5 app-i18n/fcitx-gtk:5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装完成后再用户的~/.xsession文件内添加</span></span><br><span class="line"><span class="built_in">export</span> XMODIFIERS=<span class="string">&quot;@im=fcitx&quot;</span></span><br><span class="line"><span class="built_in">export</span> QT_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> GTK_IM_MODULE=fcitx</span><br><span class="line"><span class="built_in">export</span> SDL_IM_MODULE=fcitx</span><br></pre></td></tr></table></figure>

<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用常规(基于源)更新</span></span><br><span class="line"><span class="comment"># --ask(-a)控制Portage显示要更新的软件列表，并提供是否更新选择</span></span><br><span class="line"><span class="comment"># --verbose(-v)在屏幕上输出完整的文件列表</span></span><br><span class="line"><span class="comment"># --update(-u)更新包的最佳版本</span></span><br><span class="line"><span class="comment"># --deep(-D)更新系统中的每个软件包</span></span><br><span class="line"><span class="comment"># --newuse(-N)USE标记变更后，要使用Portage检查USE标记的变动是否导致需要安装新的软件或将现有的软件包重新编译</span></span><br><span class="line"><span class="built_in">sudo</span> emerge --ask --verbose --update --deep --newuse @world</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价简写</span></span><br><span class="line">emerge -avuDN @world</span><br><span class="line"></span><br><span class="line">emerge -av --deepclean</span><br><span class="line"></span><br><span class="line"><span class="comment">#gentookit包里的一个软件，用来检查系统的依赖是否都满足,自动安装缺失的依赖</span></span><br><span class="line">revdep-rebuild</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用二进制包更新系统</span></span><br><span class="line">emerge --ask --verbose --update --deep --changed-use --getbinpkg @world</span><br><span class="line"></span><br><span class="line"><span class="comment"># 告诉 Portage 不要对一些指定的包或分类创建二进制包</span></span><br><span class="line">emerge -uDN @world --buildpkg --buildpkg-exclude <span class="string">&quot;virtual/* sys-kernel/*-sources&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并use标记</span></span><br><span class="line">etc-update </span><br><span class="line">-3 <span class="comment"># 自动合并</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 刷新环境变量</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile </span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理旧版本的内核</span></span><br><span class="line">emerge --prune sys-kernel/gentoo-kernel sys-kernel/gentoo-kernel-bin</span><br></pre></td></tr></table></figure>



<p>emerge 使用二进制包选项说明</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>–usepkg (-k)</td>
<td>尝试使用本地可用的 packages 目录中的二进制包。如果未找到二进制包，将执行常规（基于源）安装。</td>
</tr>
<tr>
<td>–usepkgonly (-K)</td>
<td>类似 –usepkg (-k) ，但如果找不到二进制包，则失败。</td>
</tr>
<tr>
<td>–getbinpkg (-g)</td>
<td>从远程二进制包主机下载二进制包。如果未找到二进制包，将执行常规（基于源）安装。</td>
</tr>
<tr>
<td>–getbinpkgonly (-G)</td>
<td>类似于 –getbinpkg (-g) ，但如果无法下载二进制包，则会失败</td>
</tr>
</tbody></table>
<h3 id="USE变量说明-官方文档"><a href="#USE变量说明-官方文档" class="headerlink" title="USE变量说明 官方文档"></a>USE变量说明 <a target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Working/USE/zh-cn">官方文档</a></h3><p>USE是Gentoo为用户提供的最具威力的变量之一。很多程序通过它可以选择编译或者不编译某些可选的支持。例如，一些程 序可以在编译时加入对gtk或是对qt的支持。其它的程序可以在编译时加入或不加入对于SLL的支持。有些程序甚至可以在编译时加入对 framebuffer的支持（svgalib）以取代X11（X服务器）。<br>大多数的发行版会使用尽可能多的支持特性编译它们的软件包，这既增加了软件的大小也减慢了启动时间，而这些还没有算上可能会涉及到的大量依赖性问题。Gentoo可以让你自己定义软件编译的选项，而这正是USE要做的事。<br>在USE变量里可以定义关键字，它被用来对应相应的编译选项。例如，ssl将会把ssl支持编译到程序中以支持它。-X会移除其对于X服务器的支持（注意前面的减号）。gnome gtk -kde -qt4将会以支持GNOME（和GTK）但不支持KDE（和Qt）的方式编译软件，使系统为GNOME做完全调整（如果架构支持）。<br>默认的USE设置全放在了系统所使用的Gentoo配置文件的make.defaults文件中。Gentoo对它的配置文件们使用了一个（复杂的）继承系统，在这个阶段我们不去深入。最简单的检查当前活动的USE标记的办法是运行emerge –info并选择以USE开头的那一行:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --info |grep ^USE</span><br></pre></td></tr></table></figure>
<p>![[Gentoo安装&#x2F;IMG-20241210170128821.png]]<br>可以在系统的&#x2F;usr&#x2F;portage&#x2F;profiles&#x2F;use.desc中找到可用的USE标记的完整描述。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less /usr/share/portage/profile/use.desc</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">### 常用软件</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">sudo emerge --ask media-video/mpv</span><br><span class="line"></span><br><span class="line"># 电子邮件客户端</span><br><span class="line">sudo emerge mail-client/thunderbird</span><br><span class="line"></span><br><span class="line"># 视频播放器</span><br><span class="line">sudo emerge media-video/mplayer</span><br><span class="line"></span><br><span class="line"># 音乐播放器</span><br><span class="line">sudo emerge media-sound/exaile</span><br><span class="line"></span><br><span class="line"># 虚拟机</span><br><span class="line">sudo emerge app-emulation/virt-manager</span><br><span class="line">sudo emerge app-emulation/virtualbox</span><br><span class="line"></span><br><span class="line"># VIM</span><br><span class="line">sudo emerge app-editors/vim</span><br></pre></td></tr></table></figure>



<p>参考文章</p>
<p><a target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Handbook:AMD64/zh-cn">Gentoo AMD64 Handbook - Gentoo Wiki</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/devilyouwei/p/6657409.html">开始使用gentoo linux——gentoo安装笔记（上）</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/devilyouwei/p/6659058.html">开始使用gentoo linux——gentoo安装笔记（下）</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/122501653">Gentoo安装流程分享(step by step)，第二篇之KDE Plasma桌面的安装配置 - 知乎 (zhihu.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/515a1f39b438">gentoo linux配置intel和nvidia双显卡电脑，使用prime方案 - 简书 (jianshu.com)</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpg" alt="Chemmy 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.jpg" alt="Chemmy 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Gentoo/" rel="tag"># Gentoo</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/11/03/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Golang/Go-MVC%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94/" rel="prev" title="Go MVC框架对比">
                  <i class="fa fa-angle-left"></i> Go MVC框架对比
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/07/07/%E6%9D%82%E9%A1%B9/FRP%E9%85%8D%E7%BD%AE/" rel="next" title="FRP配置">
                  FRP配置 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments giscus-container">
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2015 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Chemmy</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"chengming0916/chengming0916.github.io","repo_id":"R_kgDOLemcag","category":"Announcements","category_id":"DIC_kwDOLemcas4CupMn","mapping":"title","strict":0,"reactions_enabled":1,"emit_metadata":1,"theme":"light","lang":"zh-CN","crossorigin":"anonymous","input_position":"bottom","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-strict'           : CONFIG.giscus.strict,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
