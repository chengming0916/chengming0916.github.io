<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"chengming0916.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Chemmy&#39;s Blog">
<meta property="og:url" content="http://chengming0916.github.io/page/15/index.html">
<meta property="og:site_name" content="Chemmy&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Chemmy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://chengming0916.github.io/page/15/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/15/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Chemmy's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>





  <script src="/js/third-party/pace.js" defer></script>


  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Chemmy's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">chengming0916@outlook.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Chemmy"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Chemmy</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">191</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">178</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/chengming0916" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chengming0916" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/chengming0916@outlook.com" title="E-Mail → chengming0916@outlook.com" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/10/31/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/DotNetty%E5%AE%8C%E5%85%A8%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/31/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/DotNetty%E5%AE%8C%E5%85%A8%E6%95%99%E7%A8%8B%EF%BC%88%E5%9B%9B%EF%BC%89/" class="post-title-link" itemprop="url">DotNetty完全教程（四）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-31 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-31T00:00:00+08:00">2019-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:24" itemprop="dateModified" datetime="2025-09-09T08:40:24+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">编程技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/" itemprop="url" rel="index"><span itemprop="name">DotNet</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">DotNetty教程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="DotNetty完全教程（四）"><a href="#DotNetty完全教程（四）" class="headerlink" title="DotNetty完全教程（四）"></a>DotNetty完全教程（四）</h1><blockquote>
<h2 id="Excerpt"><a href="#Excerpt" class="headerlink" title="Excerpt"></a>Excerpt</h2><p>ByteBufferNetty中ByteBuffer的介绍Netty 的数据处理 API 通过两个组件暴露——abstract class ByteBuf 和 interfaceByteBufHolderDotNetty中有AbstractByteBuffer  IByteBuffer IByteBufferHolder优点：它可以被用户自定义的缓冲区类型扩展；通过内置的复合缓冲区…</p>
</blockquote>
<hr>
<h2 id="ByteBuffer"><a href="#ByteBuffer" class="headerlink" title="ByteBuffer"></a>ByteBuffer</h2><h3 id="Netty中ByteBuffer的介绍"><a href="#Netty中ByteBuffer的介绍" class="headerlink" title="Netty中ByteBuffer的介绍"></a>Netty中ByteBuffer的介绍</h3><p>Netty 的数据处理 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020">API</a> 通过两个组件暴露——abstract class ByteBuf 和 interface<br>ByteBufHolder</p>
<p>DotNetty中有AbstractByteBuffer IByteBuffer IByteBufferHolder</p>
<p>优点：</p>
<ul>
<li>它可以被用户自定义的缓冲区类型扩展；</li>
<li>通过内置的复合缓冲区类型实现了透明的零拷贝；</li>
<li>容量可以按需增长（类似于 JDK 的 StringBuilder）；</li>
<li>在读和写这两种模式之间切换不需要调用 ByteBuffer 的 flip()方法；</li>
<li>读和写使用了不同的索引；</li>
<li>支持方法的链式调用；</li>
<li>支持引用计数；</li>
<li>支持池化</li>
</ul>
<h3 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h3><p>每一个ByteBuf都有两个索引，读索引和写索引，read和write会移动索引，set和get不会引动索引。</p>
<h3 id="使用ByteBuf"><a href="#使用ByteBuf" class="headerlink" title="使用ByteBuf"></a>使用ByteBuf</h3><ol>
<li>堆缓冲区(使用数组的方式展示和操作数据)</li>
</ol>
<p>使用支撑数组给ByteBuf提供快速的分配和释放的能力。适用于有遗留数据需要处理的情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public override void ChannelRead(IChannelHandlerContext ctx, object msg)</span><br><span class="line">&#123;</span><br><span class="line">    IByteBuffer message = msg as IByteBuffer;</span><br><span class="line">    // 检查是否有支撑数组</span><br><span class="line">    if (message.HasArray)</span><br><span class="line">    &#123;</span><br><span class="line">        // 获取数组</span><br><span class="line">        byte[] array = message.Array;</span><br><span class="line">        // 计算第一个字节的偏移</span><br><span class="line">        int offset = message.ArrayOffset + message.ReaderIndex;</span><br><span class="line">        // 获取可读字节数</span><br><span class="line">        int length = message.ReadableBytes;</span><br><span class="line">        // 调用方法，处理数据</span><br><span class="line">        HandleArray(array, offset, length);</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine(&quot;收到信息：&quot; + message.ToString(Encoding.UTF8));</span><br><span class="line">    ctx.WriteAsync(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>直接缓冲区</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public override void ChannelRead(IChannelHandlerContext ctx, object msg)</span><br><span class="line">&#123;</span><br><span class="line">    IByteBuffer message = msg as IByteBuffer;</span><br><span class="line">    if (message.HasArray)</span><br><span class="line">    &#123;</span><br><span class="line">        int length = message.ReadableBytes;</span><br><span class="line">        byte[] array = new byte[length];</span><br><span class="line">        message.GetBytes(message.ReaderIndex, array);</span><br><span class="line">        HandleArray(array, 0, length);</span><br><span class="line">    &#125;</span><br><span class="line">    Console.WriteLine(&quot;收到信息：&quot; + message.ToString(Encoding.UTF8));</span><br><span class="line">    ctx.WriteAsync(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>CompositeByteBuffer 复合缓冲区</li>
</ol>
<p>如果要发送的命令是由两个ByteBuf拼接构成的，那么就需要复合缓冲区，比如Http协议中一个数据流由头跟内容构成这样的逻辑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public override void ChannelRead(IChannelHandlerContext ctx, object msg)</span><br><span class="line">&#123;</span><br><span class="line">    IByteBuffer message = msg as IByteBuffer;</span><br><span class="line">    // 创建一个复合缓冲区</span><br><span class="line">    CompositeByteBuffer messageBuf = Unpooled.CompositeBuffer();</span><br><span class="line">    // 创建两个ByteBuffer</span><br><span class="line">    IByteBuffer headBuf = Unpooled.CopiedBuffer(message);</span><br><span class="line">    IByteBuffer bodyBuf = Unpooled.CopiedBuffer(message);</span><br><span class="line">    // 添加到符合缓冲区中</span><br><span class="line">    messageBuf.AddComponents(headBuf, bodyBuf);</span><br><span class="line">    // 删除</span><br><span class="line">    messageBuf.RemoveComponent(0);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(&quot;收到信息：&quot; + message.ToString(Encoding.UTF8));</span><br><span class="line">    ctx.WriteAsync(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字节级操作"><a href="#字节级操作" class="headerlink" title="字节级操作"></a>字节级操作</h3><ol>
<li>读取(不移动索引)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public override void ChannelRead(IChannelHandlerContext ctx, object msg)</span><br><span class="line">&#123;</span><br><span class="line">    IByteBuffer message = msg as IByteBuffer;</span><br><span class="line">    for (int i = 0; i &lt; message.Capacity; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        // 如此使用索引访问不会改变读索引也不会改变写索引</span><br><span class="line">        byte b = message.GetByte(i);</span><br><span class="line">        Console.WriteLine(b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(&quot;收到信息：&quot; + message.ToString(Encoding.UTF8));</span><br><span class="line">    ctx.WriteAsync(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>丢弃可丢弃字节<br>所谓可丢弃字节就是调用read方法之后，readindex已经移动过了的区域，这段区域的字节称为可丢弃字节。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message.DiscardReadBytes();</span><br></pre></td></tr></table></figure>

<p>只有在内存十分宝贵需要清理的时候再调用这个方法，随便调用有可能会造成内存的复制，降低效率。<br>3. 读取所有可读字节（移动读索引）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while (message.IsReadable())</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(message.ReadByte());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>写入数据</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 使用随机数填充可写区域</span><br><span class="line">while (message.WritableBytes &gt; 4)</span><br><span class="line">&#123;</span><br><span class="line">    message.WriteInt(new Random().Next(0, 100));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>管理索引</li>
</ol>
<ul>
<li>MarkReaderIndex ResetReaderIndex 标记和恢复读索引</li>
<li>MarkWriterIndex ResetWriterIndex 标记和恢复写索引</li>
<li>SetReaderIndex(int) SetWriterIndex(int) 直接移动索引</li>
<li>clear() 重置两个索引都为0，但是不会清除内容</li>
</ul>
<ol start="6">
<li>查找</li>
</ol>
<ul>
<li>IndexOf()</li>
<li>使用Processor</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查找\r</span><br><span class="line">message.ForEachByte(ByteProcessor.FindCR);</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>派生</li>
</ol>
<p>派生的意思是创建一个新的ByteBuffer，这个ByteBuf派生于其他的ByteBuf，派生出来的子ByteBuf具有自己的读写索引，但是本质上指向同一个对象，这样就导致了改变一个，另一个也会改变。</p>
<ul>
<li>duplicate()；</li>
<li>slice()；</li>
<li>slice(int, int)；</li>
<li>Unpooled.unmodifiableBuffer(…)；</li>
<li>order(ByteOrder)；</li>
<li>readSlice(int)。</li>
</ul>
<ol start="8">
<li>复制<br>复制不同于派生，会复制出一个独立的ByteBuf，修改其中一个不会改变另一个。</li>
</ol>
<ul>
<li>copy</li>
</ul>
<ol start="9">
<li>释放</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 显式丢弃消息</span><br><span class="line">ReferenceCountUtil.release(msg);</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>增加引用计数防止释放</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReferenceCountUtil.retain(message)</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>其他api<br><img src="https://img-blog.csdnimg.cn/20191030095627667.png" alt="在这里插入图片描述"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly93czEuc2luYWltZy5jbi9sYXJnZS8wMDdoRjVRdWx5MWcxanBvMDlqaWRqMzBqdzA2c2FicC5qcGc?x-oss-process=image/format,png"></li>
</ol>
<h3 id="ByteBufHolder"><a href="#ByteBufHolder" class="headerlink" title="ByteBufHolder"></a>ByteBufHolder</h3><ol>
<li>目的<br>再数据处理的过程中不仅仅有字节数据内容本身，还会有一些附加信息，比如HTTP响应的状态码，Cookie等。<strong>给ByteBuf附加信息就要用到ByteBufHolder</strong>.</li>
<li>API<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly93czEuc2luYWltZy5jbi9sYXJnZS8wMDdoRjVRdWx5MWcxanB0Z2Z2MTBqMzBqaTA0MmFheS5qcGc?x-oss-process=image/format,png"></li>
</ol>
<h3 id="管理ByteBuffer"><a href="#管理ByteBuffer" class="headerlink" title="管理ByteBuffer"></a>管理ByteBuffer</h3><ol>
<li><p>按需分配 ByteBufAllocator<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly93czEuc2luYWltZy5jbi9sYXJnZS8wMDdoRjVRdWx5MWcxanB3NW96NmhqMzBrMzBhdWFjei5qcGc?x-oss-process=image/format,png"><br>注意分配是池化的，最大程度上降低分配和释放内存的开销。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 获取Allocator</span><br><span class="line">// 1</span><br><span class="line">IChannelHandlerContext ctx = null;</span><br><span class="line">IByteBufferAllocator allocator = ctx.Allocator;</span><br><span class="line">// 2</span><br><span class="line">IChannel channel = null;</span><br><span class="line">allocator = channel.Allocator;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>有两种ByteBufAllocator的实现：PooledByteBufAllocator和UnpooledByteBufAllocator，前者池化了ByteBuf的实例，极大限度的提升了性能减少了内存碎片。<br>2. Unpooled缓冲区<br>获取不到 ByteBufAllocator的引用的时候我们可以使用Unpooled工具类来操作ByteBuf。<br><img src="https://img-blog.csdnimg.cn/20191030103446350.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L254eV93dWhhbw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ol start="3">
<li>ByteBufUtil<br>这个类提供了一些通用的API，都是静态的辅助方法，例如hexdump方法可以以十六进制的方式打印ByteBuf的内容。还有equal方法判断bytebuf是否相等。</li>
</ol>
<h3 id="引用计数"><a href="#引用计数" class="headerlink" title="引用计数"></a>引用计数</h3><ol>
<li><p>目的</p>
<p>ByteBuf和ByteBufHolder都有计数的机制。引用计数都从1开始，如果计数大于0则不被释放，如果等于0就会被释放。它的目的是为了支持池化的实现，降低了内存分配的开销。</p>
</li>
<li><p>异常</p>
<p>如果访问一个计数为0的对象就会引发IllegalReferenceCountException。</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/10/31/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/DotNetty%E7%B3%BB%E5%88%97%E4%B8%89%EF%BC%9A%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81%E5%99%A8,IdleStateHandler%E5%BF%83%E8%B7%B3%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/31/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/DotNetty%E7%B3%BB%E5%88%97%E4%B8%89%EF%BC%9A%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81%E5%99%A8,IdleStateHandler%E5%BF%83%E8%B7%B3%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">DotNetty系列三：编码解码器,IdleStateHandler心跳机制</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-31 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-31T00:00:00+08:00">2019-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:24" itemprop="dateModified" datetime="2025-09-09T08:40:24+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">编程技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/" itemprop="url" rel="index"><span itemprop="name">DotNet</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">DotNetty教程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="DotNetty系列三：编码解码器-IdleStateHandler心跳机制"><a href="#DotNetty系列三：编码解码器-IdleStateHandler心跳机制" class="headerlink" title="DotNetty系列三：编码解码器,IdleStateHandler心跳机制"></a>DotNetty系列三：编码解码器,IdleStateHandler心跳机制</h1><blockquote>
<h2 id="Excerpt"><a href="#Excerpt" class="headerlink" title="Excerpt"></a>Excerpt</h2><p>在上一节基础上，实现编码解码器。1.创建一个类库项目。用于实现编码解码器。编码器：    public class CommonServerEncoder : MessageToByteEncoder&lt;string&gt;    {        protected override void Encode(IChannelHandlerContext context, s…</p>
</blockquote>
<hr>
<p>在上一节基础上，实现编码<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%A7%A3%E7%A0%81&spm=1001.2101.3001.7020">解码</a>器。</p>
<p>1.创建一个类库项目。用于实现编码解码器。<img src="https://img-blog.csdnimg.cn/20190223162503435.png"></p>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%BC%96%E7%A0%81%E5%99%A8&spm=1001.2101.3001.7020">编码器</a>：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CommonServerEncoder</span> : <span class="title">MessageToByteEncoder</span>&lt;<span class="title">string</span>&gt;    </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Encode</span>(<span class="params">IChannelHandlerContext context, <span class="built_in">string</span> message, IByteBuffer output</span>)</span>        </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">byte</span>[] messageBytes = Encoding.UTF8.GetBytes(message);            </span><br><span class="line">        IByteBuffer initialMessage = Unpooled.Buffer(messageBytes.Length);            </span><br><span class="line">        initialMessage.WriteBytes(messageBytes);            </span><br><span class="line">        output.WriteBytes(initialMessage);        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CommonClientEncoder</span> : <span class="title">MessageToByteEncoder</span>&lt;<span class="title">string</span>&gt;    </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Encode</span>(<span class="params">IChannelHandlerContext context, <span class="built_in">string</span> message, IByteBuffer output</span>)</span>        </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">byte</span>[] messageBytes = Encoding.UTF8.GetBytes(message);            </span><br><span class="line">        IByteBuffer initialMessage = Unpooled.Buffer(messageBytes.Length);            </span><br><span class="line">        initialMessage.WriteBytes(messageBytes);            </span><br><span class="line">        output.WriteBytes(initialMessage);        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解码器：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CommonServerDecoder</span> : <span class="title">ByteToMessageDecoder</span>    </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Decode</span>(<span class="params">IChannelHandlerContext context, IByteBuffer input, List&lt;<span class="built_in">object</span>&gt; output</span>)</span>        </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">byte</span>[] array = <span class="keyword">new</span> <span class="built_in">byte</span>[input.ReadableBytes];            </span><br><span class="line">        input.GetBytes(input.ReaderIndex, array, <span class="number">0</span>, input.ReadableBytes);            </span><br><span class="line">        input.Clear();            </span><br><span class="line">        output.Add(array);        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CommonClientDecoder</span> : <span class="title">ByteToMessageDecoder</span>    </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Decode</span>(<span class="params">IChannelHandlerContext context, IByteBuffer input, List&lt;<span class="built_in">object</span>&gt; output</span>)</span>        </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">byte</span>[] array = <span class="keyword">new</span> <span class="built_in">byte</span>[input.ReadableBytes];            </span><br><span class="line">        input.GetBytes(input.ReaderIndex, array, <span class="number">0</span>, input.ReadableBytes);            </span><br><span class="line">        input.Clear();            </span><br><span class="line">        output.Add(array);        </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.服务端里添加：</p>
<p>                        &#x2F;&#x2F;配置编码解码器<br>                        pipeline.AddLast(new CommonServerEncoder());<br>                        pipeline.AddLast(new CommonServerDecoder());</p>
<p>客户端里添加：</p>
<p>                        &#x2F;&#x2F;配置编码解码器<br>                        pipeline.AddLast(new CommonClientEncoder());<br>                        pipeline.AddLast(new CommonClientDecoder());</p>
<p>3.服务端接收和发送：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ChannelRead</span>(<span class="params">IChannelHandlerContext context, <span class="built_in">object</span> message</span>)</span>        </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (message <span class="keyword">is</span> <span class="built_in">byte</span>[] o)            </span><br><span class="line">    &#123;                </span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;解码器方式，从客户端接收:<span class="subst">&#123;Encoding.UTF8.GetString(o)&#125;</span>:<span class="subst">&#123;DateTime.Now&#125;</span>&quot;</span>);           </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;服务端从客户端接收到内容后返回，我是服务端&quot;</span>;            </span><br><span class="line">    context.WriteAsync(msg);        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>客户端接收和发送：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ChannelActive</span>(<span class="params">IChannelHandlerContext context</span>)</span>        </span><br><span class="line">&#123;           </span><br><span class="line">    Console.WriteLine(<span class="string">&quot;我是客户端.&quot;</span>);           </span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;连接至服务端<span class="subst">&#123;context&#125;</span>.&quot;</span>);</span><br><span class="line">    <span class="built_in">string</span> message = <span class="string">&quot;客户端1&quot;</span>;            </span><br><span class="line">    context.WriteAndFlushAsync(message);        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ChannelRead</span>(<span class="params">IChannelHandlerContext context, <span class="built_in">object</span> message</span>)</span>        </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (message <span class="keyword">is</span> <span class="built_in">byte</span>[] o)            </span><br><span class="line">    &#123;                </span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;解码器方式，从服务端接收:<span class="subst">&#123;Encoding.UTF8.GetString(o)&#125;</span>:<span class="subst">&#123;DateTime.Now&#125;</span>&quot;</span>);            </span><br><span class="line">    &#125;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现了上一节一样的效果。</p>
<p>4.IdleStateHandler心跳机制:</p>
<p>4.1服务端添加IdleStateHandler心跳检测处理器,添加自定义处理<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Handler&spm=1001.2101.3001.7020">Handler</a>类实现userEventTriggered()方法作为超时事件的逻辑处理.</p>
<p>IdleStateHandler心跳检测每十五秒进行一次读检测，如果十五秒内ChannelRead()方法未被调用则触发一次userEventTrigger()方法.</p>
<p>                        &#x2F;&#x2F; IdleStateHandler 心跳<br>                        &#x2F;&#x2F;服务端为读IDLE<br>                        pipeline.AddLast(new IdleStateHandler(15, 0, 0));&#x2F;&#x2F;第一个参数为读，第二个为写，第三个为读写全部</p>
<p>4.2服务端Handler重载UserEventTriggered：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> lossConnectCount = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">UserEventTriggered</span>(<span class="params">IChannelHandlerContext context, <span class="built_in">object</span> evt</span>)</span>        &#123;            </span><br><span class="line">    Console.WriteLine(<span class="string">&quot;已经15秒未收到客户端的消息了！&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (evt <span class="keyword">is</span> IdleStateEvent eventState)            </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventState.State == IdleState.ReaderIdle)               </span><br><span class="line">        &#123;                   </span><br><span class="line">            lossConnectCount++;<span class="keyword">if</span> (lossConnectCount &gt; <span class="number">2</span>)                    </span><br><span class="line">            &#123;                        </span><br><span class="line">                Console.WriteLine(<span class="string">&quot;关闭这个不活跃通道！&quot;</span>);                        </span><br><span class="line">                context.CloseAsync();                   </span><br><span class="line">            &#125;                &#125;            </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>            </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.UserEventTriggered(context, evt);            </span><br><span class="line">    &#125;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接收部分改为判断心跳：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ChannelRead</span>(<span class="params">IChannelHandlerContext context, <span class="built_in">object</span> message</span>)</span>        </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (message <span class="keyword">is</span> <span class="built_in">byte</span>[] o)            </span><br><span class="line">    &#123;                </span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;解码器方式，从客户端接收:<span class="subst">&#123;Encoding.UTF8.GetString(o)&#125;</span>:<span class="subst">&#123;DateTime.Now&#125;</span>&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (Encoding.UTF8.GetString(o).Contains(<span class="string">&quot;biubiu:&quot;</span>))                </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> temp = <span class="string">&quot;服务端接收到心跳连接&quot;</span>;                    </span><br><span class="line">            context.WriteAsync(temp);<span class="keyword">return</span>;                </span><br><span class="line">        &#125;            </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">string</span> msg = <span class="string">&quot;服务端从客户端接收到内容后返回，我是服务端&quot;</span>;            </span><br><span class="line">    context.WriteAsync(msg);       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.3客户端添加IdleStateHandler心跳检测处理器，并添加自定义处理Handler类实现userEventTriggered()方法作为超时事件的逻辑处理；</p>
<p>设定IdleStateHandler心跳检测每十秒进行一次写检测，如果十秒内write()方法未被调用则触发一次userEventTrigger()方法，实现客户端每十秒向服务端发送一次消息；</p>
<p>                        &#x2F;&#x2F; IdleStateHandler 心跳<br>                        &#x2F;&#x2F;客户端为写IDLE<br>                        pipeline.AddLast(new IdleStateHandler(0, 10, 0));&#x2F;&#x2F;第一个参数为读，第二个为写，第三个为读写全部</p>
<p>4.4客户端Handler重载UserEventTriggered：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">UserEventTriggered</span>(<span class="params">IChannelHandlerContext context, <span class="built_in">object</span> evt</span>)</span>        &#123;           </span><br><span class="line">    Console.WriteLine(<span class="string">&quot;客户端循环心跳监测发送: &quot;</span> + DateTime.Now);</span><br><span class="line">    <span class="keyword">if</span> (evt <span class="keyword">is</span> IdleStateEvent eventState)            </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventState.State == IdleState.WriterIdle)                </span><br><span class="line">        &#123;                    </span><br><span class="line">            context.WriteAndFlushAsync(<span class="string">$&quot;biubiu:<span class="subst">&#123;DateTime.Now&#125;</span>&quot;</span>);         </span><br><span class="line">        &#125;           </span><br><span class="line">    &#125;       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.5实现效果：<img src="https://img-blog.csdnimg.cn/20190223165920231.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0NzE5MTY4,size_16,color_FFFFFF,t_70"></p>
<p>5.群发：将客户端上下线通知，群发至所有客户端。只在服务端修改</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> IChannelGroup groups;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">HandlerAdded</span>(<span class="params">IChannelHandlerContext context</span>)</span>        </span><br><span class="line">&#123;            </span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;客户端<span class="subst">&#123;context&#125;</span>上线.&quot;</span>);</span><br><span class="line">                                                                          </span><br><span class="line">    <span class="keyword">base</span>.HandlerAdded(context);            </span><br><span class="line">    IChannelGroup g = groups;<span class="keyword">if</span> (g == <span class="literal">null</span>)            </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">lock</span> (<span class="keyword">this</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (groups == <span class="literal">null</span>)                    </span><br><span class="line">            &#123;                        </span><br><span class="line">                g = groups = <span class="keyword">new</span> DefaultChannelGroup(context.Executor);</span><br><span class="line">            &#125;               </span><br><span class="line">        &#125;            </span><br><span class="line">    &#125;           </span><br><span class="line">    g.Add(context.Channel);            </span><br><span class="line">    groups.WriteAndFlushAsync(<span class="string">$&quot;欢迎<span class="subst">&#123;context.Channel.RemoteAddress&#125;</span>加入.&quot;</span>);        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">HandlerRemoved</span>(<span class="params">IChannelHandlerContext context</span>)</span>        </span><br><span class="line">&#123;            </span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;客户端<span class="subst">&#123;context&#125;</span>下线.&quot;</span>);</span><br><span class="line">    <span class="keyword">base</span>.HandlerRemoved(context);            </span><br><span class="line">    groups.Remove(context.Channel);            </span><br><span class="line">    groups.WriteAndFlushAsync(<span class="string">$&quot;恭送<span class="subst">&#123;context.Channel.RemoteAddress&#125;</span>离开.&quot;</span>);       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现效果：</p>
<p><img src="https://img-blog.csdnimg.cn/20190223172542736.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0NzE5MTY4,size_16,color_FFFFFF,t_70"></p>
<p>项目下载地址：<a target="_blank" rel="noopener" href="https://download.csdn.net/download/qq_34719168/10972203">项目下载</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/10/31/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/DotNetty%E5%AE%8C%E5%85%A8%E6%95%99%E7%A8%8B%EF%BC%88%E4%B9%9D%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/31/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/DotNetty%E5%AE%8C%E5%85%A8%E6%95%99%E7%A8%8B%EF%BC%88%E4%B9%9D%EF%BC%89/" class="post-title-link" itemprop="url">DotNetty完全教程（九）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-31 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-31T00:00:00+08:00">2019-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:24" itemprop="dateModified" datetime="2025-09-09T08:40:24+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">编程技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/" itemprop="url" rel="index"><span itemprop="name">DotNet</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/DotNet/DotNetty%E6%95%99%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">DotNetty教程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="DotNetty完全教程（九）"><a href="#DotNetty完全教程（九）" class="headerlink" title="DotNetty完全教程（九）"></a>DotNetty完全教程（九）</h1><blockquote>
<h2 id="Excerpt"><a href="#Excerpt" class="headerlink" title="Excerpt"></a>Excerpt</h2><p>引导Bootstrap引导一个应用程序是指对他进行配置并且使他运行的过程。体系结构注意，DotNetty没有实现Cloneable的接口，而是直接实现了一个Clone方法。Netty实现这个接口是为了创建两个有着相同配置的应用程序，可以把一个配置整体应用到另一个上面，需要注意的是EventLoopGroup是一个浅拷贝，这就导致了拷贝的Bootstrap都会使用同一个EventLoopGr…</p>
</blockquote>
<hr>
<h2 id="引导Bootstrap"><a href="#引导Bootstrap" class="headerlink" title="引导Bootstrap"></a>引导<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Bootstrap&spm=1001.2101.3001.7020">Bootstrap</a></h2><p>引导一个应用程序是指对他进行配置并且使他运行的过程。</p>
<h3 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84&spm=1001.2101.3001.7020">体系结构</a></h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly93czEuc2luYWltZy5jbi9sYXJnZS8wMDdoRjVRdWx5MWcxbzQzMnVqZDZqMzBpZTA3YmFhYy5qcGc?x-oss-process=image/format,png"><br>注意，DotNetty没有实现Cloneable的接口，而是直接实现了一个Clone方法。Netty实现这个接口是为了创建两个有着相同配置的应用程序，可以把一个配置整体应用到另一个上面，需要注意的是EventLoopGroup是一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%B5%85%E6%8B%B7%E8%B4%9D&spm=1001.2101.3001.7020">浅拷贝</a>，这就导致了拷贝的Bootstrap都会使用同一个EventLoopGroup，这在每个Channel生命周期很短的时候是没有太大影响的。</p>
<p>服务器引导和普通引导有什么区别呢？区别在于，服务器接收到客户端的连接请求，会用一个Channel接受连接，然后用另一个Channel与客户端进行交流，但是客户端只需要一个Channel就可以与服务器进行交互。</p>
<h3 id="关于链式调用"><a href="#关于链式调用" class="headerlink" title="关于链式调用"></a>关于链式调用</h3><p>我们发现Bootstrap类可以通过流式语法进行链式调用，这要归功于Bootstrap类的特殊定义。下面我们来看一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// 定义</span><br><span class="line">public abstract class AbstractBootstrap&lt;TBootstrap, TChannel&gt;</span><br><span class="line">    where TBootstrap : AbstractBootstrap&lt;TBootstrap, TChannel&gt;</span><br><span class="line">    where TChannel : IChannel</span><br><span class="line">// 定义子类</span><br><span class="line">public class Bootstrap : AbstractBootstrap&lt;Bootstrap, IChannel&gt;</span><br><span class="line">// 方法实现</span><br><span class="line">public virtual TBootstrap Group(IEventLoopGroup group)</span><br><span class="line">&#123;</span><br><span class="line">    Contract.Requires(group != null);</span><br><span class="line"></span><br><span class="line">    if (this.group != null)</span><br><span class="line">    &#123;</span><br><span class="line">        throw new InvalidOperationException(&quot;group has already been set.&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    this.group = group;</span><br><span class="line">    return (TBootstrap)this;</span><br><span class="line">&#125;</span><br><span class="line">// 使用</span><br><span class="line">var bootstrap = new Bootstrap();</span><br><span class="line">bootstrap</span><br><span class="line">    .Group(group)</span><br><span class="line">    .Channel&lt;TcpSocketChannel&gt;()</span><br><span class="line">    .Handler(new ActionChannelInitializer&lt;ISocketChannel&gt;(channel =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        IChannelPipeline pipeline = channel.Pipeline;</span><br><span class="line">        pipeline.AddLast(new EchoClientHandler());</span><br><span class="line">    &#125;));</span><br></pre></td></tr></table></figure>

<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly93czEuc2luYWltZy5jbi9sYXJnZS8wMDdoRjVRdWx5MWcxbzRtNG1va3NqMzBqODBmNHdrMC5qcGc?x-oss-process=image/format,png"><br><img src="https://img-blog.csdnimg.cn/20191030154635566.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L254eV93dWhhbw==,size_16,color_FFFFFF,t_70" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-KF8h1wnu-1572421399290)(https://ws1.sinaimg.cn/large/007hF5Quly1g1o4mltliij30jr05mabe.jpg)]"></p>
<h3 id="客户端引导"><a href="#客户端引导" class="headerlink" title="客户端引导"></a>客户端引导</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var group = new MultithreadEventLoopGroup();</span><br><span class="line">var bootstrap = new Bootstrap();</span><br><span class="line">bootstrap</span><br><span class="line">    .Group(group)</span><br><span class="line">    .Channel&lt;TcpSocketChannel&gt;()</span><br><span class="line">    .Handler(new ActionChannelInitializer&lt;ISocketChannel&gt;(channel =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        IChannelPipeline pipeline = channel.Pipeline;</span><br><span class="line">        pipeline.AddLast(new EchoClientHandler());</span><br><span class="line">    &#125;));</span><br><span class="line">IChannel clientChannel = await bootstrap.ConnectAsync(new IPEndPoint(IPAddress.Parse(&quot;10.10.10.158&quot;), 3000));</span><br><span class="line">Console.ReadLine();</span><br><span class="line">await clientChannel.CloseAsync();</span><br></pre></td></tr></table></figure>

<h3 id="服务器引导"><a href="#服务器引导" class="headerlink" title="服务器引导"></a>服务器引导</h3><p>API：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly93czEuc2luYWltZy5jbi9sYXJnZS8wMDdoRjVRdWx5MWcxbzUxNmJvcnJqMzBrZjBoeG40OS5qcGc?x-oss-process=image/format,png"><br>注意上面箭头指示的是与Bootstrap不一样的方法。<br>为什么会有子Channel的概念呢，我们看下面这个图：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly93czEuc2luYWltZy5jbi9sYXJnZS8wMDdoRjVRdWx5MWcxcWQzeGp5YTBqMzBpZDA3ZmdtaS5qcGc?x-oss-process=image/format,png"><br>因为服务器是一对多的，所以有子Channel的概念。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">IEventLoopGroup eventLoop;</span><br><span class="line">eventLoop = new MultithreadEventLoopGroup();</span><br><span class="line">try</span><br><span class="line">&#123;</span><br><span class="line">    // 服务器引导程序</span><br><span class="line">    var bootstrap = new ServerBootstrap();</span><br><span class="line">    bootstrap.Group(eventLoop);</span><br><span class="line">    bootstrap.Channel&lt;TcpServerSocketChannel&gt;();</span><br><span class="line">    bootstrap.ChildHandler(new ActionChannelInitializer&lt;IChannel&gt;(channel =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        IChannelPipeline pipeline = channel.Pipeline;</span><br><span class="line">        pipeline.AddLast(new EchoServerHandler());</span><br><span class="line">    &#125;));</span><br><span class="line">    IChannel boundChannel = await bootstrap.BindAsync(3000);</span><br><span class="line">    Console.ReadLine();</span><br><span class="line">    await boundChannel.CloseAsync();</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception ex)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(ex);</span><br><span class="line">&#125;</span><br><span class="line">finally</span><br><span class="line">&#123;</span><br><span class="line">    await eventLoop.ShutdownGracefullyAsync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从Channel中引导客户端"><a href="#从Channel中引导客户端" class="headerlink" title="从Channel中引导客户端"></a>从Channel中引导客户端</h3><ul>
<li><p>场景</p>
<p>如果我们的服务器需要去第三方获取数据，这时候服务器就需要充当客户端去第三方取数据，这时候就需要在Channel中再开一个客户端获取数据。</p>
</li>
<li><p>方式</p>
<p>我们最好是从Channel中获取当前EventLoop，这样新开的客户端就跟当前Channel在一个线程中，减少了线程切换带来的开销，尽可能的重用了EventLoop</p>
</li>
<li><p>实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 从Context创建客户端引导</span><br><span class="line">var bootstrap = new Bootstrap();</span><br><span class="line">bootstrap.Group(ctx.Channel.EventLoop);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="初始化Pipeline"><a href="#初始化Pipeline" class="headerlink" title="初始化Pipeline"></a>初始化Pipeline</h3><p>如果要添加的Handler不止一个，我们就需要用到ChannelInitializer，在DotNetty中，我们有十分简单的方法可以初始化一个pipeline</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">var bootstrap = new Bootstrap();</span><br><span class="line">bootstrap</span><br><span class="line">    .Group(group)</span><br><span class="line">    .Channel&lt;TcpSocketChannel&gt;()</span><br><span class="line">    .Option(ChannelOption.TcpNodelay, true)</span><br><span class="line">    .Handler(new ActionChannelInitializer&lt;ISocketChannel&gt;(channel =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        IChannelPipeline pipeline = channel.Pipeline;</span><br><span class="line"></span><br><span class="line">        if (cert != null)</span><br><span class="line">        &#123;</span><br><span class="line">            pipeline.AddLast(&quot;tls&quot;, new TlsHandler(stream =&gt; new SslStream(stream, true, (sender, certificate, chain, errors) =&gt; true), new ClientTlsSettings(targetHost)));</span><br><span class="line">        &#125;</span><br><span class="line">        pipeline.AddLast(new LoggingHandler());</span><br><span class="line">        pipeline.AddLast(&quot;framing-enc&quot;, new LengthFieldPrepender(2));</span><br><span class="line">        pipeline.AddLast(&quot;framing-dec&quot;, new LengthFieldBasedFrameDecoder(ushort.MaxValue, 0, 2, 0, 2));</span><br><span class="line"></span><br><span class="line">        pipeline.AddLast(&quot;echo&quot;, new EchoClientHandler());</span><br><span class="line">    &#125;));</span><br></pre></td></tr></table></figure>

<h3 id="ChannelOption"><a href="#ChannelOption" class="headerlink" title="ChannelOption"></a>ChannelOption</h3><p>ChannelOption可以在引导的时候将设置批量的设置到所有Channel上，而不必要在每一个Channel建立的时候手动的去指定它的配置，应用场景是比如设置KeepAlive或者设置超时时间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bootstrap.Option(ChannelOption.SoKeepalive, true)</span><br><span class="line">    .Option(ChannelOption.ConnectTimeout, new TimeSpan(5000));</span><br></pre></td></tr></table></figure>

<h3 id="面向无连接的用户数据报文"><a href="#面向无连接的用户数据报文" class="headerlink" title="面向无连接的用户数据报文"></a>面向无连接的用户数据报文</h3><p>UDP的全称是“User Datagram Protocol”，在DotNetty中实现了SocketDatagramChannel来创建无连接的引导，需要注意的是无连接的引导不需要Connect只需要bind即可，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var bootstrap = new Bootstrap();</span><br><span class="line">bootstrap</span><br><span class="line">    .Group(group)</span><br><span class="line">    .Channel&lt;SocketDatagramChannel&gt;()</span><br><span class="line">    .Option(ChannelOption.SoBroadcast, true)</span><br><span class="line">    .Handler(new ActionChannelInitializer&lt;IChannel&gt;(channel =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        channel.Pipeline.AddLast(&quot;Quote&quot;, new QuoteOfTheMomentClientHandler());</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">IChannel clientChannel = await bootstrap.BindAsync(IPEndPoint.MinPort);</span><br></pre></td></tr></table></figure>

<h3 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h3><p>Channel的关闭：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await clientChannel.CloseAsync();</span><br></pre></td></tr></table></figure>

<p>EventLoopGroup的关闭：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">await group.ShutdownGracefullyAsync();</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/08/04/Linux/wpa_supplicant%E5%8F%8Awpa_cli%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/04/Linux/wpa_supplicant%E5%8F%8Awpa_cli%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">wpa_supplicant及wpa_cli使用方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-04 10:47:25" itemprop="dateCreated datePublished" datetime="2019-08-04T10:47:25+08:00">2019-08-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:23" itemprop="dateModified" datetime="2025-09-09T08:40:23+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>wpa_supplicant</code>是一个连接、配置<code>WIFI</code>的工具，它主要包含<code>wpa_supplicant</code>与<code>wpa_cli</code>两个程序。通常情况下，可以通过<code>wpa_cli</code>来进行<code>WIFI</code>的配置与连接，如果有特殊的需要，可以编写应用程序直接调用<code>wpa_supplicant</code>的接口直接开发。</p>
<h2 id="启动wpa-supplicant应用"><a href="#启动wpa-supplicant应用" class="headerlink" title="启动wpa_supplicant应用"></a>启动<code>wpa_supplicant</code>应用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">wpa_supplicant -D nl80211 -i wlan0 -c /etc/wpa_supplicant.conf -B</span></span><br></pre></td></tr></table></figure>

<p><code>/etc/wpa_supplicant.conf</code>文件里，添加下面代码:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ctrl_interface</span>=/var/run/wpa_supplicant update_config=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="启动wpa-cli应用"><a href="#启动wpa-cli应用" class="headerlink" title="启动wpa_cli应用"></a>启动<code>wpa_cli</code>应用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wpa_cli -i wlan0 scan <span class="comment"># 搜索附近wifi网络 </span></span><br><span class="line">$ wpa_cli -i wlan0 scan_result <span class="comment"># 打印搜索wifi网络结果 </span></span><br><span class="line">$ wpa_cli -i wlan0 add_network <span class="comment"># 添加一个网络连接</span></span><br></pre></td></tr></table></figure>

<p>如果要连接加密方式是<code>[WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][ESS]</code> (<code>wpa</code>加密)，<code>wifi</code>名称是<code>name</code>，<code>wifi</code>密码是：<code>psk</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wpa_cli -i wlan0 set_network 0 ssid <span class="string">&#x27;&quot;name&quot;&#x27;</span> </span><br><span class="line">$ wpa_cli -i wlan0 set_network 0 psk <span class="string">&#x27;&quot;psk&quot;&#x27;</span> </span><br><span class="line">$ wpa_cli -i wlan0 enable_network 0</span><br></pre></td></tr></table></figure>

<p>如果要连接加密方式是<code>[WEP][ESS]</code> (<code>wep</code>加密)，<code>wifi</code>名称是<code>name</code>，<code>wifi</code>密码是<code>psk</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wpa_cli -i wlan0 set_network 0 ssid <span class="string">&#x27;&quot;name&quot;&#x27;</span> </span><br><span class="line">$ wpa_cli -i wlan0 set_network 0 key_mgmt NONE </span><br><span class="line">$ wpa_cli -i wlan0 set_network 0 wep_key0 <span class="string">&#x27;&quot;psk&quot;&#x27;</span> </span><br><span class="line">$ wpa_cli -i wlan0 enable_network 0</span><br></pre></td></tr></table></figure>

<p>如果要连接加密方式是<code>[ESS]</code> (无加密)，<code>wifi</code>名称是<code>name</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wpa_cli -i wlan0 set_network 0 ssid <span class="string">&#x27;&quot;name&quot;&#x27;</span> </span><br><span class="line">$ wpa_cli -i wlan0 set_network 0 key_mgmt NONE </span><br><span class="line">$ wpa_cli -i wlan0 enable_network 0</span><br></pre></td></tr></table></figure>

<h2 id="分配ip-netmask-gateway-dns"><a href="#分配ip-netmask-gateway-dns" class="headerlink" title="分配ip/netmask/gateway/dns"></a>分配<code>ip/netmask/gateway/dns</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">udhcpc -i wlan0 -s /etc/udhcpc.script -q</span></span><br></pre></td></tr></table></figure>

<p>执行完毕，就可以连接网络了。</p>
<h2 id="保存连接"><a href="#保存连接" class="headerlink" title="保存连接"></a>保存连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wpa_cli -i wlan0 save_config</span><br></pre></td></tr></table></figure>

<h2 id="断开连接"><a href="#断开连接" class="headerlink" title="断开连接"></a>断开连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wpa_cli -i wlan0 disable_network 0</span><br></pre></td></tr></table></figure>

<h2 id="连接已有的连接"><a href="#连接已有的连接" class="headerlink" title="连接已有的连接"></a>连接已有的连接</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wpa_cli -i wlan0 list_network <span class="comment">#列举所有保存的连接 </span></span><br><span class="line">$ wpa_cli -i wlan0 select_network 0 <span class="comment">#连接第1个保存的连接 </span></span><br><span class="line">$ wpa_cli -i wlan0 enable_network 0 <span class="comment">#使能第1个保存的连接</span></span><br></pre></td></tr></table></figure>

<h2 id="断开wifi"><a href="#断开wifi" class="headerlink" title="断开wifi"></a>断开<code>wifi</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig wlan0 down </span><br><span class="line">$ killall udhcpc </span><br><span class="line">$ killall wpa_supplicant</span><br></pre></td></tr></table></figure>

<h2 id="wpa-wifi-tool使用方法"><a href="#wpa-wifi-tool使用方法" class="headerlink" title="wpa_wifi_tool使用方法"></a><code>wpa_wifi_tool</code>使用方法</h2><p><code>wpa_wifi_tool</code>是基于<code>wpa_supplicant</code>及<code>wpa_cli</code>的一个用于快速设置<code>wifi</code>的工具，方便调试时连接<code>wifi</code>使用。使用方法：1、运行<code>wpa_wifi_tool</code>;2、输入<code>help</code>进行命令查看;3、<code>s</code>进行<code>SSID</code>扫描;4、<code>c[n]</code>进行<code>wifi</code>连接，连接时若为新的<code>SSID</code>则需输入密码，若为已保存的<code>SSID</code>则可以使用保存过的密码或者重新输入密码;5、<code>e</code>退出工具。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/08/03/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/InfluxDB%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/08/03/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/InfluxDB%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Windows InfluxDB 安装与配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-08-03 00:00:00" itemprop="dateCreated datePublished" datetime="2019-08-03T00:00:00+08:00">2019-08-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:24" itemprop="dateModified" datetime="2025-09-09T08:40:24+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/" itemprop="url" rel="index"><span itemprop="name">InfluxDB</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一、下载链接<a target="_blank" rel="noopener" href="https://portal.influxdata.com/downloads">https://portal.influxdata.com/downloads</a>，选windows版</p>
<p>二、解压到安装盘，目录如下</p>
<img src="/2019/08/03/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/InfluxDB%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/IMG-20250704185714467.png" class="">

<p>三、修改conf文件，代码如下，直接复制粘贴（1.4.2版本），注意修改路径，带D盘的改为你的安装路径就好，一共三个，注意网上有配置admin进行web管理，但新版本配置文件里没有admin因为官方给删除了，需下载Chronograf，后文会介绍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br></pre></td><td class="code"><pre><span class="line">### Welcome to the InfluxDB configuration file.</span><br><span class="line"></span><br><span class="line"># The values in this file override the default values used by the system if</span><br><span class="line"># a config option is not specified. The commented out lines are the configuration</span><br><span class="line"># field and the default value used. Uncommenting a line and changing the value</span><br><span class="line"># will change the value used at runtime when the process is restarted.</span><br><span class="line"></span><br><span class="line"># Once every 24 hours InfluxDB will report usage data to usage.influxdata.com</span><br><span class="line"># The data includes a random ID, os, arch, version, the number of series and other</span><br><span class="line"># usage data. No data from user databases is ever transmitted.</span><br><span class="line"># Change this option to true to disable reporting.</span><br><span class="line"># reporting-disabled = false</span><br><span class="line"></span><br><span class="line"># Bind address to use for the RPC service for backup and restore.</span><br><span class="line"># bind-address = &quot;127.0.0.1:8088&quot;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [meta]</span><br><span class="line">###</span><br><span class="line">### Controls the parameters for the Raft consensus group that stores metadata</span><br><span class="line">### about the InfluxDB cluster.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[meta]</span><br><span class="line">  # Where the metadata/raft database is stored</span><br><span class="line">  dir = &quot;D:/influxdb-1.4.2-1/meta&quot;</span><br><span class="line"></span><br><span class="line">  # Automatically create a default retention policy when creating a database.</span><br><span class="line">    retention-autocreate = true</span><br><span class="line"></span><br><span class="line">  # If log messages are printed for the meta service</span><br><span class="line">    logging-enabled = true</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [data]</span><br><span class="line">###</span><br><span class="line">### Controls where the actual shard data for InfluxDB lives and how it is</span><br><span class="line">### flushed from the WAL. &quot;dir&quot; may need to be changed to a suitable place</span><br><span class="line">### for your system, but the WAL settings are an advanced configuration. The</span><br><span class="line">### defaults should work for most systems.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[data]</span><br><span class="line">  # The directory where the TSM storage engine stores TSM files.</span><br><span class="line">  dir = &quot;D:/influxdb-1.4.2-1/data&quot;</span><br><span class="line"></span><br><span class="line">  # The directory where the TSM storage engine stores WAL files.</span><br><span class="line">  wal-dir = &quot;D:/influxdb-1.4.2-1/wal&quot;</span><br><span class="line"></span><br><span class="line">  # The amount of time that a write will wait before fsyncing.  A duration</span><br><span class="line">  # greater than 0 can be used to batch up multiple fsync calls.  This is useful for slower</span><br><span class="line">  # disks or when WAL write contention is seen.  A value of 0s fsyncs every write to the WAL.</span><br><span class="line">  # Values in the range of 0-100ms are recommended for non-SSD disks.</span><br><span class="line">  # wal-fsync-delay = &quot;0s&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  # The type of shard index to use for new shards.  The default is an in-memory index that is</span><br><span class="line">  # recreated at startup.  A value of &quot;tsi1&quot; will use a disk based index that supports higher</span><br><span class="line">  # cardinality datasets.</span><br><span class="line">  # index-version = &quot;inmem&quot;</span><br><span class="line"></span><br><span class="line">  # Trace logging provides more verbose output around the tsm engine. Turning</span><br><span class="line">  # this on can provide more useful output for debugging tsm engine issues.</span><br><span class="line">  # trace-logging-enabled = false</span><br><span class="line"></span><br><span class="line">  # Whether queries should be logged before execution. Very useful for troubleshooting, but will</span><br><span class="line">  # log any sensitive data contained within a query.</span><br><span class="line">    query-log-enabled = true</span><br><span class="line"></span><br><span class="line">  # Settings for the TSM engine</span><br><span class="line"></span><br><span class="line">  # CacheMaxMemorySize is the maximum size a shard&#x27;s cache can</span><br><span class="line">  # reach before it starts rejecting writes.</span><br><span class="line">  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).</span><br><span class="line">  # Vaues without a size suffix are in bytes.</span><br><span class="line">  # cache-max-memory-size = &quot;1g&quot;</span><br><span class="line"></span><br><span class="line">  # CacheSnapshotMemorySize is the size at which the engine will</span><br><span class="line">  # snapshot the cache and write it to a TSM file, freeing up memory</span><br><span class="line">  # Valid size suffixes are k, m, or g (case insensitive, 1024 = 1k).</span><br><span class="line">  # Values without a size suffix are in bytes.</span><br><span class="line">  # cache-snapshot-memory-size = &quot;25m&quot;</span><br><span class="line"></span><br><span class="line">  # CacheSnapshotWriteColdDuration is the length of time at</span><br><span class="line">  # which the engine will snapshot the cache and write it to</span><br><span class="line">  # a new TSM file if the shard hasn&#x27;t received writes or deletes</span><br><span class="line">  # cache-snapshot-write-cold-duration = &quot;10m&quot;</span><br><span class="line"></span><br><span class="line">  # CompactFullWriteColdDuration is the duration at which the engine</span><br><span class="line">  # will compact all TSM files in a shard if it hasn&#x27;t received a</span><br><span class="line">  # write or delete</span><br><span class="line">  # compact-full-write-cold-duration = &quot;4h&quot;</span><br><span class="line"></span><br><span class="line">  # The maximum number of concurrent full and level compactions that can run at one time.  A</span><br><span class="line">  # value of 0 results in 50% of runtime.GOMAXPROCS(0) used at runtime.  Any number greater</span><br><span class="line">  # than 0 limits compactions to that value.  This setting does not apply</span><br><span class="line">  # to cache snapshotting.</span><br><span class="line">  # max-concurrent-compactions = 0</span><br><span class="line"></span><br><span class="line">  # The maximum series allowed per database before writes are dropped.  This limit can prevent</span><br><span class="line">  # high cardinality issues at the database level.  This limit can be disabled by setting it to</span><br><span class="line">  # 0.</span><br><span class="line">  # max-series-per-database = 1000000</span><br><span class="line"></span><br><span class="line">  # The maximum number of tag values per tag that are allowed before writes are dropped.  This limit</span><br><span class="line">  # can prevent high cardinality tag values from being written to a measurement.  This limit can be</span><br><span class="line">  # disabled by setting it to 0.</span><br><span class="line">  # max-values-per-tag = 100000</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [coordinator]</span><br><span class="line">###</span><br><span class="line">### Controls the clustering service configuration.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[coordinator]</span><br><span class="line">  # The default time a write request will wait until a &quot;timeout&quot; error is returned to the caller.</span><br><span class="line">  # write-timeout = &quot;10s&quot;</span><br><span class="line"></span><br><span class="line">  # The maximum number of concurrent queries allowed to be executing at one time.  If a query is</span><br><span class="line">  # executed and exceeds this limit, an error is returned to the caller.  This limit can be disabled</span><br><span class="line">  # by setting it to 0.</span><br><span class="line">  # max-concurrent-queries = 0</span><br><span class="line"></span><br><span class="line">  # The maximum time a query will is allowed to execute before being killed by the system.  This limit</span><br><span class="line">  # can help prevent run away queries.  Setting the value to 0 disables the limit.</span><br><span class="line">  # query-timeout = &quot;0s&quot;</span><br><span class="line"></span><br><span class="line">  # The time threshold when a query will be logged as a slow query.  This limit can be set to help</span><br><span class="line">  # discover slow or resource intensive queries.  Setting the value to 0 disables the slow query logging.</span><br><span class="line">  # log-queries-after = &quot;0s&quot;</span><br><span class="line"></span><br><span class="line">  # The maximum number of points a SELECT can process.  A value of 0 will make</span><br><span class="line">  # the maximum point count unlimited.  This will only be checked every second so queries will not</span><br><span class="line">  # be aborted immediately when hitting the limit.</span><br><span class="line">  # max-select-point = 0</span><br><span class="line"></span><br><span class="line">  # The maximum number of series a SELECT can run.  A value of 0 will make the maximum series</span><br><span class="line">  # count unlimited.</span><br><span class="line">  # max-select-series = 0</span><br><span class="line"></span><br><span class="line">  # The maxium number of group by time bucket a SELECT can create.  A value of zero will max the maximum</span><br><span class="line">  # number of buckets unlimited.</span><br><span class="line">  # max-select-buckets = 0</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [retention]</span><br><span class="line">###</span><br><span class="line">### Controls the enforcement of retention policies for evicting old data.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[retention]</span><br><span class="line">  # Determines whether retention policy enforcement enabled.</span><br><span class="line">    enabled = true</span><br><span class="line"></span><br><span class="line">  # The interval of time when retention policy enforcement checks run.</span><br><span class="line">    check-interval = &quot;30m&quot;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [shard-precreation]</span><br><span class="line">###</span><br><span class="line">### Controls the precreation of shards, so they are available before data arrives.</span><br><span class="line">### Only shards that, after creation, will have both a start- and end-time in the</span><br><span class="line">### future, will ever be created. Shards are never precreated that would be wholly</span><br><span class="line">### or partially in the past.</span><br><span class="line"></span><br><span class="line">[shard-precreation]</span><br><span class="line">  # Determines whether shard pre-creation service is enabled.</span><br><span class="line">    enabled = true</span><br><span class="line"></span><br><span class="line">  # The interval of time when the check to pre-create new shards runs.</span><br><span class="line">    check-interval = &quot;10m&quot;</span><br><span class="line"></span><br><span class="line">  # The default period ahead of the endtime of a shard group that its successor</span><br><span class="line">  # group is created.</span><br><span class="line">    advance-period = &quot;30m&quot;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### Controls the system self-monitoring, statistics and diagnostics.</span><br><span class="line">###</span><br><span class="line">### The internal database for monitoring data is created automatically if</span><br><span class="line">### if it does not already exist. The target retention within this database</span><br><span class="line">### is called &#x27;monitor&#x27; and is also created with a retention period of 7 days</span><br><span class="line">### and a replication factor of 1, if it does not exist. In all cases the</span><br><span class="line">### this retention policy is configured as the default for the database.</span><br><span class="line"></span><br><span class="line">[monitor]</span><br><span class="line">  # Whether to record statistics internally.</span><br><span class="line">    store-enabled = true</span><br><span class="line"></span><br><span class="line">  # The destination database for recorded statistics</span><br><span class="line">    store-database = &quot;_internal&quot;</span><br><span class="line"></span><br><span class="line">  # The interval at which to record statistics</span><br><span class="line">    store-interval = &quot;10s&quot;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [http]</span><br><span class="line">###</span><br><span class="line">### Controls how the HTTP endpoints are configured. These are the primary</span><br><span class="line">### mechanism for getting data into and out of InfluxDB.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[http]</span><br><span class="line">  # Determines whether HTTP endpoint is enabled.</span><br><span class="line">    enabled = true</span><br><span class="line"></span><br><span class="line">  # The bind address used by the HTTP service.</span><br><span class="line">    bind-address = &quot;:8086&quot;</span><br><span class="line"></span><br><span class="line">  # Determines whether user authentication is enabled over HTTP/HTTPS.</span><br><span class="line">  # auth-enabled = false</span><br><span class="line"></span><br><span class="line">  # The default realm sent back when issuing a basic auth challenge.</span><br><span class="line">  # realm = &quot;InfluxDB&quot;</span><br><span class="line"></span><br><span class="line">  # Determines whether HTTP request logging is enabled.</span><br><span class="line">  # log-enabled = true</span><br><span class="line"></span><br><span class="line">  # Determines whether detailed write logging is enabled.</span><br><span class="line">  # write-tracing = false</span><br><span class="line"></span><br><span class="line">  # Determines whether the pprof endpoint is enabled.  This endpoint is used for</span><br><span class="line">  # troubleshooting and monitoring.</span><br><span class="line">  # pprof-enabled = true</span><br><span class="line"></span><br><span class="line">  # Determines whether HTTPS is enabled.</span><br><span class="line">  # https-enabled = false</span><br><span class="line"></span><br><span class="line">  # The SSL certificate to use when HTTPS is enabled.</span><br><span class="line">  # https-certificate = &quot;/etc/ssl/influxdb.pem&quot;</span><br><span class="line"></span><br><span class="line">  # Use a separate private key location.</span><br><span class="line">  # https-private-key = &quot;&quot;</span><br><span class="line"></span><br><span class="line">  # The JWT auth shared secret to validate requests using JSON web tokens.</span><br><span class="line">  # shared-secret = &quot;&quot;</span><br><span class="line"></span><br><span class="line">  # The default chunk size for result sets that should be chunked.</span><br><span class="line">  # max-row-limit = 0</span><br><span class="line"></span><br><span class="line">  # The maximum number of HTTP connections that may be open at once.  New connections that</span><br><span class="line">  # would exceed this limit are dropped.  Setting this value to 0 disables the limit.</span><br><span class="line">  # max-connection-limit = 0</span><br><span class="line"></span><br><span class="line">  # Enable http service over unix domain socket</span><br><span class="line">  # unix-socket-enabled = false</span><br><span class="line"></span><br><span class="line">  # The path of the unix domain socket.</span><br><span class="line">  # bind-socket = &quot;/var/run/influxdb.sock&quot;</span><br><span class="line"></span><br><span class="line">  # The maximum size of a client request body, in bytes. Setting this value to 0 disables the limit.</span><br><span class="line">  # max-body-size = 25000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [ifql]</span><br><span class="line">###</span><br><span class="line">### Configures the ifql RPC API.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[ifql]</span><br><span class="line">  # Determines whether the RPC service is enabled.</span><br><span class="line">  # enabled = true</span><br><span class="line"></span><br><span class="line">  # Determines whether additional logging is enabled.</span><br><span class="line">  # log-enabled = true</span><br><span class="line"></span><br><span class="line">  # The bind address used by the ifql RPC service.</span><br><span class="line">  # bind-address = &quot;:8082&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [subscriber]</span><br><span class="line">###</span><br><span class="line">### Controls the subscriptions, which can be used to fork a copy of all data</span><br><span class="line">### received by the InfluxDB host.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[subscriber]</span><br><span class="line">  # Determines whether the subscriber service is enabled.</span><br><span class="line">  # enabled = true</span><br><span class="line"></span><br><span class="line">  # The default timeout for HTTP writes to subscribers.</span><br><span class="line">  # http-timeout = &quot;30s&quot;</span><br><span class="line"></span><br><span class="line">  # Allows insecure HTTPS connections to subscribers.  This is useful when testing with self-</span><br><span class="line">  # signed certificates.</span><br><span class="line">  # insecure-skip-verify = false</span><br><span class="line"></span><br><span class="line">  # The path to the PEM encoded CA certs file. If the empty string, the default system certs will be used</span><br><span class="line">  # ca-certs = &quot;&quot;</span><br><span class="line"></span><br><span class="line">  # The number of writer goroutines processing the write channel.</span><br><span class="line">  # write-concurrency = 40</span><br><span class="line"></span><br><span class="line">  # The number of in-flight writes buffered in the write channel.</span><br><span class="line">  # write-buffer-size = 1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [[graphite]]</span><br><span class="line">###</span><br><span class="line">### Controls one or many listeners for Graphite data.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[[graphite]]</span><br><span class="line">  # Determines whether the graphite endpoint is enabled.</span><br><span class="line">  # enabled = false</span><br><span class="line">  # database = &quot;graphite&quot;</span><br><span class="line">  # retention-policy = &quot;&quot;</span><br><span class="line">  # bind-address = &quot;:2003&quot;</span><br><span class="line">  # protocol = &quot;tcp&quot;</span><br><span class="line">  # consistency-level = &quot;one&quot;</span><br><span class="line"></span><br><span class="line">  # These next lines control how batching works. You should have this enabled</span><br><span class="line">  # otherwise you could get dropped metrics or poor performance. Batching</span><br><span class="line">  # will buffer points in memory if you have many coming in.</span><br><span class="line"></span><br><span class="line">  # Flush if this many points get buffered</span><br><span class="line">  # batch-size = 5000</span><br><span class="line"></span><br><span class="line">  # number of batches that may be pending in memory</span><br><span class="line">  # batch-pending = 10</span><br><span class="line"></span><br><span class="line">  # Flush at least this often even if we haven&#x27;t hit buffer limit</span><br><span class="line">  # batch-timeout = &quot;1s&quot;</span><br><span class="line"></span><br><span class="line">  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.</span><br><span class="line">  # udp-read-buffer = 0</span><br><span class="line"></span><br><span class="line">  ### This string joins multiple matching &#x27;measurement&#x27; values providing more control over the final measurement name.</span><br><span class="line">  # separator = &quot;.&quot;</span><br><span class="line"></span><br><span class="line">  ### Default tags that will be added to all metrics.  These can be overridden at the template level</span><br><span class="line">  ### or by tags extracted from metric</span><br><span class="line">  # tags = [&quot;region=us-east&quot;, &quot;zone=1c&quot;]</span><br><span class="line"></span><br><span class="line">  ### Each template line requires a template pattern.  It can have an optional</span><br><span class="line">  ### filter before the template and separated by spaces.  It can also have optional extra</span><br><span class="line">  ### tags following the template.  Multiple tags should be separated by commas and no spaces</span><br><span class="line">  ### similar to the line protocol format.  There can be only one default template.</span><br><span class="line">  # templates = [</span><br><span class="line">  #   &quot;*.app env.service.resource.measurement&quot;,</span><br><span class="line">  #   # Default template</span><br><span class="line">  #   &quot;server.*&quot;,</span><br><span class="line">  # ]</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [collectd]</span><br><span class="line">###</span><br><span class="line">### Controls one or many listeners for collectd data.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[[collectd]]</span><br><span class="line">  # enabled = false</span><br><span class="line">  # bind-address = &quot;:25826&quot;</span><br><span class="line">  # database = &quot;collectd&quot;</span><br><span class="line">  # retention-policy = &quot;&quot;</span><br><span class="line">  #</span><br><span class="line">  # The collectd service supports either scanning a directory for multiple types</span><br><span class="line">  # db files, or specifying a single db file.</span><br><span class="line">  # typesdb = &quot;/usr/local/share/collectd&quot;</span><br><span class="line">  #</span><br><span class="line">  # security-level = &quot;none&quot;</span><br><span class="line">  # auth-file = &quot;/etc/collectd/auth_file&quot;</span><br><span class="line"></span><br><span class="line">  # These next lines control how batching works. You should have this enabled</span><br><span class="line">  # otherwise you could get dropped metrics or poor performance. Batching</span><br><span class="line">  # will buffer points in memory if you have many coming in.</span><br><span class="line"></span><br><span class="line">  # Flush if this many points get buffered</span><br><span class="line">  # batch-size = 5000</span><br><span class="line"></span><br><span class="line">  # Number of batches that may be pending in memory</span><br><span class="line">  # batch-pending = 10</span><br><span class="line"></span><br><span class="line">  # Flush at least this often even if we haven&#x27;t hit buffer limit</span><br><span class="line">  # batch-timeout = &quot;10s&quot;</span><br><span class="line"></span><br><span class="line">  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.</span><br><span class="line">  # read-buffer = 0</span><br><span class="line"></span><br><span class="line">  # Multi-value plugins can be handled two ways.</span><br><span class="line">  # &quot;split&quot; will parse and store the multi-value plugin data into separate measurements</span><br><span class="line">  # &quot;join&quot; will parse and store the multi-value plugin as a single multi-value measurement.</span><br><span class="line">  # &quot;split&quot; is the default behavior for backward compatability with previous versions of influxdb.</span><br><span class="line">  # parse-multivalue-plugin = &quot;split&quot;</span><br><span class="line">###</span><br><span class="line">### [opentsdb]</span><br><span class="line">###</span><br><span class="line">### Controls one or many listeners for OpenTSDB data.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[[opentsdb]]</span><br><span class="line">  # enabled = false</span><br><span class="line">  # bind-address = &quot;:4242&quot;</span><br><span class="line">  # database = &quot;opentsdb&quot;</span><br><span class="line">  # retention-policy = &quot;&quot;</span><br><span class="line">  # consistency-level = &quot;one&quot;</span><br><span class="line">  # tls-enabled = false</span><br><span class="line">  # certificate= &quot;/etc/ssl/influxdb.pem&quot;</span><br><span class="line"></span><br><span class="line">  # Log an error for every malformed point.</span><br><span class="line">  # log-point-errors = true</span><br><span class="line"></span><br><span class="line">  # These next lines control how batching works. You should have this enabled</span><br><span class="line">  # otherwise you could get dropped metrics or poor performance. Only points</span><br><span class="line">  # metrics received over the telnet protocol undergo batching.</span><br><span class="line"></span><br><span class="line">  # Flush if this many points get buffered</span><br><span class="line">  # batch-size = 1000</span><br><span class="line"></span><br><span class="line">  # Number of batches that may be pending in memory</span><br><span class="line">  # batch-pending = 5</span><br><span class="line"></span><br><span class="line">  # Flush at least this often even if we haven&#x27;t hit buffer limit</span><br><span class="line">  # batch-timeout = &quot;1s&quot;</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [[udp]]</span><br><span class="line">###</span><br><span class="line">### Controls the listeners for InfluxDB line protocol data via UDP.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[[udp]]</span><br><span class="line">  # enabled = false</span><br><span class="line">  # bind-address = &quot;:8089&quot;</span><br><span class="line">  # database = &quot;udp&quot;</span><br><span class="line">  # retention-policy = &quot;&quot;</span><br><span class="line"></span><br><span class="line">  # These next lines control how batching works. You should have this enabled</span><br><span class="line">  # otherwise you could get dropped metrics or poor performance. Batching</span><br><span class="line">  # will buffer points in memory if you have many coming in.</span><br><span class="line"></span><br><span class="line">  # Flush if this many points get buffered</span><br><span class="line">  # batch-size = 5000</span><br><span class="line"></span><br><span class="line">  # Number of batches that may be pending in memory</span><br><span class="line">  # batch-pending = 10</span><br><span class="line"></span><br><span class="line">  # Will flush at least this often even if we haven&#x27;t hit buffer limit</span><br><span class="line">  # batch-timeout = &quot;1s&quot;</span><br><span class="line"></span><br><span class="line">  # UDP Read buffer size, 0 means OS default. UDP listener will fail if set above OS max.</span><br><span class="line">  # read-buffer = 0</span><br><span class="line"></span><br><span class="line">###</span><br><span class="line">### [continuous_queries]</span><br><span class="line">###</span><br><span class="line">### Controls how continuous queries are run within InfluxDB.</span><br><span class="line">###</span><br><span class="line"></span><br><span class="line">[continuous_queries]</span><br><span class="line">  # Determines whether the continuous query service is enabled.</span><br><span class="line">  # enabled = true</span><br><span class="line"></span><br><span class="line">  # Controls whether queries are logged when executed by the CQ service.</span><br><span class="line">  # log-enabled = true</span><br><span class="line"></span><br><span class="line">  # Controls whether queries are logged to the self-monitoring data store.</span><br><span class="line">  # query-stats-enabled = false</span><br><span class="line"></span><br><span class="line">  # interval for how often continuous queries will be checked if they need to run</span><br><span class="line">  # run-interval = &quot;1s&quot;</span><br></pre></td></tr></table></figure>

<p>四、使配置生效并打开数据库连接，双击influxd.exe就好，然后双击influx.exe进行操作，网上有操作教程，注意操作数据库时不能关闭influxd.exe，我不知道为什么总有这么个提示：There was an error writing history file: open : The system cannot find the file specified.不过好像没啥影响</p>
<p>五、要使用web管理需要下载Chronograf，<a target="_blank" rel="noopener" href="https://portal.influxdata.com/downloads">https://portal.influxdata.com/downloads</a>第三个就是，下载完直接解压，双击exe程序，在浏览器输入<a target="_blank" rel="noopener" href="http://localhost:8888/">http://localhost:8888/</a>，一开始登录要账户密码，我都用admin就进去了</p>
<p>这个是查看建立的数据库  </p>
<img src="/2019/08/03/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/InfluxDB%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/IMG-20250704185714467.png" class="">

<p>这个是查看数据库的数据  </p>
<img src="/2019/08/03/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/InfluxDB%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/IMG-20250704185714467.png" class="">

<p>没了</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/07/27/Git/subtree%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/27/Git/subtree%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">git subtree教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-27 00:00:00" itemprop="dateCreated datePublished" datetime="2019-07-27T00:00:00+08:00">2019-07-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:23" itemprop="dateModified" datetime="2025-09-09T08:40:23+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于子仓库或者说是仓库共用，git官方推荐的工具是git subtree。 我自己也用了一段时间的git subtree，感觉比git submodule好用，但是也有一些缺点，在可接受的范围内。<br>所以对于仓库共用，在git subtree 与 git submodule之中选择的话，我推荐git subtree。</p>
<p>git subtree 可以实现一个仓库作为其他仓库的子仓库。</p>
<img src="/2019/07/27/Git/subtree%E6%95%99%E7%A8%8B/IMG-20241219140954387.webp" class="">


<p>使用git subtree 有以下几个原因：</p>
<ul>
<li>旧版本的git也支持(最老版本可以到 v1.5.2).</li>
<li>git subtree与git submodule不同，它不增加任何像<code>.gitmodule</code>这样的新的元数据文件.</li>
<li>git subtree对于项目中的其他成员透明，意味着可以不知道git subtree的存在.</li>
</ul>
<p>当然，git subtree也有它的缺点，但是这些缺点还在可以接受的范围内：</p>
<ul>
<li>必须学习新的指令(如：git subtree).</li>
<li>子仓库的更新与推送指令相对复杂。</li>
</ul>
<p>git subtree的主要命令有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git subtree add   --prefix=&lt;prefix&gt; &lt;commit&gt;</span><br><span class="line">git subtree add   --prefix=&lt;prefix&gt; &lt;repository&gt; &lt;ref&gt;</span><br><span class="line">git subtree pull  --prefix=&lt;prefix&gt; &lt;repository&gt; &lt;ref&gt;</span><br><span class="line">git subtree push  --prefix=&lt;prefix&gt; &lt;repository&gt; &lt;ref&gt;</span><br><span class="line">git subtree merge --prefix=&lt;prefix&gt; &lt;commit&gt;</span><br><span class="line">git subtree <span class="built_in">split</span> --prefix=&lt;prefix&gt; [OPTIONS] [&lt;commit&gt;]</span><br></pre></td></tr></table></figure>

<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>我们先准备一个仓库叫photoshop，一个仓库叫libpng，然后我们希望把libpng作为photoshop的子仓库。<br>photoshop的路径为<code>https://github.com/test/photoshop.git</code>，仓库里的文件有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">photoshop</span><br><span class="line">    |</span><br><span class="line">    |-- photoshop.c</span><br><span class="line">    |-- photoshop.h</span><br><span class="line">    |-- main.c</span><br><span class="line">    \-- README.md</span><br></pre></td></tr></table></figure>

<p>libPNG的路径为<code>https://github.com/test/libpng.git</code>，仓库里的文件有：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">libpng</span><br><span class="line">    |</span><br><span class="line">    |-- libpng.c</span><br><span class="line">    |-- libpng.h</span><br><span class="line">    \-- README.md</span><br></pre></td></tr></table></figure>

<p>以下操作均位于父仓库的根目录中。</p>
<h2 id="在父仓库中新增子仓库"><a href="#在父仓库中新增子仓库" class="headerlink" title="在父仓库中新增子仓库"></a>在父仓库中新增子仓库</h2><p>我们执行以下命令把libpng添加到photoshop中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree add --prefix=sub/libpng https://github.com/test/libpng.git master --squash</span><br></pre></td></tr></table></figure>

<p>(<code>--squash</code>参数表示不拉取历史信息，而只生成一条commit信息。)</p>
<p>执行<code>git status</code>可以看到提示新增两条commit：  </p>
<img src="/2019/07/27/Git/subtree%E6%95%99%E7%A8%8B/IMG-20241219140954353.webp" class="">

<p>image</p>
<p><code>git log</code>查看详细修改：  </p>
<img src="/2019/07/27/Git/subtree%E6%95%99%E7%A8%8B/IMG-20241219140954312.webp" class="">

<p>image</p>
<p>执行<code>git push</code>把修改推送到远端photoshop仓库，现在本地仓库与远端仓库的目录结构为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">photoshop</span><br><span class="line">    |</span><br><span class="line">    |-- sub/</span><br><span class="line">    |   |</span><br><span class="line">    |   \--libpng/</span><br><span class="line">    |       |</span><br><span class="line">    |       |-- libpng.c</span><br><span class="line">    |       |-- libpng.h</span><br><span class="line">    |       \-- README.md</span><br><span class="line">    |</span><br><span class="line">    |-- photoshop.c</span><br><span class="line">    |-- photoshop.h</span><br><span class="line">    |-- main.c</span><br><span class="line">    \-- README.md</span><br></pre></td></tr></table></figure>

<p>注意，现在的photoshop仓库对于其他项目人员来说，可以不需要知道libpng是一个子仓库。什么意思呢？<br>当你<code>git clone</code>或者<code>git pull</code>的时候，你拉取到的是整个photoshop(包括libpng在内，libpng就相当于photoshop里的一个普通目录)；当你修改了libpng里的内容后执行<code>git push</code>，你将会把修改push到photoshop上。<br>也就是说photoshop仓库下的libpng与其他文件无异。</p>
<h2 id="从源仓库拉取更新"><a href="#从源仓库拉取更新" class="headerlink" title="从源仓库拉取更新"></a>从源仓库拉取更新</h2><p>如果源libpng仓库更新了，photoshop里的libpng如何拉取更新？使用<code>git subtree pull</code>，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree pull --prefix=sub/libpng https://github.com/test/libpng.git master --squash</span><br></pre></td></tr></table></figure>

<h2 id="推送修改到源仓库"><a href="#推送修改到源仓库" class="headerlink" title="推送修改到源仓库"></a>推送修改到源仓库</h2><p>如果在photoshop仓库里修改了libpng，然后想把这个修改推送到源libpng仓库呢？使用<code>git subtree push</code>，例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git subtree push --prefix=sub/libpng https://github.com/test/libpng.git master</span><br></pre></td></tr></table></figure>

<h2 id="简化git-subtree命令"><a href="#简化git-subtree命令" class="headerlink" title="简化git subtree命令"></a>简化git subtree命令</h2><p>我们已经知道了git subtree 的命令的基本用法，但是上述几个命令还是显得有点复杂，特别是子仓库的源仓库地址，特别不方便记忆。<br>这里我们把子仓库的地址作为一个remote，方便记忆：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add -f libpng https://github.com/test/libpng.git</span><br></pre></td></tr></table></figure>

<p>然后可以这样来使用git subtree命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git subtree add --prefix=sub/libpng libpng master --squash</span><br><span class="line">git subtree pull --prefix=sub/libpng libpng master --squash</span><br><span class="line">git subtree push --prefix=sub/libpng libpng master</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/07/20/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93InfluxDB%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/20/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93InfluxDB%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">时序数据库InfluxDB使用详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-20 00:00:00" itemprop="dateCreated datePublished" datetime="2019-07-20T00:00:00+08:00">2019-07-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:24" itemprop="dateModified" datetime="2025-09-09T08:40:24+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/InfluxDB/" itemprop="url" rel="index"><span itemprop="name">InfluxDB</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://docs.influxdata.com/influxdb/v1.3/">InfluxDB</a>是一个开源的时序数据库，使用GO语言开发，特别适合用于处理和分析资源监控数据这种时序相关数据。而InfluxDB自带的各种特殊函数如求标准差，随机取样数据，统计数据变化比等，使数据统计和实时分析变得十分方便。在我们的容器资源监控系统中，就采用了InfluxDB存储cadvisor的监控数据。本文对InfluxDB的基本概念和一些特色功能做一个详细介绍，内容主要是翻译整理自官网文档，如有错漏，请指正。</p>
</blockquote>
<p>这里说一下使用docker容器运行influxdb的步骤，物理机安装请参照<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://docs.influxdata.com/influxdb/v1.3/introduction/installation/">官方文档</a>。拉取镜像文件后运行即可，当前最新版本是1.3.5。启动容器时设置挂载的数据目录和开放端口。InfluxDB的操作语法InfluxQL与SQL基本一致，也提供了一个类似mysql-client的名为influx的CLI。InfluxDB本身是支持分布式部署多副本存储的，本文介绍都是针对的单节点单副本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">f216e9be15bff545befecb30d1d275552026216a939cc20c042b17419e3bde31</span><br><span class="line"></span><br><span class="line">root@f216e9be15bf:/</span><br><span class="line">Connected to http:</span><br><span class="line">InfluxDB shell version: 1.3.5</span><br><span class="line">&gt; create database cadvisor  </span><br><span class="line">&gt; show databases           </span><br><span class="line">name: databases</span><br><span class="line">name</span><br><span class="line">----</span><br><span class="line">_internal</span><br><span class="line">cadvisor</span><br><span class="line">&gt; CREATE USER testuser WITH PASSWORD &#x27;testpwd&#x27; </span><br><span class="line">&gt; GRANT ALL PRIVILEGES ON cadvisor TO testuser </span><br><span class="line">&gt; CREATE RETENTION POLICY &quot;cadvisor_retention&quot; ON &quot;cadvisor&quot; DURATION 30d REPLICATION 1 DEFAULT </span><br></pre></td></tr></table></figure>

<p>influxdb里面有一些重要概念：database，timestamp，field key， field value， field set，tag key，tag value，tag set，measurement， retention policy ，series，point。结合下面的例子数据来说明这几个概念：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">name: census</span><br><span class="line">-————————————</span><br><span class="line">time                     butterflies     honeybees     location   scientist</span><br><span class="line">2015-08-18T00:00:00Z      12                23           1         langstroth</span><br><span class="line">2015-08-18T00:00:00Z      1                 30           1         perpetua</span><br><span class="line">2015-08-18T00:06:00Z      11                28           1         langstroth</span><br><span class="line">2015-08-18T00:06:00Z      3                 28           1         perpetua</span><br><span class="line">2015-08-18T05:54:00Z      2                 11           2         langstroth</span><br><span class="line">2015-08-18T06:00:00Z      1                 10           2         langstroth</span><br><span class="line">2015-08-18T06:06:00Z      8                 23           2         perpetua</span><br><span class="line">2015-08-18T06:12:00Z      7                 22           2         perpetua</span><br></pre></td></tr></table></figure>

<h3 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp"></a>timestamp</h3><p>既然是时间序列数据库，influxdb的数据都有一列名为time的列，里面存储UTC时间戳。</p>
<h3 id="field-key，field-value，field-set"><a href="#field-key，field-value，field-set" class="headerlink" title="field key，field value，field set"></a>field key，field value，field set</h3><p>butterflies和honeybees两列数据称为字段(fields)，influxdb的字段由field key和field value组成。其中butterflies和honeybees为field key，它们为string类型，用于存储元数据。</p>
<p>而butterflies这一列的数据12-7为butterflies的field value，同理，honeybees这一列的23-22为honeybees的field value。field value可以为string，float，integer或boolean类型。field value通常都是与时间关联的。</p>
<p>field key和field value对组成的集合称之为field set。如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">butterflies = 12 honeybees = 23</span><br><span class="line">butterflies = 1 honeybees = 30</span><br><span class="line">butterflies = 11 honeybees = 28</span><br><span class="line">butterflies = 3 honeybees = 28</span><br><span class="line">butterflies = 2 honeybees = 11</span><br><span class="line">butterflies = 1 honeybees = 10</span><br><span class="line">butterflies = 8 honeybees = 23</span><br><span class="line">butterflies = 7 honeybees = 22</span><br></pre></td></tr></table></figure>

<p><strong>在influxdb中，字段必须存在。注意，字段是没有索引的。如果使用字段作为查询条件，会扫描符合查询条件的所有字段值，性能不及tag。类比一下，fields相当于SQL的没有索引的列。</strong></p>
<h3 id="tag-key，tag-value，tag-set"><a href="#tag-key，tag-value，tag-set" class="headerlink" title="tag key，tag value，tag set"></a>tag key，tag value，tag set</h3><p>location和scientist这两列称为标签(tags)，标签由tag key和tag value组成。location这个tag key有两个tag value：1和2，scientist有两个tag value：langstroth和perpetua。tag key和tag value对组成了tag set，示例中的tag set如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location = 1, scientist = langstroth</span><br><span class="line">location = 2, scientist = langstroth</span><br><span class="line">location = 1, scientist = perpetua</span><br><span class="line">location = 2, scientist = perpetua</span><br></pre></td></tr></table></figure>

<p><strong>tags是可选的，但是强烈建议你用上它，因为tag是有索引的，tags相当于SQL中的有索引的列。tag value只能是string类型</strong> 如果你的常用场景是根据butterflies和honeybees来查询，那么你可以将这两个列设置为tag，而其他两列设置为field，tag和field依据具体查询需求来定。</p>
<h3 id="measurement"><a href="#measurement" class="headerlink" title="measurement"></a>measurement</h3><p>measurement是fields，tags以及time列的容器，measurement的名字用于描述存储在其中的字段数据，类似mysql的表名。如上面例子中的measurement为census。measurement相当于SQL中的表，本文中我在部分地方会用表来指代measurement。</p>
<h3 id="retention-policy"><a href="#retention-policy" class="headerlink" title="retention policy"></a>retention policy</h3><p>retention policy指数据保留策略，示例数据中的retention policy为默认的autogen。它表示数据一直保留永不过期，副本数量为1。你也可以指定数据的保留时间，如30天。</p>
<h3 id="series"><a href="#series" class="headerlink" title="series"></a>series</h3><p>series是共享同一个retention policy，measurement以及tag set的数据集合。示例中数据有4个series，如下:</p>
<p>Arbitrary series number</p>
<p>Retention policy</p>
<p>Measurement</p>
<p>Tag set</p>
<p>series 1</p>
<p>autogen</p>
<p>census</p>
<p>location &#x3D; 1,scientist &#x3D; langstroth</p>
<p>series 2</p>
<p>autogen</p>
<p>census</p>
<p>location &#x3D; 2,scientist &#x3D; langstroth</p>
<p>series 3</p>
<p>autogen</p>
<p>census</p>
<p>location &#x3D; 1,scientist &#x3D; perpetua</p>
<p>series 4</p>
<p>autogen</p>
<p>census</p>
<p>location &#x3D; 2,scientist &#x3D; perpetua</p>
<h3 id="point"><a href="#point" class="headerlink" title="point"></a>point</h3><p>point则是同一个series中具有相同时间的field set，points相当于SQL中的数据行。如下面就是一个point：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name: census</span><br><span class="line">-----------------</span><br><span class="line">time                  butterflies    honeybees   location    scientist</span><br><span class="line">2015-08-18T00:00:00Z       1            30           1        perpetua</span><br></pre></td></tr></table></figure>

<h3 id="database"><a href="#database" class="headerlink" title="database"></a>database</h3><p>上面提到的结构都存储在数据库中，示例的数据库为my_database。一个数据库可以有多个measurement，retention policy， continuous queries以及user。influxdb是一个无模式的数据库，可以很容易的添加新的measurement，tags，fields等。而它的操作却和传统的数据库一样，可以使用类SQL语言查询和修改数据。</p>
<p>influxdb不是一个完整的CRUD数据库，它更像是一个CR-ud数据库。它优先考虑的是增加和读取数据而不是更新和删除数据的性能，而且它阻止了某些更新和删除行为使得创建和读取数据更加高效。</p>
<p>influxdb函数分为聚合函数，选择函数，转换函数，预测函数等。除了与普通数据库一样提供了基本操作函数外，还提供了一些特色函数以方便数据统计计算，下面会一一介绍其中一些常用的特色函数。</p>
<ul>
<li>聚合函数：<code>FILL()</code>, <code>INTEGRAL()</code>，<code>SPREAD()</code>， <code>STDDEV()</code>，<code>MEAN()</code>, <code>MEDIAN()</code>等。</li>
<li>选择函数: <code>SAMPLE()</code>, <code>PERCENTILE()</code>, <code>FIRST()</code>, <code>LAST()</code>, <code>TOP()</code>, <code>BOTTOM()</code>等。</li>
<li>转换函数: <code>DERIVATIVE()</code>, <code>DIFFERENCE()</code>等。</li>
<li>预测函数：<code>HOLT_WINTERS()</code>。</li>
</ul>
<p>先从官网导入测试数据（注：这里测试用的版本是1.3.1，最新版本是1.3.5）:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ curl https://s3.amazonaws.com/noaa.water-database/NOAA_data.txt -o NOAA_data.txt</span><br><span class="line">$ influx -import -path=NOAA_data.txt -precision=s -database=NOAA_water_database</span><br><span class="line">$ influx -precision rfc3339 -database NOAA_water_database</span><br><span class="line">Connected to http://localhost:8086 version 1.3.1</span><br><span class="line">InfluxDB shell 1.3.1</span><br><span class="line">&gt; show measurements</span><br><span class="line">name: measurements</span><br><span class="line">name</span><br><span class="line">----</span><br><span class="line">average_temperature</span><br><span class="line">distincts</span><br><span class="line">h2o_feet</span><br><span class="line">h2o_pH</span><br><span class="line">h2o_quality</span><br><span class="line">h2o_temperature</span><br><span class="line"></span><br><span class="line">&gt; show series from h2o_feet;</span><br><span class="line">key</span><br><span class="line">---</span><br><span class="line">h2o_feet,location=coyote_creek</span><br><span class="line">h2o_feet,location=santa_monica</span><br></pre></td></tr></table></figure>

<p>下面的例子都以官方示例数据库来测试，这里只用部分数据以方便观察。measurement为<code>h2o_feet</code>，tag key为<code>location</code>，field key有<code>level description</code>和<code>water_level</code>两个。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 level description    location     water_level</span><br><span class="line">----                 -----------------    --------     -----------</span><br><span class="line">2015-08-18T00:00:00Z between 6 and 9 feet coyote_creek 8.12</span><br><span class="line">2015-08-18T00:00:00Z below 3 feet         santa_monica 2.064</span><br><span class="line">2015-08-18T00:06:00Z between 6 and 9 feet coyote_creek 8.005</span><br><span class="line">2015-08-18T00:06:00Z below 3 feet         santa_monica 2.116</span><br><span class="line">2015-08-18T00:12:00Z between 6 and 9 feet coyote_creek 7.887</span><br><span class="line">2015-08-18T00:12:00Z below 3 feet         santa_monica 2.028</span><br><span class="line">2015-08-18T00:18:00Z between 6 and 9 feet coyote_creek 7.762</span><br><span class="line">2015-08-18T00:18:00Z below 3 feet         santa_monica 2.126</span><br><span class="line">2015-08-18T00:24:00Z between 6 and 9 feet coyote_creek 7.635</span><br><span class="line">2015-08-18T00:24:00Z below 3 feet         santa_monica 2.041</span><br><span class="line">2015-08-18T00:30:00Z between 6 and 9 feet coyote_creek 7.5</span><br><span class="line">2015-08-18T00:30:00Z below 3 feet         santa_monica 2.051</span><br></pre></td></tr></table></figure>

<h3 id="GROUP-BY，FILL"><a href="#GROUP-BY，FILL" class="headerlink" title="GROUP BY，FILL()"></a>GROUP BY，FILL()</h3><p>如下语句中<code>GROUP BY time(12m),*</code> 表示以每12分钟和tag(location)分组(如果是<code>GROUP BY time(12m)</code>则表示仅每12分钟分组，<strong>GROUP BY 参数只能是time和tag</strong>)。然后fill(200)表示如果这个时间段没有数据，以200填充，mean(field_key)求该范围内数据的平均值(注意：这是依据series来计算。其他还有SUM求和，MEDIAN求中位数)。LIMIT 7表示限制返回的point(记录数)最多为7条，而SLIMIT 1则是限制返回的series为1个。</p>
<p>注意这里的时间区间，起始时间为整点前包含这个区间第一个12m的时间，比如这里为 <code>2015-08-17T:23:48:00Z</code>，第一条为 <code>2015-08-17T23:48:00Z &lt;= t &lt; 2015-08-18T00:00:00Z</code>这个区间的<code>location=coyote_creek</code>的<code>water_level</code>的平均值，这里没有数据，于是填充的200。第二条为 <code>2015-08-18T00:00:00Z &lt;= t &lt; 2015-08-18T00:12:00Z</code>区间的<code>location=coyote_creek</code>的<code>water_level</code>平均值，这里为 <code>（8.12+8.005）/ 2 = 8.0625</code>，其他以此类推。</p>
<p>而<code>GROUP BY time(10m)</code>则表示以10分钟分组，起始时间为包含这个区间的第一个10m的时间，即 <code>2015-08-17T23:40:00Z</code>。默认返回的是第一个series，如果要计算另外那个series，可以在SQL语句后面加上 <code>SOFFSET 1</code>。</p>
<p>那如果时间小于数据本身采集的时间间隔呢，比如<code>GROUP BY time(10s)</code>呢？这样的话，就会按10s取一个点，没有数值的为空或者FILL填充，对应时间点有数据则保持不变。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">## GROUP BY time(12m)</span><br><span class="line">&gt; SELECT mean(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; GROUP BY time(12m),* fill(200) LIMIT 7 SLIMIT 1</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=coyote_creek</span><br><span class="line">time                 mean</span><br><span class="line">----                 ----</span><br><span class="line">2015-08-17T23:48:00Z 200</span><br><span class="line">2015-08-18T00:00:00Z 8.0625</span><br><span class="line">2015-08-18T00:12:00Z 7.8245</span><br><span class="line">2015-08-18T00:24:00Z 7.5675</span><br><span class="line"></span><br><span class="line">## GROUP BY time(10m)，SOFFSET设置为1</span><br><span class="line">&gt; SELECT mean(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; GROUP BY time(10m),* fill(200) LIMIT 7 SLIMIT 1 SOFFSET 1</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=santa_monica</span><br><span class="line">time                 mean</span><br><span class="line">----                 ----</span><br><span class="line">2015-08-17T23:40:00Z 200</span><br><span class="line">2015-08-17T23:50:00Z 200</span><br><span class="line">2015-08-18T00:00:00Z 2.09</span><br><span class="line">2015-08-18T00:10:00Z 2.077</span><br><span class="line">2015-08-18T00:20:00Z 2.041</span><br><span class="line">2015-08-18T00:30:00Z 2.051</span><br></pre></td></tr></table></figure>

<h3 id="INTEGRAL-field-key-unit"><a href="#INTEGRAL-field-key-unit" class="headerlink" title="INTEGRAL(field_key, unit)"></a>INTEGRAL(field_key, unit)</h3><p>计算数值字段值覆盖的曲面的面积值并得到面积之和。测试数据如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT &quot;water_level&quot; FROM &quot;h2o_feet&quot; WHERE &quot;location&quot; = &#x27;santa_monica&#x27; AND time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;</span><br><span class="line"></span><br><span class="line">name: h2o_feet</span><br><span class="line">time                   water_level</span><br><span class="line">----                   -----------</span><br><span class="line">2015-08-18T00:00:00Z   2.064</span><br><span class="line">2015-08-18T00:06:00Z   2.116</span><br><span class="line">2015-08-18T00:12:00Z   2.028</span><br><span class="line">2015-08-18T00:18:00Z   2.126</span><br><span class="line">2015-08-18T00:24:00Z   2.041</span><br><span class="line">2015-08-18T00:30:00Z   2.051</span><br></pre></td></tr></table></figure>

<p>使用INTERGRAL计算面积。注意，这个面积就是这些点连接起来后与时间围成的不规则图形的面积，注意unit默认是以1秒计算，所以下面语句计算结果为<code>3732.66=2.028*1800+分割出来的梯形和三角形面积</code>。如果unit改为1分，则结果为<code>3732.66/60 = 62.211</code>。unit为2分，则结果为<code>3732.66/120 = 31.1055</code>。以此类推。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># unit为默认的1秒</span><br><span class="line">&gt; SELECT INTEGRAL(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE &quot;location&quot; = &#x27;santa_monica&#x27; AND time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 integral</span><br><span class="line">----                 --------</span><br><span class="line">1970-01-01T00:00:00Z 3732.66</span><br><span class="line"></span><br><span class="line"># unit为1分</span><br><span class="line">&gt; SELECT INTEGRAL(&quot;water_level&quot;, 1m) FROM &quot;h2o_feet&quot; WHERE &quot;location&quot; = &#x27;santa_monica&#x27; AND time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 integral</span><br><span class="line">----                 --------</span><br><span class="line">1970-01-01T00:00:00Z 62.211</span><br></pre></td></tr></table></figure>

<h3 id="SPREAD-field-key"><a href="#SPREAD-field-key" class="headerlink" title="SPREAD(field_key)"></a>SPREAD(field_key)</h3><p>计算数值字段的最大值和最小值的差值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT SPREAD(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; GROUP BY time(12m),* fill(18) LIMIT 3 SLIMIT 1 SOFFSET 1</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=santa_monica</span><br><span class="line">time                 spread</span><br><span class="line">----                 ------</span><br><span class="line">2015-08-17T23:48:00Z 18</span><br><span class="line">2015-08-18T00:00:00Z 0.052000000000000046</span><br><span class="line">2015-08-18T00:12:00Z 0.09799999999999986</span><br></pre></td></tr></table></figure>

<h3 id="STDDEV-field-key"><a href="#STDDEV-field-key" class="headerlink" title="STDDEV(field_key)"></a>STDDEV(field_key)</h3><p>计算字段的标准差。influxdb用的是贝塞尔修正的标准差计算公式 ，如下：</p>
<ul>
<li>mean&#x3D;(v1+v2+…+vn)&#x2F;n;</li>
<li>stddev &#x3D; math.sqrt(<br>((v1-mean)2 + (v2-mean)2 + …+(vn-mean)2)&#x2F;(n-1)<br>)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT STDDEV(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; GROUP BY time(12m),* fill(18) SLIMIT 1;</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=coyote_creek</span><br><span class="line">time                 stddev</span><br><span class="line">----                 ------</span><br><span class="line">2015-08-17T23:48:00Z 18</span><br><span class="line">2015-08-18T00:00:00Z 0.08131727983645186</span><br><span class="line">2015-08-18T00:12:00Z 0.08838834764831845</span><br><span class="line">2015-08-18T00:24:00Z 0.09545941546018377</span><br></pre></td></tr></table></figure>

<h3 id="PERCENTILE-field-key-N"><a href="#PERCENTILE-field-key-N" class="headerlink" title="PERCENTILE(field_key, N)"></a>PERCENTILE(field_key, N)</h3><p>选取某个字段中大于N%的这个字段值。</p>
<p>如果一共有4条记录，N为10，则10%*4&#x3D;0.4，四舍五入为0，则查询结果为空。N为20，则 20% * 4 &#x3D; 0.8，四舍五入为1，选取的是4个数中最小的数。如果N为40，40% * 4 &#x3D; 1.6，四舍五入为2，则选取的是4个数中第二小的数。由此可以看出N&#x3D;100时，就跟<code>MAX(field_key)</code>是一样的，而当N&#x3D;50时，与<code>MEDIAN(field_key)</code>在字段值为奇数个时是一样的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT PERCENTILE(&quot;water_level&quot;,20) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; GROUP BY time(12m)</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 percentile</span><br><span class="line">----                 ----------</span><br><span class="line">2015-08-17T23:48:00Z </span><br><span class="line">2015-08-18T00:00:00Z 2.064</span><br><span class="line">2015-08-18T00:12:00Z 2.028</span><br><span class="line">2015-08-18T00:24:00Z 2.041</span><br><span class="line"></span><br><span class="line">&gt; SELECT PERCENTILE(&quot;water_level&quot;,40) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; GROUP BY time(12m)</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 percentile</span><br><span class="line">----                 ----------</span><br><span class="line">2015-08-17T23:48:00Z </span><br><span class="line">2015-08-18T00:00:00Z 2.116</span><br><span class="line">2015-08-18T00:12:00Z 2.126</span><br><span class="line">2015-08-18T00:24:00Z 2.051</span><br></pre></td></tr></table></figure>

<h3 id="SAMPLE-field-key-N"><a href="#SAMPLE-field-key-N" class="headerlink" title="SAMPLE(field_key, N)"></a>SAMPLE(field_key, N)</h3><p>随机返回field key的N个值。如果语句中有<code>GROUP BY time()</code>，则每组数据随机返回N个值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT SAMPLE(&quot;water_level&quot;,2) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;;</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 sample</span><br><span class="line">----                 ------</span><br><span class="line">2015-08-18T00:00:00Z 2.064</span><br><span class="line">2015-08-18T00:12:00Z 2.028</span><br><span class="line"></span><br><span class="line">&gt; SELECT SAMPLE(&quot;water_level&quot;,2) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; GROUP BY time(12m);</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 sample</span><br><span class="line">----                 ------</span><br><span class="line">2015-08-18T00:06:00Z 2.116</span><br><span class="line">2015-08-18T00:06:00Z 8.005</span><br><span class="line">2015-08-18T00:12:00Z 7.887</span><br><span class="line">2015-08-18T00:18:00Z 7.762</span><br><span class="line">2015-08-18T00:24:00Z 7.635</span><br><span class="line">2015-08-18T00:30:00Z 2.051</span><br></pre></td></tr></table></figure>

<h3 id="CUMULATIVE-SUM-field-key"><a href="#CUMULATIVE-SUM-field-key" class="headerlink" title="CUMULATIVE_SUM(field_key)"></a>CUMULATIVE_SUM(field_key)</h3><p>计算字段值的递增和。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT CUMULATIVE_SUM(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-17T23:48:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;;</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 cumulative_sum</span><br><span class="line">----                 --------------</span><br><span class="line">2015-08-18T00:00:00Z 8.12</span><br><span class="line">2015-08-18T00:00:00Z 10.184</span><br><span class="line">2015-08-18T00:06:00Z 18.189</span><br><span class="line">2015-08-18T00:06:00Z 20.305</span><br><span class="line">2015-08-18T00:12:00Z 28.192</span><br><span class="line">2015-08-18T00:12:00Z 30.22</span><br><span class="line">2015-08-18T00:18:00Z 37.982</span><br><span class="line">2015-08-18T00:18:00Z 40.108</span><br><span class="line">2015-08-18T00:24:00Z 47.742999999999995</span><br><span class="line">2015-08-18T00:24:00Z 49.78399999999999</span><br><span class="line">2015-08-18T00:30:00Z 57.28399999999999</span><br><span class="line">2015-08-18T00:30:00Z 59.334999999999994</span><br></pre></td></tr></table></figure>

<h3 id="DERIVATIVE-field-key-unit-和-NON-NEGATIVE-DERIVATIVE-field-key-unit"><a href="#DERIVATIVE-field-key-unit-和-NON-NEGATIVE-DERIVATIVE-field-key-unit" class="headerlink" title="DERIVATIVE(field_key, unit) 和 NON_NEGATIVE_DERIVATIVE(field_key, unit)"></a>DERIVATIVE(field_key, unit) 和 NON_NEGATIVE_DERIVATIVE(field_key, unit)</h3><p>计算字段值的变化比。unit默认为1s，即计算的是1秒内的变化比。</p>
<p>如下面的第一个数据计算方法是 <code>(2.116-2.064)/(6*60) = 0.00014..</code>，其他计算方式同理。虽然原始数据是6m收集一次，但是这里的变化比默认是按秒来计算的。如果要按6m计算，则设置unit为6m即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DERIVATIVE(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE &quot;location&quot; = &#x27;santa_monica&#x27; AND time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 derivative</span><br><span class="line">----                 ----------</span><br><span class="line">2015-08-18T00:06:00Z 0.00014444444444444457</span><br><span class="line">2015-08-18T00:12:00Z -0.00024444444444444465</span><br><span class="line">2015-08-18T00:18:00Z 0.0002722222222222218</span><br><span class="line">2015-08-18T00:24:00Z -0.000236111111111111</span><br><span class="line">2015-08-18T00:30:00Z 0.00002777777777777842</span><br><span class="line"></span><br><span class="line">&gt; SELECT DERIVATIVE(&quot;water_level&quot;, 6m) FROM &quot;h2o_feet&quot; WHERE &quot;location&quot; = &#x27;santa_monica&#x27; AND time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27;</span><br><span class="line">name: h2o_feet</span><br><span class="line">time                 derivative</span><br><span class="line">----                 ----------</span><br><span class="line">2015-08-18T00:06:00Z 0.052000000000000046</span><br><span class="line">2015-08-18T00:12:00Z -0.08800000000000008</span><br><span class="line">2015-08-18T00:18:00Z 0.09799999999999986</span><br><span class="line">2015-08-18T00:24:00Z -0.08499999999999996</span><br><span class="line">2015-08-18T00:30:00Z 0.010000000000000231</span><br></pre></td></tr></table></figure>

<p>而DERIVATIVE结合GROUP BY time，以及mean可以构造更加复杂的查询，如下所示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DERIVATIVE(mean(&quot;water_level&quot;), 6m) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; group by time(12m), *</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=coyote_creek</span><br><span class="line">time                 derivative</span><br><span class="line">----                 ----------</span><br><span class="line">2015-08-18T00:12:00Z -0.11900000000000022</span><br><span class="line">2015-08-18T00:24:00Z -0.12849999999999984</span><br><span class="line"></span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=santa_monica</span><br><span class="line">time                 derivative</span><br><span class="line">----                 ----------</span><br><span class="line">2015-08-18T00:12:00Z -0.00649999999999995</span><br><span class="line">2015-08-18T00:24:00Z -0.015499999999999847</span><br></pre></td></tr></table></figure>

<p>这个计算其实是先根据GROUP BY time求平均值，然后对这个平均值再做变化比的计算。因为数据是按12分钟分组的，而变化比的unit是6分钟，所以差值除以2(12&#x2F;6)才得到变化比。如第一个值是 <code>(7.8245-8.0625)/2 = -0.1190</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT mean(&quot;water_level&quot;) FROM &quot;h2o_feet&quot; WHERE time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; group by time(12m), *</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=coyote_creek</span><br><span class="line">time                 mean</span><br><span class="line">----                 ----</span><br><span class="line">2015-08-18T00:00:00Z 8.0625</span><br><span class="line">2015-08-18T00:12:00Z 7.8245</span><br><span class="line">2015-08-18T00:24:00Z 7.5675</span><br><span class="line"></span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=santa_monica</span><br><span class="line">time                 mean</span><br><span class="line">----                 ----</span><br><span class="line">2015-08-18T00:00:00Z 2.09</span><br><span class="line">2015-08-18T00:12:00Z 2.077</span><br><span class="line">2015-08-18T00:24:00Z 2.0460000000000003</span><br></pre></td></tr></table></figure>

<p><code>NON_NEGATIVE_DERIVATIVE</code>与<code>DERIVATIVE</code>不同的是它只返回的是非负的变化比:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT DERIVATIVE(mean(&quot;water_level&quot;), 6m) FROM &quot;h2o_feet&quot; WHERE location=&#x27;santa_monica&#x27; AND time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; group by time(6m), *</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=santa_monica</span><br><span class="line">time                 derivative</span><br><span class="line">----                 ----------</span><br><span class="line">2015-08-18T00:06:00Z 0.052000000000000046</span><br><span class="line">2015-08-18T00:12:00Z -0.08800000000000008</span><br><span class="line">2015-08-18T00:18:00Z 0.09799999999999986</span><br><span class="line">2015-08-18T00:24:00Z -0.08499999999999996</span><br><span class="line">2015-08-18T00:30:00Z 0.010000000000000231</span><br><span class="line"></span><br><span class="line">&gt; SELECT NON_NEGATIVE_DERIVATIVE(mean(&quot;water_level&quot;), 6m) FROM &quot;h2o_feet&quot; WHERE location=&#x27;santa_monica&#x27; AND time &gt;= &#x27;2015-08-18T00:00:00Z&#x27; AND time &lt;= &#x27;2015-08-18T00:30:00Z&#x27; group by time(6m), *</span><br><span class="line">name: h2o_feet</span><br><span class="line">tags: location=santa_monica</span><br><span class="line">time                 non_negative_derivative</span><br><span class="line">----                 -----------------------</span><br><span class="line">2015-08-18T00:06:00Z 0.052000000000000046</span><br><span class="line">2015-08-18T00:18:00Z 0.09799999999999986</span><br><span class="line">2015-08-18T00:30:00Z 0.010000000000000231</span><br></pre></td></tr></table></figure>

<h2 id="4-1-基本语法"><a href="#4-1-基本语法" class="headerlink" title="4.1 基本语法"></a>4.1 基本语法</h2><p>连续查询(CONTINUOUS QUERY，简写为CQ)是指定时自动在实时数据上进行的InfluxQL查询，查询结果可以存储到指定的measurement中。基本语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &lt;cq_name&gt; ON &lt;database_name&gt;</span><br><span class="line">BEGIN</span><br><span class="line">  &lt;cq_query&gt;</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">cq_query格式：</span><br><span class="line">SELECT &lt;function[s]&gt; INTO &lt;destination_measurement&gt; FROM &lt;measurement&gt; [WHERE &lt;stuff&gt;] GROUP BY time(&lt;interval&gt;)[,&lt;tag_key[s]&gt;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>CQ操作的是实时数据，它使用本地服务器的时间戳、GROUP BY time()时间间隔以及InfluxDB预先设置好的时间范围来确定什么时候开始查询以及查询覆盖的时间范围。注意CQ语句里面的WHERE条件是没有时间范围的，因为CQ会根据<code>GROUP BY time()</code>自动确定时间范围。</p>
<p>CQ执行的时间间隔和<code>GROUP BY time()</code>的时间间隔一样，它在InfluxDB预先设置的时间范围的起始时刻执行。如果<code>GROUP BY time(1h)</code>，则单次查询的时间范围为 <code>now()-GROUP BY time(1h)</code>到 <code>now()</code>，也就是说，如果当前时间为17点，这次查询的时间范围为 16:00到16:59.99999。</p>
<p>下面看几个示例，示例数据如下，这是数据库<code>transportation</code>中名为<code>bus_data</code>的measurement，每15分钟统计一次乘客数和投诉数。数据文件<code>bus_data.txt</code>如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># DDL</span><br><span class="line">CREATE DATABASE transportation</span><br><span class="line"></span><br><span class="line"># DML</span><br><span class="line"># CONTEXT-DATABASE: transportation </span><br><span class="line"></span><br><span class="line">bus_data,complaints=9 passengers=5 1472367600</span><br><span class="line">bus_data,complaints=9 passengers=8 1472368500</span><br><span class="line">bus_data,complaints=9 passengers=8 1472369400</span><br><span class="line">bus_data,complaints=9 passengers=7 1472370300</span><br><span class="line">bus_data,complaints=9 passengers=8 1472371200</span><br><span class="line">bus_data,complaints=7 passengers=15 1472372100</span><br><span class="line">bus_data,complaints=7 passengers=15 1472373000</span><br><span class="line">bus_data,complaints=7 passengers=17 1472373900</span><br><span class="line">bus_data,complaints=7 passengers=20 1472374800</span><br></pre></td></tr></table></figure>

<p>导入数据，命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@f216e9be15bf:/# influx -import -path=bus_data.txt -precision=s</span><br><span class="line">root@f216e9be15bf:/# influx -precision=rfc3339 -database=transportation</span><br><span class="line">Connected to http://localhost:8086 version 1.3.5</span><br><span class="line">InfluxDB shell version: 1.3.5</span><br><span class="line">&gt; select * from bus_data</span><br><span class="line">name: bus_data</span><br><span class="line">time                 complaints passengers</span><br><span class="line">----                 ---------- ----------</span><br><span class="line">2016-08-28T07:00:00Z 9          5</span><br><span class="line">2016-08-28T07:15:00Z 9          8</span><br><span class="line">2016-08-28T07:30:00Z 9          8</span><br><span class="line">2016-08-28T07:45:00Z 9          7</span><br><span class="line">2016-08-28T08:00:00Z 9          8</span><br><span class="line">2016-08-28T08:15:00Z 7          15</span><br><span class="line">2016-08-28T08:30:00Z 7          15</span><br><span class="line">2016-08-28T08:45:00Z 7          17</span><br><span class="line">2016-08-28T09:00:00Z 7          20</span><br></pre></td></tr></table></figure>

<h3 id="示例1-自动缩小取样存储到新的measurement中"><a href="#示例1-自动缩小取样存储到新的measurement中" class="headerlink" title="示例1 自动缩小取样存储到新的measurement中"></a>示例1 自动缩小取样存储到新的measurement中</h3><p>对单个字段自动缩小取样并存储到新的measurement中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_basic&quot; ON &quot;transportation&quot;</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(&quot;passengers&quot;) INTO &quot;average_passengers&quot; FROM &quot;bus_data&quot; GROUP BY time(1h)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>这个CQ的意思就是对<code>bus_data</code>每小时自动计算取样数据的平均乘客数并存储到 <code>average_passengers</code>中。那么在2016-08-28这天早上会执行如下流程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">At 8:00 cq_basic 执行查询，查询时间范围 time &gt;= &#x27;7:00&#x27; AND time &lt; &#x27;08:00&#x27;.</span><br><span class="line">cq_basic写入一条记录到 average_passengers:</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:00:00Z   7</span><br><span class="line">At 9:00 cq_basic 执行查询，查询时间范围 time &gt;= &#x27;8:00&#x27; AND time &lt; &#x27;9:00&#x27;.</span><br><span class="line">cq_basic写入一条记录到 average_passengers:</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T08:00:00Z   13.75</span><br><span class="line"></span><br><span class="line"># Results</span><br><span class="line">&gt; SELECT * FROM &quot;average_passengers&quot;</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:00:00Z   7</span><br><span class="line">2016-08-28T08:00:00Z   13.75</span><br></pre></td></tr></table></figure>

<h3 id="示例2-自动缩小取样并存储到新的保留策略（Retention-Policy）中"><a href="#示例2-自动缩小取样并存储到新的保留策略（Retention-Policy）中" class="headerlink" title="示例2 自动缩小取样并存储到新的保留策略（Retention Policy）中"></a>示例2 自动缩小取样并存储到新的保留策略（Retention Policy）中</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_basic_rp&quot; ON &quot;transportation&quot;</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(&quot;passengers&quot;) INTO &quot;transportation&quot;.&quot;three_weeks&quot;.&quot;average_passengers&quot; FROM &quot;bus_data&quot; GROUP BY time(1h)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>与示例1类似，不同的是保留的策略不是<code>autogen</code>，而是改成了<code>three_weeks</code>(创建保留策略语法 <code>CREATE RETENTION POLICY &quot;three_weeks&quot; ON &quot;transportation&quot; DURATION 3w REPLICATION 1</code>)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;transportation&quot;.&quot;three_weeks&quot;.&quot;average_passengers&quot;</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:00:00Z   7</span><br><span class="line">2016-08-28T08:00:00Z   13.75</span><br></pre></td></tr></table></figure>

<h3 id="示例3-使用后向引用-backreferencing-自动缩小取样并存储到新的数据库中"><a href="#示例3-使用后向引用-backreferencing-自动缩小取样并存储到新的数据库中" class="headerlink" title="示例3 使用后向引用(backreferencing)自动缩小取样并存储到新的数据库中"></a>示例3 使用后向引用(backreferencing)自动缩小取样并存储到新的数据库中</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_basic_br&quot; ON &quot;transportation&quot;</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(*) INTO &quot;downsampled_transportation&quot;.&quot;autogen&quot;.:MEASUREMENT FROM /.*/ GROUP BY time(30m),*</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>使用后向引用语法自动缩小取样并存储到新的数据库中。语法 <code>:MEASUREMENT</code> 用来指代后面的表，而 <code>/.*/</code>则是分别查询所有的表。这句CQ的含义就是每30分钟自动查询<code>transportation</code>的所有表(这里只有bus_data一个表)，并将30分钟内数字字段(passengers和complaints)求平均值存储到新的数据库 <code>downsampled_transportation</code>中。</p>
<p>最终结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;downsampled_transportation.&quot;autogen&quot;.&quot;bus_data&quot;</span><br><span class="line">name: bus_data</span><br><span class="line">--------------</span><br><span class="line">time                   mean_complaints   mean_passengers</span><br><span class="line">2016-08-28T07:00:00Z   9                 6.5</span><br><span class="line">2016-08-28T07:30:00Z   9                 7.5</span><br><span class="line">2016-08-28T08:00:00Z   8                 11.5</span><br><span class="line">2016-08-28T08:30:00Z   7                 16</span><br></pre></td></tr></table></figure>

<h3 id="示例4-自动缩小取样以及配置CQ的时间范围"><a href="#示例4-自动缩小取样以及配置CQ的时间范围" class="headerlink" title="示例4 自动缩小取样以及配置CQ的时间范围"></a>示例4 自动缩小取样以及配置CQ的时间范围</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_basic_offset&quot; ON &quot;transportation&quot;</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(&quot;passengers&quot;) INTO &quot;average_passengers&quot; FROM &quot;bus_data&quot; GROUP BY time(1h,15m)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>与前面几个示例不同的是，这里的<code>GROUP BY time(1h, 15m)</code>指定了一个时间偏移，也就是说 <code>cq_basic_offset</code>执行的时间不再是整点，而是往后偏移15分钟。执行流程如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">At 8:15 cq_basic_offset 执行查询的时间范围 time &gt;= &#x27;7:15&#x27; AND time &lt; &#x27;8:15&#x27;.</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:15:00Z   7.75</span><br><span class="line">At 9:15 cq_basic_offset 执行查询的时间范围 time &gt;= &#x27;8:15&#x27; AND time &lt; &#x27;9:15&#x27;.</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T08:15:00Z   16.75</span><br></pre></td></tr></table></figure>

<p>最终结果:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;average_passengers&quot;</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:15:00Z   7.75</span><br><span class="line">2016-08-28T08:15:00Z   16.75</span><br></pre></td></tr></table></figure>

<h2 id="4-2-高级语法"><a href="#4-2-高级语法" class="headerlink" title="4.2 高级语法"></a>4.2 高级语法</h2><p>InfluxDB连续查询的高级语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &lt;cq_name&gt; ON &lt;database_name&gt;</span><br><span class="line">RESAMPLE EVERY &lt;interval&gt; FOR &lt;interval&gt;</span><br><span class="line">BEGIN</span><br><span class="line">  &lt;cq_query&gt;</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>与基本语法不同的是，多了<code>RESAMPLE</code>关键字。高级语法里CQ的执行时间和查询时间范围则与RESAMPLE里面的两个interval有关系。</p>
<p>高级语法中CQ以EVERY interval的时间间隔执行，执行时查询的时间范围则是FOR interval来确定。如果FOR interval为2h，当前时间为17:00，则查询的时间范围为<code>15:00-16:59.999999</code>。<strong>RESAMPLE的EVERY和FOR两个关键字可以只有一个</strong>。</p>
<p>示例的数据表如下，比之前的多了几条记录为了示例3和示例4的测试:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">name: bus_data</span><br><span class="line">--------------</span><br><span class="line">time                   passengers</span><br><span class="line">2016-08-28T06:30:00Z   2</span><br><span class="line">2016-08-28T06:45:00Z   4</span><br><span class="line">2016-08-28T07:00:00Z   5</span><br><span class="line">2016-08-28T07:15:00Z   8</span><br><span class="line">2016-08-28T07:30:00Z   8</span><br><span class="line">2016-08-28T07:45:00Z   7</span><br><span class="line">2016-08-28T08:00:00Z   8</span><br><span class="line">2016-08-28T08:15:00Z   15</span><br><span class="line">2016-08-28T08:30:00Z   15</span><br><span class="line">2016-08-28T08:45:00Z   17</span><br><span class="line">2016-08-28T09:00:00Z   20</span><br></pre></td></tr></table></figure>

<h3 id="示例1-只配置执行时间间隔"><a href="#示例1-只配置执行时间间隔" class="headerlink" title="示例1 只配置执行时间间隔"></a>示例1 只配置执行时间间隔</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_advanced_every&quot; ON &quot;transportation&quot;</span><br><span class="line">RESAMPLE EVERY 30m</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(&quot;passengers&quot;) INTO &quot;average_passengers&quot; FROM &quot;bus_data&quot; GROUP BY time(1h)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>这里配置了30分钟执行一次CQ，没有指定FOR interval，于是查询的时间范围还是<code>GROUP BY time(1h)</code>指定的一个小时，执行流程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">At 8:00, cq_advanced_every 执行时间范围 time &gt;= &#x27;7:00&#x27; AND time &lt; &#x27;8:00&#x27;.</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:00:00Z   7</span><br><span class="line">At 8:30, cq_advanced_every 执行时间范围 time &gt;= &#x27;8:00&#x27; AND time &lt; &#x27;9:00&#x27;.</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T08:00:00Z   12.6667</span><br><span class="line">At 9:00, cq_advanced_every 执行时间范围 time &gt;= &#x27;8:00&#x27; AND time &lt; &#x27;9:00&#x27;.</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T08:00:00Z   13.75</span><br></pre></td></tr></table></figure>

<p>需要注意的是，这里的 8点到9点这个区间执行了两次，第一次执行时时8:30，平均值是 <code>(8+15+15）/ 3 = 12.6667</code>，而第二次执行时间是9:00，平均值是 <code>(8+15+15+17) / 4=13.75</code>，而且最后第二个结果覆盖了第一个结果。<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://docs.influxdata.com/influxdb/v1.3/troubleshooting/frequently-asked-questions/%23how-does-influxdb-handle-duplicate-points">InfluxDB如何处理重复的记录可以参见这个文档</a>。</p>
<p>最终结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;average_passengers&quot;</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:00:00Z   7</span><br><span class="line">2016-08-28T08:00:00Z   13.75</span><br></pre></td></tr></table></figure>

<h3 id="示例2-只配置查询时间范围"><a href="#示例2-只配置查询时间范围" class="headerlink" title="示例2 只配置查询时间范围"></a>示例2 只配置查询时间范围</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_advanced_for&quot; ON &quot;transportation&quot;</span><br><span class="line">RESAMPLE FOR 1h</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(&quot;passengers&quot;) INTO &quot;average_passengers&quot; FROM &quot;bus_data&quot; GROUP BY time(30m)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>只配置了时间范围，而没有配置EVERY interval。这样，执行的时间间隔与<code>GROUP BY time(30m)</code>一样为30分钟，而查询的时间范围为1小时，由于是按30分钟分组，所以每次会写入两条记录。执行流程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">At 8:00 cq_advanced_for 查询时间范围：time &gt;= &#x27;7:00&#x27; AND time &lt; &#x27;8:00&#x27;.</span><br><span class="line">写入两条记录。</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:00:00Z   6.5</span><br><span class="line">2016-08-28T07:30:00Z   7.5</span><br><span class="line">At 8:30 cq_advanced_for 查询时间范围：time &gt;= &#x27;7:30&#x27; AND time &lt; &#x27;8:30&#x27;.</span><br><span class="line">写入两条记录。</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:30:00Z   7.5</span><br><span class="line">2016-08-28T08:00:00Z   11.5</span><br><span class="line">At 9:00 cq_advanced_for 查询时间范围：time &gt;= &#x27;8:00&#x27; AND time &lt; &#x27;9:00&#x27;.</span><br><span class="line">写入两条记录。</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T08:00:00Z   11.5</span><br><span class="line">2016-08-28T08:30:00Z   16</span><br></pre></td></tr></table></figure>

<p>需要注意的是，<code>cq_advanced_for</code>每次写入了两条记录，重复的记录会被覆盖。</p>
<p>最终结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;average_passengers&quot;</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:00:00Z   6.5</span><br><span class="line">2016-08-28T07:30:00Z   7.5</span><br><span class="line">2016-08-28T08:00:00Z   11.5</span><br><span class="line">2016-08-28T08:30:00Z   16</span><br></pre></td></tr></table></figure>

<h3 id="示例3-同时配置执行时间间隔和查询时间范围"><a href="#示例3-同时配置执行时间间隔和查询时间范围" class="headerlink" title="示例3 同时配置执行时间间隔和查询时间范围"></a>示例3 同时配置执行时间间隔和查询时间范围</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_advanced_every_for&quot; ON &quot;transportation&quot;</span><br><span class="line">RESAMPLE EVERY 1h FOR 90m</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(&quot;passengers&quot;) INTO &quot;average_passengers&quot; FROM &quot;bus_data&quot; GROUP BY time(30m)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>这里配置了执行间隔为1小时，而查询范围90分钟，最后分组是30分钟，每次插入了三条记录。执行流程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">At 8:00 cq_advanced_every_for 查询时间范围 time &gt;= &#x27;6:30&#x27; AND time &lt; &#x27;8:00&#x27;.</span><br><span class="line">插入三条记录</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T06:30:00Z   3</span><br><span class="line">2016-08-28T07:00:00Z   6.5</span><br><span class="line">2016-08-28T07:30:00Z   7.5</span><br><span class="line">At 9:00 cq_advanced_every_for 查询时间范围 time &gt;= &#x27;7:30&#x27; AND time &lt; &#x27;9:00&#x27;.</span><br><span class="line">插入三条记录</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T07:30:00Z   7.5</span><br><span class="line">2016-08-28T08:00:00Z   11.5</span><br><span class="line">2016-08-28T08:30:00Z   16</span><br></pre></td></tr></table></figure>

<p>最终结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;average_passengers&quot;</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T06:30:00Z   3</span><br><span class="line">2016-08-28T07:00:00Z   6.5</span><br><span class="line">2016-08-28T07:30:00Z   7.5</span><br><span class="line">2016-08-28T08:00:00Z   11.5</span><br><span class="line">2016-08-28T08:30:00Z   16</span><br></pre></td></tr></table></figure>

<h3 id="示例4-配置查询时间范围和FILL填充"><a href="#示例4-配置查询时间范围和FILL填充" class="headerlink" title="示例4 配置查询时间范围和FILL填充"></a>示例4 配置查询时间范围和FILL填充</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE CONTINUOUS QUERY &quot;cq_advanced_for_fill&quot; ON &quot;transportation&quot;</span><br><span class="line">RESAMPLE FOR 2h</span><br><span class="line">BEGIN</span><br><span class="line">  SELECT mean(&quot;passengers&quot;) INTO &quot;average_passengers&quot; FROM &quot;bus_data&quot; GROUP BY time(1h) fill(1000)</span><br><span class="line">END</span><br></pre></td></tr></table></figure>

<p>在前面值配置查询时间范围的基础上，加上FILL填充空的记录。执行流程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">At 6:00, cq_advanced_for_fill 查询时间范围：time &gt;= &#x27;4:00&#x27; AND time &lt; &#x27;6:00&#x27;，没有数据，不填充。</span><br><span class="line"></span><br><span class="line">At 7:00, cq_advanced_for_fill 查询时间范围：time &gt;= &#x27;5:00&#x27; AND time &lt; &#x27;7:00&#x27;. 写入两条记录，没有数据的时间点填充1000。</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T05:00:00Z   1000          &lt;------ fill(1000)</span><br><span class="line">2016-08-28T06:00:00Z   3             &lt;------ average of 2 and 4</span><br><span class="line"></span><br><span class="line">[…] At 11:00, cq_advanced_for_fill 查询时间范围：time &gt;= &#x27;9:00&#x27; AND time &lt; &#x27;11:00&#x27;.写入两条记录，没有数据的点填充1000。</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">2016-08-28T09:00:00Z   20            &lt;------ average of 20</span><br><span class="line">2016-08-28T10:00:00Z   1000          &lt;------ fill(1000)     </span><br><span class="line"></span><br><span class="line">At 12:00, cq_advanced_for_fill 查询时间范围：time &gt;= &#x27;10:00&#x27; AND time &lt; &#x27;12:00&#x27;。没有数据，不填充。</span><br></pre></td></tr></table></figure>

<p>最终结果:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; SELECT * FROM &quot;average_passengers&quot;</span><br><span class="line">name: average_passengers</span><br><span class="line">------------------------</span><br><span class="line">time                   mean</span><br><span class="line">2016-08-28T05:00:00Z   1000</span><br><span class="line">2016-08-28T06:00:00Z   3</span><br><span class="line">2016-08-28T07:00:00Z   7</span><br><span class="line">2016-08-28T08:00:00Z   13.75</span><br><span class="line">2016-08-28T09:00:00Z   20</span><br><span class="line">2016-08-28T10:00:00Z   1000</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://docs.influxdata.com/influxdb/v1.3/">https://docs.influxdata.com/influxdb/v1.3/</a></li>
<li><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/%25E6%25A8%2599%25E6%25BA%2596%25E5%25B7%25AE">https://zh.wikipedia.org/wiki/%E6%A8%99%E6%BA%96%E5%B7%AE</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">我如何使用 Django + Vue.js 快速构建项目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-18 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-18T00:00:00+08:00">2019-05-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:24" itemprop="dateModified" datetime="2025-09-09T08:40:24+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">编程技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>写在开头：<br>1看这里的时候，请确保你已将熟悉JavaScript以及了解Vue的语法， Django的语法也略懂一二。<br>如果不是很了解，请点击这里查看学习文档<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/index.html">Vue</a>、<a target="_blank" rel="noopener" href="https://docs.djangoproject.com/en/2.1/topics/">Django</a>，否则下文可能有些不好理解。<br>2文章有点长 ，因为包含了一个Index.vue页面。<br>3第一次写长文章，所以排版很尴尬，请指正。</p>
</blockquote>
<ol>
<li><a href="">安装Vue环境</a></li>
<li>安装<a target="_blank" rel="noopener" href="http://element-cn.eleme.io/#/zh-CN/component/quickstart">element-ui</a>组件 使用其组件美化界面</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i element-ui -S ||  npm install element-ui --save</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">main.js </span><br><span class="line">    import ElementUI from &#x27;element-ui&#x27;;</span><br><span class="line">    import &#x27;element-ui/lib/theme-chalk/index.css&#x27;;</span><br><span class="line"></span><br><span class="line">    Vue.use(ElementUI)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装<a target="_blank" rel="noopener" href="https://www.kancloud.cn/yunye/axios/234845">axios</a> 使用其完成前端到后端的请求</li>
</ol>
<blockquote>
<p>由于axios 使用Vue.use(无效)，所以要将其绑定在Vue原型上</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios --save |  brew install axios --save</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line"></span><br><span class="line">axios.defaults.baseURL = &#x27;http://localhost:8000&#x27;  </span><br><span class="line"></span><br><span class="line">Vue.prototype.$axios = axios</span><br></pre></td></tr></table></figure>

<ol>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d78e5392e54a">安装Django及配置环境</a></li>
<li>配置mysql数据库，使用sqlite3的 跳过此步骤无需配置</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">settings.py</span><br><span class="line">  DATABASES = &#123;</span><br><span class="line">    &#x27;default&#x27;: &#123;  #</span><br><span class="line">        &#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;,  # 不同库有不同的殷勤</span><br><span class="line">        &#x27;NAME&#x27;: &#x27;python_use&#x27;,  # 使用的库名</span><br><span class="line">        &#x27;USER&#x27;: &#x27;root&#x27;,</span><br><span class="line">        &#x27;PASSWORD&#x27;: &#x27;&#x27;,</span><br><span class="line">        &#x27;HOST&#x27;: &#x27;127.0.0.1&#x27;,</span><br><span class="line">        &#x27;PORT&#x27;: &#x27;3306&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>配置完成后请查看django是否报错，不报错即连接成功</p>
<ol start="3">
<li>安装 <a target="_blank" rel="noopener" href="https://pypi.org/project/pip/">pip</a> 及 <a target="_blank" rel="noopener" href="https://pypi.org/project/django-cors-headers/">django-cors-headers</a></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">settings.py</span><br><span class="line">  </span><br><span class="line">  INSTALLED_APPS = &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#x27;corsheaders&#x27;,</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  MIDDLEWARE = [  </span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    &#x27;corsheaders.middleware.CorsMiddleware&#x27;,</span><br><span class="line">    &#x27;django.middleware.common.CommonMiddleware&#x27;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  CORS_ORIGIN_ALLOW_ALL = True </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<hr>
<p>至此，已将Vue和Django安装并配置好，接下来写一个简单的CRUD操作。<br>请确认你的整个项目目录与此类似</p>
<p>![](Vue + Django&#x2F;2064404-d3a828d4530715b4.png)</p>
<p>项目目录结构</p>
<p>以下使用的目录均为此图所示</p>
<hr>
<ol>
<li>配置路由</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">first/urls.py </span><br><span class="line">  urlpatterns = [</span><br><span class="line">    url(r&#x27;^admin/&#x27;, admin.site.urls),</span><br><span class="line">    url(r&#x27;&#x27;, include(&#x27;crud.urls&#x27;)),</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">crud/urls.py</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  from django.conf.urls import url</span><br><span class="line">  from . import views</span><br><span class="line"></span><br><span class="line">  urlpatterns = [</span><br><span class="line">    url(&#x27;create/&#x27;, views.create, name = &#x27;create&#x27;),</span><br><span class="line">    url(&#x27;read&#x27;, views.read, name = &#x27;read&#x27;),</span><br><span class="line">    url(&#x27;update/&#x27;, views.update, name = &#x27;update&#x27;),</span><br><span class="line">    url(&#x27;delete/&#x27;, views.delete, name = &#x27;delete&#x27;),</span><br><span class="line">    url(&#x27;search&#x27;, views.search, name = &#x27;search&#x27;)</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建models，即在数据库中创建表</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">class Books ( models.Model ):</span><br><span class="line">  book_name = models.CharField( max_length = 255 )</span><br><span class="line">  book_price = models.DecimalField( max_digits = 5, decimal_places = 2 )</span><br><span class="line">  book_time = models.DateTimeField( &#x27;保存日期&#x27;, auto_now_add = True )</span><br></pre></td></tr></table></figure>

<p>Models创建完成后运行命令 将其应用到数据库中并创建表<br>如果不懂 请返回顶部阅读Django文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写views.py 完成增删改查的逻辑</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 1 获取前端传递来的参数</span><br><span class="line"># 1.1 get方法发送的参数</span><br><span class="line">  request.GET[&#x27;content&#x27;]</span><br><span class="line"># 1.2 post方法发送的参数</span><br><span class="line">  obj = json.loads(request.body)</span><br><span class="line">  name = obj[&#x27;name&#x27;]</span><br><span class="line"># 2 由于使用Books.objects下的方法，获取到的数据为Query Set类型， </span><br><span class="line">#   所以需要使用serializers.serialize(&quot;json&quot;, books)</span><br><span class="line"># 将查询到的数据进行序列化，变成可读的对象。</span><br><span class="line"># 3 向前端返回处理结果</span><br><span class="line"> return HttpResponse(json.dumps(res), content_type=&quot;application/json&quot;) </span><br><span class="line"># 将res变成json字符串返回给前端。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">from __future__ import unicode_literals</span><br><span class="line">from django.shortcuts import render</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line">import json</span><br><span class="line">from django.core import serializers</span><br><span class="line">from django.utils import timezone</span><br><span class="line">from crud.models import Books</span><br><span class="line"></span><br><span class="line">def search(request):</span><br><span class="line">    content = request.GET[&#x27;content&#x27;]</span><br><span class="line">    try:</span><br><span class="line">        books = serializers.serialize(&quot;json&quot;,Books.objects.filter(book_name__contains=content))</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 200,</span><br><span class="line">            &quot;data&quot;: books</span><br><span class="line">        &#125;</span><br><span class="line">        print(books)</span><br><span class="line">    except Exception,e:</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 0,</span><br><span class="line">            &quot;errMsg&quot;: e</span><br><span class="line">        &#125;</span><br><span class="line">    return HttpResponse(json.dumps(res), content_type=&quot;application/json&quot;)</span><br><span class="line"></span><br><span class="line">def create(request):</span><br><span class="line">    print(&#x27;create&#x27;)</span><br><span class="line">    obj = json.loads(request.body)</span><br><span class="line">    name = obj[&#x27;name&#x27;]</span><br><span class="line">    price = obj[&#x27;price&#x27;]</span><br><span class="line">    try:</span><br><span class="line">        book = Books(book_name=name, book_price=price, book_time=timezone.now())</span><br><span class="line">        book.save()</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 200,</span><br><span class="line">        &#125;</span><br><span class="line">    except Exception,e:</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 0,</span><br><span class="line">            &quot;errMsg&quot;: e</span><br><span class="line">        &#125;</span><br><span class="line">    return HttpResponse(json.dumps(res), content_type=&quot;application/json&quot;)</span><br><span class="line"></span><br><span class="line">def read(request):</span><br><span class="line">    print(&#x27;read&#x27;)</span><br><span class="line">    try:</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 200,</span><br><span class="line">            &quot;data&quot;: serializers.serialize(&quot;json&quot;,Books.objects.filter())</span><br><span class="line">        &#125;</span><br><span class="line">    except Exception,e:</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 0,</span><br><span class="line">            &quot;errMsg&quot;: e</span><br><span class="line">        &#125;</span><br><span class="line">    return HttpResponse(json.dumps(res), content_type=&quot;application/json&quot;)</span><br><span class="line"></span><br><span class="line">def update(request):</span><br><span class="line">    print(&#x27;update&#x27;)</span><br><span class="line">    obj = json.loads(request.body)</span><br><span class="line">    pid = obj[&#x27;id&#x27;]</span><br><span class="line">    name = obj[&#x27;name&#x27;]</span><br><span class="line">    price = obj[&#x27;price&#x27;]</span><br><span class="line">    try:</span><br><span class="line">        Books.objects.filter(id=pid).update(book_price=price, book_name=name)</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 200</span><br><span class="line">        &#125;</span><br><span class="line">    except Exception,e:</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 0,</span><br><span class="line">            &quot;errMsg&quot;: e</span><br><span class="line">        &#125;</span><br><span class="line">    return HttpResponse(json.dumps(res), content_type=&quot;application/json&quot;)</span><br><span class="line"></span><br><span class="line">def delete(request):</span><br><span class="line">    print(&#x27;delete&#x27;)</span><br><span class="line">    obj = json.loads(request.body)</span><br><span class="line">    print(obj)</span><br><span class="line">    pid = obj[&#x27;id&#x27;]</span><br><span class="line">    try:</span><br><span class="line">        Books.objects.filter(id=pid).delete()</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 200</span><br><span class="line">        &#125;</span><br><span class="line">    except Exception,e:</span><br><span class="line">        res = &#123;</span><br><span class="line">            &quot;code&quot;: 0,</span><br><span class="line">            &quot;errMsg&quot;: e</span><br><span class="line">        &#125;</span><br><span class="line">    return HttpResponse(json.dumps(res), content_type=&quot;application/json&quot;)</span><br></pre></td></tr></table></figure>

<hr>
<ol>
<li>配置路由</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">frontend/src/router/index.js</span><br><span class="line">  </span><br><span class="line">  import Vue from &#x27;vue&#x27;</span><br><span class="line">  import Router from &#x27;vue-router&#x27;</span><br><span class="line">  import Index from &#x27;@/components/Index&#x27;</span><br><span class="line"></span><br><span class="line">  Vue.use(Router)</span><br><span class="line"></span><br><span class="line">  export default new Router(&#123;</span><br><span class="line">    routes: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: &#x27;/&#x27;,</span><br><span class="line">        name: &#x27;index&#x27;,</span><br><span class="line">        component: Index</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写路由中使用到的组件 与上面import所用名称和路径需要一致，请耐心看完注释。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">this.$axios.get(&#x27;/search&#x27;, &#123;</span><br><span class="line">  params: &#123;  </span><br><span class="line">     content: this.search   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;).then(res =&gt; &#123;</span><br><span class="line">  console.log(res)</span><br><span class="line">&#125;)</span><br><span class="line">this.$axios.post(&#x27;/delete/&#x27;, JSON.stringify(row)).then(res =&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  console.log(res)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>以下为Index.vue的全部页面，包含增删改查的基本操作，以及更改和新增时的弹出框：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">frontend/src/components/Index.vue</span><br><span class="line">  &lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; round @click=&quot;handleShowCreate&quot;&gt;增加书籍&lt;/el-button&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;search&quot; placeholder=&quot;请输入内容&quot; style=&quot;width: 200px&quot;  @keyup.enter.native=&quot;handleSearch&quot;/&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; round @click=&quot;handleSearch&quot;&gt;搜索&lt;/el-button&gt;</span><br><span class="line">      &lt;el-table :data=&quot;booksData&quot; height=&quot;250&quot; border style=&quot;width: 600px; margin: 40px auto;&quot;  v-loading=&quot;loading&quot;&gt;</span><br><span class="line">        &lt;el-table-column</span><br><span class="line">          prop=&quot;book_name&quot;</span><br><span class="line">          label=&quot;书名&quot;</span><br><span class="line">          align=&quot;center&quot;</span><br><span class="line">          width=&quot;200&quot;&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column</span><br><span class="line">          prop=&quot;book_price&quot;</span><br><span class="line">          label=&quot;价格&quot;</span><br><span class="line">          align=&quot;center&quot;</span><br><span class="line">          width=&quot;200&quot;&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot;&gt;</span><br><span class="line">          &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">              size=&quot;mini&quot;</span><br><span class="line">              @click=&quot;handleUpdate(scope.$index, scope.row)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">              size=&quot;mini&quot;</span><br><span class="line">              type=&quot;danger&quot;</span><br><span class="line">              @click=&quot;handleDelete(scope.$index, scope.row)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">          &lt;/template&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">      &lt;el-dialog title=&quot;修改书籍&quot; :visible.sync=&quot;dialogUpdateVisible&quot;&gt;</span><br><span class="line">        &lt;el-form :model=&quot;updateData&quot;&gt;</span><br><span class="line">          &lt;el-form-item label=&quot;书籍名称&quot;&gt;</span><br><span class="line">            &lt;el-input auto-complete=&quot;off&quot; v-model=&quot;updateData.name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item label=&quot;书籍价格&quot;&gt;</span><br><span class="line">            &lt;el-input-number v-model=&quot;updateData.price&quot; :precision=&quot;2&quot; :step=&quot;0.01&quot; :max=&quot;9999&quot;&gt;&lt;/el-input-number&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">        &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">          &lt;el-button @click=&quot;handleCancel(&#x27;dialogUpdateVisible&#x27;)&quot;&gt;Cancel&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;handleConfirm(&#x27;dialogUpdateVisible&#x27;)&quot;&gt;Submit&lt;/el-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-dialog&gt;</span><br><span class="line">      &lt;el-dialog title=&quot;增加书籍&quot; :visible.sync=&quot;dialogCreateVisible&quot;&gt;</span><br><span class="line">        &lt;el-form :model=&quot;createData&quot;&gt;</span><br><span class="line">          &lt;el-form-item label=&quot;书籍名称&quot;&gt;</span><br><span class="line">            &lt;el-input auto-complete=&quot;off&quot; v-model=&quot;createData.name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item label=&quot;书籍价格&quot;&gt;</span><br><span class="line">            &lt;el-input-number v-model=&quot;createData.price&quot; :precision=&quot;2&quot; :step=&quot;0.01&quot; :max=&quot;9999&quot;&gt;&lt;/el-input-number&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">        &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">          &lt;el-button @click=&quot;handleCancel(&#x27;dialogCreateVisible&#x27;)&quot;&gt;Cancel&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;handleCreate(&#x27;dialogCreateVisible&#x27;)&quot;&gt;Submit&lt;/el-button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-dialog&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">  &lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &#x27;index&#x27;,</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        search: &#x27;&#x27;,</span><br><span class="line">        booksData: [],</span><br><span class="line">        oldData: &#123;&#125;,</span><br><span class="line">        updateData: &#123;&#125;,</span><br><span class="line">        createData: &#123;</span><br><span class="line">          name: &#x27;&#x27;,</span><br><span class="line">          price: 0</span><br><span class="line">        &#125;,</span><br><span class="line">        dialogUpdateVisible: false,</span><br><span class="line">        dialogCreateVisible: false,</span><br><span class="line">        loading: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleShowCreate () &#123;</span><br><span class="line">        this.dialogCreateVisible = true</span><br><span class="line">      &#125;,</span><br><span class="line">      handleCreate () &#123;</span><br><span class="line">        if (this.createData.name === &#x27;&#x27;) &#123;</span><br><span class="line">          this.$message.error(&#x27;please input book name&#x27;)</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">        if (this.createData.price === 0) &#123;</span><br><span class="line">          this.$message.error(&#x27;please input book price&#x27;)</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">        this.$axios.post(&#x27;/create/&#x27;, JSON.stringify(this.createData)).then(res =&gt; &#123;</span><br><span class="line">          if (res.data.code === 200) &#123;</span><br><span class="line">            this.$message.success(`create $&#123;this.createData.name&#125; success`)</span><br><span class="line">            this.dialogCreateVisible = false</span><br><span class="line">            this.handleRead()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.error(&quot;can&#x27;t read books database&quot;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        console.log(this.createData)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleRead () &#123;</span><br><span class="line">        this.booksData = []</span><br><span class="line">        this.$axios.get(&#x27;/read&#x27;).then(res =&gt; &#123;</span><br><span class="line">          this.loading = false</span><br><span class="line">          if (res.data.code === 200) &#123;</span><br><span class="line">            let books = JSON.parse(res.data.data)</span><br><span class="line">            for (let i in books) &#123;</span><br><span class="line">              books[i].fields.id = books[i].pk</span><br><span class="line">              books[i].fields.book_price = Number(books[i].fields.book_price)</span><br><span class="line">              this.booksData.push(books[i].fields)</span><br><span class="line">            &#125;</span><br><span class="line">            console.log(this.booksData)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.console.error(&quot;can&#x27;t read books database&quot;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).catch((res) =&gt; &#123;</span><br><span class="line">          console.log(res)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleUpdate (index, row) &#123;</span><br><span class="line">        this.dialogUpdateVisible = true</span><br><span class="line">        this.updateData = Object.assign(&#123;&#125;, &#123;</span><br><span class="line">          id: row.id,</span><br><span class="line">          name: row.book_name,</span><br><span class="line">          price: row.book_price,</span><br><span class="line">          time: row.book_time</span><br><span class="line">        &#125;)</span><br><span class="line">        this.oldData = Object.assign(&#123;&#125;, &#123;</span><br><span class="line">          id: row.id,</span><br><span class="line">          name: row.book_name,</span><br><span class="line">          price: row.book_price,</span><br><span class="line">          time: row.book_time</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleDelete (index, row) &#123;</span><br><span class="line">        this.$confirm(`are you sure to delete $&#123;this.updateData.name&#125; ?`, &#x27;&#x27;, &#123;</span><br><span class="line">          confirmButtonText: &#x27;submit&#x27;,</span><br><span class="line">          cancelButtonText: &#x27;cancel&#x27;,</span><br><span class="line">          type: &#x27;warning&#x27;</span><br><span class="line">        &#125;).then(() =&gt; &#123;</span><br><span class="line">          this.$axios.post(&#x27;/delete/&#x27;, JSON.stringify(row)).then(res =&gt; &#123;</span><br><span class="line">            if (res.data.code === 200) &#123;</span><br><span class="line">              this.$message.success(`delete $&#123;this.updateData.name&#125; success`)</span><br><span class="line">              this.handleRead()</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message.error(&quot;can&#x27;t read books database&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;).catch(() =&gt; &#123;</span><br><span class="line">          this.$message.info(&#x27;cancel delete&#x27;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleCancel (arg) &#123;</span><br><span class="line">        this.$message.info(&#x27;cancel&#x27;)</span><br><span class="line">        this[arg] = false</span><br><span class="line">      &#125;,</span><br><span class="line">      handleConfirm (arg) &#123;</span><br><span class="line">        if (this.updateData.name === this.oldData.name &amp;&amp; this.updateData.price === this.oldData.price) &#123;</span><br><span class="line">          this.$message.error(&#x27;please update something or cancel&#x27;)</span><br><span class="line">          return</span><br><span class="line">        &#125;</span><br><span class="line">        this[arg] = false</span><br><span class="line">        this.$axios.post(&#x27;/update/&#x27;, JSON.stringify(this.updateData)).then(res =&gt; &#123;</span><br><span class="line">          if (res.data.code === 200) &#123;</span><br><span class="line">            this.$message.success(`update $&#123;this.updateData.name&#125; success`)</span><br><span class="line">            this.handleRead()</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.error(&quot;can&#x27;t read books database&quot;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleSearch () &#123;</span><br><span class="line">        this.$axios.get(&#x27;search&#x27;, &#123;</span><br><span class="line">          params: &#123;</span><br><span class="line">            content: this.search</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).then(res =&gt; &#123;</span><br><span class="line">          if (res.data.code === 200) &#123;</span><br><span class="line">            if (res.data.data &amp;&amp; JSON.parse(res.data.data).length &gt; 0) &#123;</span><br><span class="line">              this.booksData = []</span><br><span class="line">              let books = JSON.parse(res.data.data)</span><br><span class="line">              for (let i in books) &#123;</span><br><span class="line">                let obj = &#123;</span><br><span class="line">                  id: books[i].pk,</span><br><span class="line">                  book_name: books[i].fields.book_name,</span><br><span class="line">                  book_price: Number(books[i].fields.book_price),</span><br><span class="line">                  book_time: books[i].fields.book_time</span><br><span class="line">                &#125;</span><br><span class="line">                this.booksData.push(obj)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message.error(`can&#x27;t search contains of &#x27;$&#123;this.search&#125;&#x27; in database`)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.error(`can&#x27;t search books in database`)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted () &#123;</span><br><span class="line">      this.handleRead()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>到这里，一个增删改查基本操作的页面就写完了，如果哪里有问题可以留言指正。 git源码以上传， 没事可以star&#x2F;fork 更新将在以下附注后增加。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/RogersLei/django-vue">https://github.com/RogersLei/django-vue</a></p>
</blockquote>
<hr>
<p>附注 ：</p>
<ol>
<li><p>Vue添加事件所用到的修饰符：</p>
<p>![](Vue + Django&#x2F;2064404-1aa984b701bf3e11.png)</p>
<p>Vue事件绑定修饰符</p>
</li>
<li><p>Django中模糊查询用到的语法：</p>
</li>
</ol>
<blockquote>
<p>YourModels.objects.filter(headline__contains&#x3D;str)<br>字段名__contains &#x2F; __icontains 忽略大小写</p>
</blockquote>
<p>更多精彩内容，就在简书APP</p>
<p>“小礼物走一走，来简书关注我”</p>
<p>还没有人赞赏，支持一下</p>
<p>总资产23共写了2.2W字获得33个赞共22个粉丝</p>
<h3 id="推荐阅读更多精彩内容"><a href="#推荐阅读更多精彩内容" class="headerlink" title="推荐阅读更多精彩内容"></a>推荐阅读<a target="_blank" rel="noopener" href="https://www.jianshu.com/">更多精彩内容</a></h3><ul>
<li><p>一.前言 最近接手了一个项目，后端是django，前端是django自带的模板，用的是jinja2，写了一段时间发…</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cbd747e36ef1"><img src="https://upload-images.jianshu.io/upload_images/12026440-8ede9a6ddebc09b1.png?imageMogr2/auto-orient/strip%7CimageView2/1/w/300/h/240/format/webp"></a></p>
</li>
<li><p>组织文章借鉴 ——培训师的21项修炼 书籍结构：错误的案例情景重现-抛出问题，传道受业解惑也 我们假设一个场景，大…</p>
</li>
<li><p>每天总是忙忙碌碌，感觉时间完全不够用，更不要说是学习了，可是忙忙碌碌到最后感觉收获也很小，就像大家说的，瞎忙活。…</p>
</li>
<li><p>和姑姑聊起当时借钱给已故父亲治病时的场景，我依稀记得当时我和涛古，妈妈给厂里老板下跪借那三万块的场景。这辈子希望以…</p>
</li>
</ul>
<p>本文整合Django和Vue.js  并引入elementUi 实现前后端分离项目环境</p>
<p>最终的成品是设计出一个ElementUi风格的页面可以添加和显示学生信息.</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110742708.png" class="">

<p>Django作为Python 三大Web框架之一,因其集成了大量的组件(例如: Models Admin Form 等等)而大受欢迎,但是他本身自带的template模板实在是有点弱.于是考虑整合Vue.js同时引入ElementUI 组件,可以更加快速高效的开发出美观实用的Web页面.</p>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p><strong>本文版本:Python 3.5</strong></p>
<p>安装教程: <a target="_blank" rel="noopener" href="https://www.runoob.com/python3/python3-install.html">https://www.runoob.com/python3/python3-install.html</a></p>
<h2 id="Pycharm"><a href="#Pycharm" class="headerlink" title="Pycharm"></a>Pycharm</h2><p><strong>本文版本:2019.1.3</strong> </p>
<p>PyCharm 2019.1.3 (Community Edition)</p>
<p>安装教程:<a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/pycharm-windows-install.html">https://www.runoob.com/w3cnote/pycharm-windows-install.html</a></p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110742881.png" class="">

<h2 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h2><p><strong>本文版本:2.2.3</strong> </p>
<p>安装教程:<a target="_blank" rel="noopener" href="https://www.runoob.com/django/django-install.html">https://www.runoob.com/django/django-install.html</a></p>
<h2 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a>node.js</h2><p><strong>本文版本:10.16.3</strong></p>
<p>安装教程:<a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-install-setup.html">https://www.runoob.com/nodejs/nodejs-install-setup.html</a></p>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p><strong>本文版本: 8.0.13 for Win64</strong> </p>
<p>安装教程:<a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-install.html">https://www.runoob.com/mysql/mysql-install.html</a></p>
<p><em>本文的Pycharm为社区版,如果为专业版则字段Django项目的创建选项,创建项目将更加简单.</em></p>
<h2 id="1-创建django项目-DjangoElementUI"><a href="#1-创建django项目-DjangoElementUI" class="headerlink" title="1.创建django项目:DjangoElementUI"></a>1.创建django项目:DjangoElementUI</h2><p>创建文件夹E:\PycharmProjects:</p>
<p>在项目文件夹目录输入Windows 命令行如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin.py startproject DjangoElementUI</span><br></pre></td></tr></table></figure>

<p>成功创建项目完成后文件夹结构如下图:</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110743225.png" class="">

<p>进入项目文件夹目录,在目录中输入命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver 0.0.0.0:8000</span><br></pre></td></tr></table></figure>

<p>看到如下提示则为项目创建成功</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110743535.png" class="">

<p>在浏览器输入你服务器的 ip（这里我们输入本机 IP 地址： <strong>127.0.0.1:8000</strong>） 及端口号，如果正常启动，输出结果如下：</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110743780.png" class="">

<h2 id="2-数据库配置"><a href="#2-数据库配置" class="headerlink" title="2.数据库配置"></a>2.数据库配置</h2><p>Django 对各种数据库提供了很好的支持，包括：PostgreSQL、MySQL、SQLite、Oracle。</p>
<p>Django 为这些数据库提供了统一的调用API。 我们可以根据自己业务需求选择不同的数据库。</p>
<p>MySQL 是 Web 应用中最常用的数据库。</p>
<p>本文采用MySQL</p>
<p>第一次使用MySQL需要安装 MySQL驱动,在项目文件夹目录下执行以下命令安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure>

<p>Django无法直接创建数据库(只能操作到数据表层),我们需要手工创建MySQL数据库.</p>
<p><strong>以下通过命令行创建 MySQL 数据库:Django_ElementUI</strong></p>
<h3 id="登录数据库"><a href="#登录数据库" class="headerlink" title="登录数据库:"></a>登录数据库:</h3><p>数据库安装文件夹bin文件夹下输入命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p </span><br></pre></td></tr></table></figure>

<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110743916.png" class="">

<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库:"></a>创建数据库:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create DATABASE Django_ElementUI DEFAULT CHARSET utf8;</span><br></pre></td></tr></table></figure>

<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744028.png" class="">

<h3 id="Django配置数据库"><a href="#Django配置数据库" class="headerlink" title="Django配置数据库"></a>Django配置数据库</h3><p>在项目的 settings.py 文件中找到 DATABASES 配置项，将其信息修改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;ENGINE&#x27;: &#x27;django.db.backends.mysql&#x27;,  &#x27;NAME&#x27;: &#x27;Django_ElementUI&#x27;,  </span><br></pre></td></tr></table></figure>

<p>在与 settings.py 同级目录下的 __init__.py 中引入模块和进行配置 (告诉 Django 使用 pymysql 模块连接 mysql 数据库)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<h2 id="3-利用Django模型设计数据库表"><a href="#3-利用Django模型设计数据库表" class="headerlink" title="3.利用Django模型设计数据库表"></a>3.利用Django模型设计数据库表</h2><p>Django 规定，如果要使用模型，必须要创建一个 app。</p>
<h3 id="创建Django-APP-myApp"><a href="#创建Django-APP-myApp" class="headerlink" title="创建Django APP:myApp"></a>创建Django APP:myApp</h3><p>我们使用以下命令创建一个Django app:myApp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin.py startapp myApp</span><br></pre></td></tr></table></figure>

<p>成功后的项目文件夹目录如下:</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744121.png" class="">

<h3 id="设计数据库表"><a href="#设计数据库表" class="headerlink" title="设计数据库表"></a>设计数据库表</h3><p>在myApp下的models.py设计表:</p>
<p>这里我们设计一个Student表,用来存储学生信息.</p>
<p><strong>表字段</strong></p>
<p><strong>字段类型</strong></p>
<p><strong>含义</strong></p>
<p>student_name</p>
<p>Varchar类型</p>
<p>学生姓名</p>
<p>student_sex</p>
<p>Varchar类型</p>
<p>学生性别</p>
<p>create_time</p>
<p>Datetime类型</p>
<p>创建日期时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.db import modelsclass Student(models.Model):    student_name = models.CharField(max_length=64)    student_sex = models.CharField(max_length=3)    create_time = models.DateTimeField(auto_now=True)</span><br></pre></td></tr></table></figure>

<p>在 settings.py 中找到INSTALLED_APPS这一项，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;django.contrib.contenttypes&#x27;,&#x27;django.contrib.sessions&#x27;,&#x27;django.contrib.messages&#x27;,&#x27;django.contrib.staticfiles&#x27;,</span><br></pre></td></tr></table></figure>

<h3 id="生成数据库迁移文件"><a href="#生成数据库迁移文件" class="headerlink" title="生成数据库迁移文件"></a><strong>生成数据库迁移文件</strong></h3><p>在命令行中运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations myApp</span><br></pre></td></tr></table></figure>

<p>执行成功后结果:</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744177.png" class="">

<h3 id="执行迁移文件来完成数据库表的创建"><a href="#执行迁移文件来完成数据库表的创建" class="headerlink" title="执行迁移文件来完成数据库表的创建"></a><strong>执行迁移文件来完成数据库表的创建</strong></h3><p>在命令行中运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate myApp</span><br></pre></td></tr></table></figure>

<p>执行成功后结果:</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744231.png" class="">

<p>查看数据库中数据库表已经生成成功</p>
<p>(django默认在makemigrations会为表对象创建主键id,id &#x3D; models.AutoField(primary_key&#x3D;True))</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744281.png" class="">

<h2 id="4-Django创建新增和查询学生信息接口"><a href="#4-Django创建新增和查询学生信息接口" class="headerlink" title="4.Django创建新增和查询学生信息接口"></a>4.Django创建新增和查询学生信息接口</h2><p>在myApp目录下的views.py中创建两个视图函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from __future__ import unicode_literalsfrom django.http import JsonResponsefrom django.core import serializersfrom django.shortcuts import renderfrom django.views.decorators.http import require_http_methodsfrom myApp.models import Student@require_http_methods([&quot;GET&quot;])def add_student(request):        student = Student(student_name=request.GET.get(&#x27;student_name&#x27;))        response[&#x27;msg&#x27;] = &#x27;success&#x27;        response[&#x27;error_num&#x27;] = 0        response[&#x27;error_num&#x27;] = 1return JsonResponse(response)@require_http_methods([&quot;GET&quot;])def show_students(request):        students = Student.objects.filter()        response[&#x27;list&#x27;] = json.loads(serializers.serialize(&quot;json&quot;, students))        response[&#x27;msg&#x27;] = &#x27;success&#x27;        response[&#x27;error_num&#x27;] = 0        response[&#x27;error_num&#x27;] = 1return JsonResponse(response)</span><br></pre></td></tr></table></figure>

<h2 id="5-配置路由"><a href="#5-配置路由" class="headerlink" title="5.配置路由"></a>5.配置路由</h2><p>1.在myApp目录下，新增一个urls.py文件,用于创建此APP下的分支路由，把新增的两个视图函数添加到路由里面.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.conf.urls import url    url(r&#x27;^add_book/&#x27;, views.add_book),    url(r&#x27;^show_books/&#x27;, views.show_books),</span><br></pre></td></tr></table></figure>

<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744341.png" class="">

<p>2.把上面创建的myApp下的分支路由加到DjangoElementUI下的主路由中urls.py.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import adminfrom django.urls import pathfrom django.conf.urls import urlfrom django.conf.urls import include    url(r&#x27;^admin/&#x27;, admin.site.urls),    url(r&#x27;^api/&#x27;, include(urls)),</span><br></pre></td></tr></table></figure>

<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744391.png" class="">

<p>至此Django部分已经完成,总结下我们利用Django完成了数据库的创建,并创建了两个视图函数作为接口给前端调用.</p>
<p>1.安装vue-cli脚手架</p>
<p>在DjangoElementUI根目录下输入命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vue-cli</span><br></pre></td></tr></table></figure>

<p>2.安装好后，新建一个前端工程目录：appfront</p>
<p>在DjangoElementUI项目根目录下输入命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue-init webpack appfront</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/2021041417083995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FnZWxlZQ==,size_16,color_FFFFFF,t_70"></p>
<p>3.进入appfront目录安装vue所需要的依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20210414171354867.png"></p>
<p>4.安装ElementUI</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i element-ui -S</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/2021041417170686.png"></p>
<p>5.创建新vue页面</p>
<p>在src&#x2F;component文件夹下新建一个名为Studengt.vue的组件，通过调用之前在Django上写好的api，实现添加学生和展示学生信息的功能.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row display=&quot;margin-top:10px&quot;&gt;&lt;el-input v-model=&quot;input&quot; placeholder=&quot;请输入学生姓名&quot; style=&quot;display:inline-table; width: 30%; float:left&quot;&gt;&lt;/el-input&gt;&lt;el-button type=&quot;primary&quot; @click=&quot;addStudent()&quot; style=&quot;float:left; margin: 2px;&quot;&gt;新增&lt;/el-button&gt;&lt;el-table :data=&quot;studentList&quot; style=&quot;width: 100%&quot; border&gt;&lt;el-table-column prop=&quot;id&quot; label=&quot;编号&quot; min-width=&quot;100&quot;&gt;&lt;template scope=&quot;scope&quot;&gt; &#123;&#123; scope.row.pk &#125;&#125; &lt;/template&gt;&lt;el-table-column prop=&quot;student_name&quot; label=&quot;姓名&quot; min-width=&quot;100&quot;&gt;&lt;template scope=&quot;scope&quot;&gt; &#123;&#123; scope.row.fields.student_name &#125;&#125; &lt;/template&gt;&lt;el-table-column prop=&quot;student_sex&quot; label=&quot;性别&quot; min-width=&quot;100&quot;&gt;&lt;template scope=&quot;scope&quot;&gt; &#123;&#123; scope.row.fields.student_sex &#125;&#125; &lt;/template&gt;&lt;el-table-column prop=&quot;add_time&quot; label=&quot;添加时间&quot; min-width=&quot;100&quot;&gt;&lt;template scope=&quot;scope&quot;&gt; &#123;&#123; scope.row.fields.create_time &#125;&#125; &lt;/template&gt;this.$http.get(&#x27;http://127.0.0.1:8000/api/add_student?student_name=&#x27; + this.input)var res = JSON.parse(response.bodyText)if (res.error_num === 0) &#123;this.$message.error(&#x27;新增学生失败，请重试&#x27;)this.$http.get(&#x27;http://127.0.0.1:8000/api/show_students&#x27;)var res = JSON.parse(response.bodyText)if (res.error_num === 0) &#123;this.studentList = res[&#x27;list&#x27;]this.$message.error(&#x27;查询学生失败&#x27;)&lt;!-- Add &quot;scoped&quot; attribute to limit CSS to this component only --&gt;</span><br></pre></td></tr></table></figure>

<p>6.配置路由</p>
<p>appfront&#x2F;router文件夹下的index.js中增加页面路由.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import Router from &#x27;vue-router&#x27;import HelloWorld from &#x27;@/components/HelloWorld&#x27;import Student from &#x27;@/components/Student&#x27;export default new Router(&#123;</span><br></pre></td></tr></table></figure>

<p>appfront文件夹下的main.js中引入ElementUI并注册.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import router from &#x27;./router&#x27;import &#x27;../node_modules/element-ui/lib/theme-chalk/index.css&#x27;import ElementUI from &#x27;element-ui&#x27;Vue.config.productionTip = false</span><br></pre></td></tr></table></figure>

<p>7.打包并启动前端项目</p>
<p> <strong>打包vue项目</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>启动前端项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>出现下面信息则说明我们前端项目已经构建成功.</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744441.png" class="">

<p>去浏览器访问页面地址:<a target="_blank" rel="noopener" href="http://localhost:8080/#/student">http://localhost:8080/#/student</a></p>
<p>出现如下页面说明我们的页面已经成功.</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744491.png" class="">

<p>截止到目前,我们已经成功通过Django创建了一个后端服务,通过Vue.js + ElementUI 实现了前端页面的构建,但是他们运行在各自的服务器,而且前端页面还无法调用后端的接口.</p>
<p>接下来我们需要将两个项目真正的整合到一个成一个项目.</p>
<p>1.引入用于HTTP解析的vue-resource</p>
<p>前端vue项目调用后端需要引入vue-resource</p>
<p>在appfront文件下运行命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install </span><br></pre></td></tr></table></figure>

<p>安装完成后在main.js中引入vue-resource</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import router from &#x27;./router&#x27;import &#x27;../node_modules/element-ui/lib/theme-chalk/index.css&#x27;import ElementUI from &#x27;element-ui&#x27;import VueResource from &#x27;vue-resource&#x27;Vue.config.productionTip = false</span><br></pre></td></tr></table></figure>

<p>2.在Django层注入header</p>
<p>为了让后端可以识别前端需求,我们须要在Django层注入header，用Django的第三方包django-cors-headers来解决跨域问题：</p>
<p>在DjangoElementUI根目录下输入命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure>

<p>在settings.py中增加相关中间件代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;django.middleware.security.SecurityMiddleware&#x27;,&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;,&#x27;corsheaders.middleware.CorsMiddleware&#x27;,     &#x27;django.middleware.common.CommonMiddleware&#x27;,&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;,&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;,&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;,CORS_ORIGIN_ALLOW_ALL = True   </span><br></pre></td></tr></table></figure>

<p>3.修改Django路由</p>
<p>这一步我们通过Django路由配置连接前后端资源.</p>
<p>首先我们把Django的TemplateView指向我们刚才生成的前端dist文件</p>
<p>在DjangoElementUI目录下的urls.py中增加代码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from django.conf.urls import urlfrom django.contrib import adminfrom django.conf.urls import includefrom django.views.generic import TemplateView    url(r&#x27;^admin/&#x27;, admin.site.urls),    url(r&#x27;^api/&#x27;, include(urls)),    url( r&#x27;^vue/&#x27;, TemplateView.as_view( template_name=&quot;index.html&quot; ) )</span><br></pre></td></tr></table></figure>

<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744546.png" class="">

<p>接着修改静态资源文件路径也指向前端appfront 相关文件</p>
<p>在DjangoElementUI目录下的setting.py中增加代码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;BACKEND&#x27;: &#x27;django.template.backends.django.DjangoTemplates&#x27;,&#x27;DIRS&#x27;: [os.path.join(BASE_DIR, &#x27;appfront/dist&#x27;)],  &#x27;django.template.context_processors.debug&#x27;,&#x27;django.template.context_processors.request&#x27;,&#x27;django.contrib.auth.context_processors.auth&#x27;,&#x27;django.contrib.messages.context_processors.messages&#x27;,    os.path.join(BASE_DIR, &quot;appfront/dist/static&quot;)</span><br></pre></td></tr></table></figure>

<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744606.png" class="">

<p>3.重新构建前端项目</p>
<p>appfront目录下输入命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p>重新启动Django项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>

<p>输入地址:<a target="_blank" rel="noopener" href="http://localhost:8000/vue/#/student">http://localhost:8000/vue/#/student</a></p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744653.png" class="">

<p>添加一条记录</p>
<img src="/2019/05/18/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Python/%E5%9F%BA%E4%BA%8EVue%E5%92%8CDjango%E6%90%AD%E5%BB%BA%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE/IMG-20250804110744706.png" class="">

<p>至此,大功告成!</p>
<p>此份指南在配置的过程踩过不少坑,以下是踩的印象较深的坑.</p>
<p>1.数据库创建的过程中务必注意大小写的问题,数据库字段和Django的Models页面,View页面和Vue中的组件页面都有关联.很容易一个大小写不注意,导致整个接口无法使用.</p>
<p>2.连接MySQL需要按照对应的包,同时需要在根目录的_ini_.py中引入pymysql</p>
<p>3.在整个环境的搭建过程中VUE环境的搭建需要耗费较长的npm安装时间,需要耐心等待.</p>
<p>4.前后台连接需要在前端引入vue-resource,Django需要引入django-cors-headers</p>
<blockquote>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/ucloud">大U的技术课堂</a> 的新年第一课，祝大家新的一年好好学习，天天向上：）</p>
<p>本篇将手把手教你如何快速而优雅的构建<strong>前后端分离的项目</strong>，想直接上手请往后翻！</p>
</blockquote>
<p><strong>目录：</strong></p>
<ol>
<li><p>我为什么要选择Django与VueJS？</p>
</li>
<li><p>Django和VueJS是如何结合起来的？</p>
</li>
<li><p>实操</p>
</li>
<li><p>创建 Django 项目</p>
</li>
<li><p>创建 Django App 做为后端</p>
</li>
<li><p>创建 VueJS 项目作为前端</p>
</li>
<li><p>使用 Webpack 处理前端代码</p>
</li>
<li><p>配置 Django 模板的搜索路径</p>
</li>
<li><p>配置 Django 静态文件搜索路径</p>
</li>
<li><p>开发环境</p>
</li>
<li><p>生产环境（部署到 UCloud）</p>
</li>
</ol>
<p><strong>正文：</strong></p>
<h2 id="我为什么要选择Django与VueJS？"><a href="#我为什么要选择Django与VueJS？" class="headerlink" title="我为什么要选择Django与VueJS？"></a>我为什么要选择Django与VueJS？</h2><p>首先介绍一下我看重的点：</p>
<p>Django (MVC框架) - <a href="https://link.zhihu.com/?target=https://www.djangoproject.com/">The Web framework for perfectionists with deadlines</a></p>
<ul>
<li><p>Python  </p>
</li>
<li><p>ORM</p>
</li>
<li><p>简单、清晰的配置</p>
</li>
<li><p>Admin app</p>
</li>
</ul>
<p>Django 仅因为 Python 的血统，就已经站在了巨人的肩膀上，配置管理( SaltStack、Ansible )<br>，数据分析( Pandas )，任务队列( Celery )，Restful API( <a href="https://link.zhihu.com/?target=http://www.django-rest-framework.org/">Django REST framework</a> )，HTTP请求( requests )，再加上高度抽象的ORM，功能强大的 Query Expressions，简单清晰的配置，着重提一下堪称神器的自带App: Admin，有了它你再也不用将一些经常变化的配置写在文件里面，每次增删改都重新发布一次，你只需要定义出配置的 data scheme ，只需要几行代码，Django Admin便为你提供美观，并带有权限控制的增删改查界面，而且可以通过ORM为它生成的API来做到定制化的更新，比如直接读某个wiki上的配置，自动的写入数据库，伪代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">settings = pd.read_html(&#x27;http://某个gitlab的README 或者 某个redmine wiki&#x27;)</span><br><span class="line">settings = clean(settings)</span><br><span class="line">update(settings)</span><br></pre></td></tr></table></figure>

<p>最后还可以使用 django-celery 的 celery-beat 按 Interval&#x2F;crontab 的方式扔更新配置的任务到 celery 队列里面，最最重要的是，这些都可以在Django Admin后台直接配置哦，还不够优雅？请联系我</p>
<p>VueJS (MVVM框架) - <a href="https://link.zhihu.com/?target=https://vuejs.org/">Vue.js</a></p>
<ul>
<li>数据双向绑定</li>
<li>单文件组件</li>
<li>清晰的生命周期</li>
<li>学习曲线平滑</li>
<li>vue-cli</li>
</ul>
<blockquote>
<p>前端是DevOps的弱项，我需要一个 MVVM 框架来提升交互和节约时间，在试过 AngularJS ，ReactJS，VueJS之后我选择了VueJS，因为我觉得写 VueJS 代码的感觉最接近写 Python</p>
</blockquote>
<p>着重提一下单文件组件：</p>
<p><img src="https://pic2.zhimg.com/v2-ce179dca92761a76652a1a91290c4a59_b.png"></p>
<p>特别清晰，一个文件包含且仅包含三块</p>
<ol>
<li><template></template > 前端渲染的模板</li>
<li>专为此模板写渲染逻辑的 <script></script></li>
<li>专为此模板写样式的 <style></style></li>
</ol>
<p>这样可以达到什么效果呢？一个文件一个组件，每个组件有它自己的逻辑与样式，你不用关心什么 local 什么 global ，CSS样式加载先后、覆盖问题，因为它是『闭包』的，而且『自给自足』，不知道这样说好不好理解</p>
<p>当然组件之间也是可以通信的，举个例子，我有一个组件叫 ListULB ，使用表格展示了我拥有的所有 ULB (负载均衡)，ListULB 做了一件事，从 API 获取 ULB 对象列表并 for 循环展现出来， ListULB 可以放到某个页面里，可以放到弹框里，放到模态框里，任何地方都可以，因为这个组件对外交互的只有API</p>
<p>如果我现在要写一个组件叫 AddVServer ，功能是可以为任意一个 ULB 对象添加VServer，我的写法是将在 AddVServer 组件创建的时候，将 ULB 对象传给 AddVServer 组件，这样AddVServer 组件拿到这个对象，就可以直接根据对象的ID等，创建出当前行的ULB的VServer了，伪代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ListULB&gt;</span><br><span class="line">  for **ulb_object** in ulbs_list:</span><br><span class="line">    &#123;&#123; ulb_object.name &#125;&#125;</span><br><span class="line">    &#123;&#123; ulb_object.id &#125;&#125;</span><br><span class="line">    &lt;AddVServer :current_ulb=&#x27;**ulb_object**&#x27;&gt;&lt;/AddVServer&gt;</span><br><span class="line">&lt;/ListULB&gt;</span><br></pre></td></tr></table></figure>

<p>注意双星号包着的对象，在 ListULB 组件里面是每行的ULB，传给AddServer组件之后，变成了 current_ulb 对象，拿到id为 current_ulb.id 尽情的为它创建 VServer 吧</p>
<p>如果我要为指定 VServer 创建 RServer 呢，一样的</p>
<blockquote>
<p>看出来了吧，进行开发之前，前端组件的结构与数据的结构对应起来可以省好多时间，数据驱动前端组件，棒吗？</p>
</blockquote>
<p>谁不喜欢优雅的代码呢， 『Data drive everything』 多么的省脑细胞</p>
<p>以上就是我选择Python与VueJS的原因</p>
<h2 id="Django与VueJS是如何结合起来？"><a href="#Django与VueJS是如何结合起来？" class="headerlink" title="Django与VueJS是如何结合起来？"></a>Django与VueJS是如何结合起来？</h2><ul>
<li>首先我选择了VueJS的前端渲染，自然放弃了Django的后端模板引擎渲染</li>
<li>然后业务逻辑放到了前端，放弃了Django的View（其实也就是前后端分离必要的条件）</li>
<li>保留了Django的 Controller (URLconf) 来实现前端路由的父级路由，可以达到不同页面使用不同的前端框架， 页面内部使用各自独有的前端路由的效果，万一老大给你配了前端呢，万一前端只想写 ReactJS 呢</li>
<li>保留了Django的 Model ，前面说了Django的ORM太好用了，而且可以配合Django Admin</li>
</ul>
<p>所以综合来说就是:</p>
<blockquote>
<p>M(Django) + C(Django) + MVVM (VueJS) &#x3D; <em>M + MVVM + C &#x3D; MMVVMC</em></p>
</blockquote>
<p>（为了容易理解，并没有使用Django自称的MTV模式理解，感兴趣看看我画的图）</p>
<p><img src="https://pic1.zhimg.com/v2-d2a826bf7ef379eea16a6ac56971ce34_b.png"></p>
<p>总结：作为以改变世界为己任的 DevOps ，MVC框架后端渲染的柔弱表现力与繁杂的交互已经不能满足我们了，…..省略1000子…..，所以我选择这样构建项目，嗯…</p>
<p>好吧，也该开始了</p>
<p>代码块中的修改都会用爽星号括起来，比如: **changed**</p>
<p>本文为了精简篇幅，默认您已经安装了必要的 命令行界面（CLI），比如 vue-cli等</p>
<h2 id="1-创建Django项目"><a href="#1-创建Django项目" class="headerlink" title="1. 创建Django项目"></a>1. 创建Django项目</h2><p><img src="https://pic4.zhimg.com/v2-0b8ed26d48a1ad0b412cec59aeb3db03_b.png"></p>
<p><em>命令：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject ulb_manager</span><br></pre></td></tr></table></figure>

<p><em>结构：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── manage.py</span><br><span class="line">└── ulb_manager</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── settings.py</span><br><span class="line">    ├── urls.py</span><br><span class="line">    └── wsgi.py</span><br></pre></td></tr></table></figure>

<h2 id="2-进入项目根目录，创建一个-app-作为项目后端"><a href="#2-进入项目根目录，创建一个-app-作为项目后端" class="headerlink" title="2. 进入项目根目录，创建一个 app 作为项目后端"></a>2. 进入项目根目录，创建一个 app 作为项目后端</h2><p><em>命令：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ulb_manager</span><br><span class="line">python manage.py startapp backend</span><br></pre></td></tr></table></figure>

<p>即：app 名叫做 backend</p>
<p><em>结构：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── backend</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── admin.py</span><br><span class="line">│   ├── migrations</span><br><span class="line">│   │   └── __init__.py</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   ├── tests.py</span><br><span class="line">│   └── views.py</span><br><span class="line">├── manage.py</span><br><span class="line">└── ulb_manager</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── settings.py</span><br><span class="line">    ├── urls.py</span><br><span class="line">    └── wsgi.py</span><br></pre></td></tr></table></figure>

<h2 id="3-使用vue-cli创建一个vuejs项目作为项目前端"><a href="#3-使用vue-cli创建一个vuejs项目作为项目前端" class="headerlink" title="3. 使用vue-cli创建一个vuejs项目作为项目前端"></a>3. 使用vue-cli创建一个vuejs项目作为项目前端</h2><p><img src="https://pic1.zhimg.com/v2-df081aadcb6c5b35b7ae28253875d5a8_b.png"></p>
<p><em>命令：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue-init webpack frontend</span><br></pre></td></tr></table></figure>

<p>即：项目名叫 frontend</p>
<p><em>结构：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── backend</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── admin.py</span><br><span class="line">│   ├── migrations</span><br><span class="line">│   │   └── __init__.py</span><br><span class="line">│   ├── models.py</span><br><span class="line">│   ├── tests.py</span><br><span class="line">│   └── views.py</span><br><span class="line">├── frontend</span><br><span class="line">│   ├── README.md</span><br><span class="line">│   ├── build</span><br><span class="line">│   │   └── ....</span><br><span class="line">│   ├── config</span><br><span class="line">│   │   ├── dev.env.js</span><br><span class="line">│   │   ├── index.js</span><br><span class="line">│   │   ├── prod.env.js</span><br><span class="line">│   │   └── test.env.js</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── package.json</span><br><span class="line">│   ├── src</span><br><span class="line">│   │   ├── App.vue</span><br><span class="line">│   │   ├── assets</span><br><span class="line">│   │   │   └── logo.png</span><br><span class="line">│   │   ├── components</span><br><span class="line">│   │   │   └── Hello.vue</span><br><span class="line">│   │   └── main.js</span><br><span class="line">│   ├── static</span><br><span class="line">│   └── test</span><br><span class="line">│       └── ...</span><br><span class="line">├── manage.py</span><br><span class="line">└── ulb_manager</span><br><span class="line">    ├── __init__.py</span><br><span class="line">    ├── settings.py</span><br><span class="line">    ├── urls.py</span><br><span class="line">    └── wsgi.py</span><br></pre></td></tr></table></figure>

<p><em>结构总结：</em></p>
<p>可以看到项目根目录有两个新文件夹，一个叫 backend ，一个叫 frontend，分别是：</p>
<ul>
<li>backend Django的一个app</li>
<li>frontend Vuejs项目</li>
</ul>
<h2 id="4-接下来我们使用-webpack-打包Vusjs项目"><a href="#4-接下来我们使用-webpack-打包Vusjs项目" class="headerlink" title="4. 接下来我们使用 webpack 打包Vusjs项目"></a>4. 接下来我们使用 webpack 打包Vusjs项目</h2><p><img src="https://pic4.zhimg.com/v2-c069d74a266268d832397a933cb6055b_b.png"></p>
<p><em>命令：</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd frontend</span><br><span class="line">npm install</span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<p><em>结构：</em></p>
<p><em>我引入了一些包，比如element-ui等，你的static里面的内容会不同，没关系 index.html 和 static 文件夹相同就够了</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dist</span><br><span class="line">├── index.html</span><br><span class="line">└── static</span><br><span class="line">    ├── css</span><br><span class="line">    │   ├── app.42b821a6fd065652cb86e2af5bf3b5d2.css</span><br><span class="line">    │   └── app.42b821a6fd065652cb86e2af5bf3b5d2.css.map</span><br><span class="line">    ├── fonts</span><br><span class="line">    │   ├── element-icons.a61be9c.eot</span><br><span class="line">    │   └── element-icons.b02bdc1.ttf</span><br><span class="line">    ├── img</span><br><span class="line">    │   └── element-icons.09162bc.svg</span><br><span class="line">    └── js</span><br><span class="line">        ├── 0.8750b01fa7ffd70f7ba6.js</span><br><span class="line">        ├── vendor.804853a3a7c622c4cb5b.js</span><br><span class="line">        └── vendor.804853a3a7c622c4cb5b.js.map</span><br></pre></td></tr></table></figure>

<p>构建完成会生成一个 文件夹名字叫dist，里面有一个 index.html 和一个 文件夹static ，</p>
<h2 id="5-使用Django的通用视图-TemplateView"><a href="#5-使用Django的通用视图-TemplateView" class="headerlink" title="5. 使用Django的通用视图 TemplateView"></a>5. 使用Django的通用视图 TemplateView</h2><p>找到项目根 urls.py (即ulb_manager&#x2F;urls.py)，使用通用视图创建最简单的模板控制器，访问 『&#x2F;』时直接返回 index.html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&#x27;^admin/&#x27;, admin.site.urls),</span><br><span class="line">    **url(r&#x27;^$&#x27;, TemplateView.as_view(template_name=&quot;index.html&quot;)),**</span><br><span class="line">    url(r&#x27;^api/&#x27;, include(&#x27;backend.urls&#x27;, namespace=&#x27;api&#x27;))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="6-配置Django项目的模板搜索路径"><a href="#6-配置Django项目的模板搜索路径" class="headerlink" title="6. 配置Django项目的模板搜索路径"></a>6. 配置Django项目的模板搜索路径</h2><p>上一步使用了Django的模板系统，所以需要配置一下模板使Django知道从哪里找到index.html</p>
<p>打开 settings.py (ulb_manager&#x2F;settings.py)，找到TEMPLATES配置项，修改如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        &#x27;BACKEND&#x27;: &#x27;django.template.backends.django.DjangoTemplates&#x27;,</span><br><span class="line">        # &#x27;DIRS&#x27;: [],</span><br><span class="line">        **&#x27;DIRS&#x27;: [&#x27;frontend/dist&#x27;]**,</span><br><span class="line">        &#x27;APP_DIRS&#x27;: True,</span><br><span class="line">        &#x27;OPTIONS&#x27;: &#123;</span><br><span class="line">            &#x27;context_processors&#x27;: [</span><br><span class="line">                &#x27;django.template.context_processors.debug&#x27;,</span><br><span class="line">                &#x27;django.template.context_processors.request&#x27;,</span><br><span class="line">                &#x27;django.contrib.auth.context_processors.auth&#x27;,</span><br><span class="line">                &#x27;django.contrib.messages.context_processors.messages&#x27;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注意这里的 frontend 是VueJS项目目录，dist则是运行 npm run build 构建出的index.html与静态文件夹 static 的父级目录</p>
<p>这时启动Django项目，访问 &#x2F; 则可以访问index.html，但是还有问题，静态文件都是404错误，下一步我们解决这个问题</p>
<h2 id="7-配置静态文件搜索路径"><a href="#7-配置静态文件搜索路径" class="headerlink" title="7. 配置静态文件搜索路径"></a>7. 配置静态文件搜索路径</h2><p>打开 settings.py (ulb_manager&#x2F;settings.py)，找到 STATICFILES_DIRS 配置项，配置如下:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Add for vuejs</span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, &quot;frontend/dist/static&quot;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>这样Django不仅可以将&#x2F;ulb 映射到index.html，而且还可以顺利找到静态文件  </p>
<p>此时访问 &#x2F;ulb 我们可以看到使用Django作为后端的VueJS helloworld</p>
<p>ALL DONE.</p>
<h2 id="8-开发环境"><a href="#8-开发环境" class="headerlink" title="8. 开发环境"></a>8. 开发环境</h2><p>因为我们使用了Django作为后端，每次修改了前端之后都要重新构建（你可以理解为不编译不能运行）</p>
<p>除了使用Django作为后端，我们还可以在dist目录下面运行以下命令来看效果：</p>
<p><img src="https://pic3.zhimg.com/v2-63bb75e8e032b4a9331b67fe4f38ffa6_b.png"></p>
<p>但是问题依然没有解决，我想过检测文件变化来自动构建，但是构建是秒级的，太慢了，所以我直接使用VueJS的开发环境来调试</p>
<p><img src="https://pic4.zhimg.com/v2-9eb17d07a276d968e24dd13d39b6da73_b.png"></p>
<p>毫秒，但是有个新问题，使用VueJS的开发环境脱离了Django环境，访问Django写的API，出现了跨域问题，有两种方法解决，一种是在VueJS层上做转发（proxyTable），另一种是在Django层注入header，这里我使用后者，用Django的第三方包 django-cors-headers 来解决跨域问题</p>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-cors-headers</span><br></pre></td></tr></table></figure>

<p>配置（两步）</p>
<p>1. settings.py 修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    &#x27;django.middleware.security.SecurityMiddleware&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;,</span><br><span class="line">    **&#x27;corsheaders.middleware.CorsMiddleware&#x27;,**</span><br><span class="line">    &#x27;django.middleware.common.CommonMiddleware&#x27;,</span><br><span class="line">    &#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;,</span><br><span class="line">    &#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>这里要注意中间件加载顺序，列表是有序的哦</p>
<p>2. settings.py 添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CORS_ORIGIN_ALLOW_ALL = True</span><br></pre></td></tr></table></figure>

<p>至此，我的开发环境就搭建完成了</p>
<h2 id="9-生产环境部署（部署到-UCloud-）"><a href="#9-生产环境部署（部署到-UCloud-）" class="headerlink" title="9. 生产环境部署（部署到 UCloud ）"></a>9. 生产环境部署（部署到 UCloud ）</h2><p>9.1 创建主机</p>
<ol>
<li>注册 <a href="https://link.zhihu.com/?target=https://ucloud.cn/">UCloud - 专业云计算服务商</a></li>
<li>点击左侧的 云主机，然后点击 创建主机</li>
<li>右侧选择 付费方式，点击 立即购买</li>
<li>在支付确认页面，点击 确认支付</li>
</ol>
<p>购买成功后回到主机管理列表，如下所示：  </p>
<p><img src="https://pic4.zhimg.com/v2-5d91cf1a36574fb6ea9de229bffc8b4b_b.png"></p>
<blockquote>
<p>这里注意记住你的外网IP，下面的ip替换成你的  </p>
</blockquote>
<p>9.2 环境搭建与部署</p>
<p>登录主机，用你刚填写的密码：</p>
<blockquote>
<p>ssh <a href="mailto:&#114;&#x6f;&#x6f;&#116;&#x40;&#x31;&#50;&#48;&#46;&#x31;&#51;&#x32;">&#114;&#x6f;&#x6f;&#116;&#x40;&#x31;&#50;&#48;&#46;&#x31;&#51;&#x32;</a>.**.75</p>
</blockquote>
<p>CentOS 系统可以使用 yum 安装必要的包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 如果你使用git来托管代码的话</span><br><span class="line">yum install git</span><br><span class="line"></span><br><span class="line"># 如果你要在服务器上构建前端</span><br><span class="line">yum install nodejs</span><br><span class="line">yum install npm</span><br><span class="line"></span><br><span class="line">yum install nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我们使用 uwsgi 来处理 Django 请求，使用 nginx 处理 static 文件（即之前 build 之后 dist 里面的static，这里默认前端已经打包好了，如果在服务端打包前端需要安装nodejs，npm等）</p>
</blockquote>
<p>安装uWsgi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install uwsgi</span><br><span class="line"># 或者</span><br><span class="line">pip install uwsgi</span><br></pre></td></tr></table></figure>

<p>我们使用配置文件启动uwsgi，比较清楚</p>
<p>uwsgi配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">socket = 127.0.0.1:9292</span><br><span class="line">stats = 127.0.0.1:9293</span><br><span class="line">workers = 4</span><br><span class="line"># 项目根目录</span><br><span class="line">chdir = /opt/inner_ulb_manager</span><br><span class="line">touch-reload = /opt/inner_ulb_manager</span><br><span class="line">py-auto-reload = 1</span><br><span class="line"># 在项目跟目录和项目同名的文件夹里面的一个文件</span><br><span class="line">module= inner_ulb_manager.wsgi</span><br><span class="line">pidfile = /var/run/inner_ulb_manager.pid</span><br><span class="line">daemonize = /var/log/inner_ulb_manager.log</span><br></pre></td></tr></table></figure>

<p>nginx 配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 8888;</span><br><span class="line">    server_name 120.132.**.75;</span><br><span class="line">    root /opt/inner_ulb_manager;</span><br><span class="line">    access_log /var/log/nginx/access_narwhals.log;</span><br><span class="line">    error_log /var/log/nginx/error_narwhals.log;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">            uwsgi_pass 127.0.0.1:9292;</span><br><span class="line">            include /etc/nginx/uwsgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">    location /static/ &#123;</span><br><span class="line">            root  /opt/inner_ulb_manager/;</span><br><span class="line">            access_log off;</span><br><span class="line">    &#125;</span><br><span class="line">    location ^~ /admin/ &#123;</span><br><span class="line">            uwsgi_pass 127.0.0.1:9292;</span><br><span class="line">            include /etc/nginx/uwsgi_params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&#x2F;opt&#x2F;inner_ulb_manager&#x2F;static 即为静态文件目录，那么现在我们静态文件还在 frontend&#x2F;dist 怎么办，不怕，Django给我们提供了命令：</p>
<p>先去settings里面配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, &quot;static&quot;)</span><br></pre></td></tr></table></figure>

<p>然后在存在manage.py的目录，即项目跟目录执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py collectstatic</span><br></pre></td></tr></table></figure>

<p>这样frontend&#x2F;dist&#x2F;static里面的东西就到了项目根目录的static文件夹里面了</p>
<p>那么为什么不直接手动把构建好的dist&#x2F;static拷过来呢，因为开始提过Django自带的App：admin 也有一些静态文件（css,js等），它会一并collect过来，毕竟nginx只认项目跟目录的静态文件，它不知道django把它自己的需求文件放到哪了</p>
<p>开头说过Django配置灵活，那么我们专门为Django创建一个生产环境的配置 prod.py  </p>
<p>prod.py 与 默认 settings.py 同目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 导入公共配置</span><br><span class="line">from .settings import *</span><br><span class="line"></span><br><span class="line"># 生产环境关闭DEBUG模式</span><br><span class="line">DEBUG = False</span><br><span class="line"></span><br><span class="line"># 生产环境开启跨域</span><br><span class="line">CORS_ORIGIN_ALLOW_ALL = False</span><br><span class="line"></span><br><span class="line"># 特别说明，下面这个不需要，因为前端是VueJS构建的，它默认使用static作为静态文件入口，我们nginx配置static为入口即可，保持一致，没Django什么事</span><br><span class="line">STATIC_URL = &#x27;/static/&#x27;</span><br></pre></td></tr></table></figure>

<p>如何使用这个配置呢，进入 wisg.py 即uwsgi配置里面的module配置修改为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">from django.core.wsgi import get_wsgi_application</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;**inner_ulb_manager.prod**&quot;)</span><br><span class="line"></span><br><span class="line">application = get_wsgi_application()</span><br></pre></td></tr></table></figure>

<p>启动uwsgi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --ini inner_ulb_manager.ini</span><br></pre></td></tr></table></figure>

<p>启动ngingx</p>
<p>至此，部署就完成了</p>
<h2 id="10-效果图"><a href="#10-效果图" class="headerlink" title="10. 效果图"></a>10. 效果图</h2><p>List 组件：</p>
<p><img src="https://pic4.zhimg.com/v2-65889a6f9431124be7b1359ba179e9b3_b.png"></p>
<blockquote>
<p><em>传单个 ULB 对象给 Detail 组件使用即可</em></p>
</blockquote>
<p>Detail 组件：</p>
<p><img src="https://pic2.zhimg.com/v2-705538ffd2da07562b42a5e256838e29_b.png"></p>
<blockquote>
<p><em>当然里面还实现了前面提到的 ULB 的 VServer 创建，VServer 的 RServer 的创建等。</em></p>
</blockquote>
<p>————————</p>
<p>本文由『<strong>UCloud平台产品研发团队</strong>』提供。</p>
<p>项目源码文件戳下面链接查看，大家可以马上拿源码上手试起来，操作过程中遇到问题也可直接在github上留言：）<a href="https://link.zhihu.com/?target=https://github.com/tmpbook/django-with-vuejs">https://github.com/tmpbook/django-with-vuejs</a></p>
<p>现在注册使用UCloud，还免费试用 及 首充返现优惠，最高可返3000元代金券！活动传送门：<a href="https://link.zhihu.com/?target=https://www.ucloud.cn/site/active/gift.html">用UCloud！3000元限量版礼盒等你来拆！</a></p>
<p>另，欢迎添加UCloud运营小妹个人微信号：Surdur，陪聊很专业：）</p>
<p><img src="https://pic3.zhimg.com/v2-d9f126c84351c1bb089dda34b630523e_b.jpg"></p>
<blockquote>
<p><strong>关于作者：</strong></p>
<p>星辰（<a target="_blank" rel="noopener" href="https://www.zhihu.com/people/tmpbook/activities">@星辰</a>）， UCloud平台产品研发工程师，DevOps一枚。你也可以去他的知乎专栏 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/heart-devops">《随心DevOps》</a> 上逛逛，干货满满，带你更优雅的改变世界。</p>
</blockquote>
<h2 id="相关阅读推荐："><a href="#相关阅读推荐：" class="headerlink" title="相关阅读推荐："></a>相关阅读推荐：</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/24899387">机器学习进阶笔记之八 | TensorFlow与中文手写汉字识别</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/23938423">机器学习进阶笔记之七 | MXnet初体验</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/23651687">机器学习进阶笔记之六 | 深入理解Fast Neural Style</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/23518167">机器学习进阶笔记之五 | 深入理解VGG\Residual Network</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/22817228">机器学习进阶笔记之四 | 深入理解GoogLeNet</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/22659166">机器学习进阶笔记之三 | 深入理解Alexnet</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/22493132">机器学习进阶笔记之二 | 深入理解Neural Style</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/22410917">机器学习进阶笔记之一 | TensorFlow安装与入门</a></p>
<p>「UCloud机构号」将独家分享云计算领域的技术洞见、行业资讯以及一切你想知道的相关讯息。</p>
<p>欢迎提问&amp;求关注 o(*&#x2F;&#x2F;&#x2F;&#x2F;▽&#x2F;&#x2F;&#x2F;&#x2F;*)q～</p>
<p>以上。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/05/11/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Javascript/Nodejs%E6%B8%85%E7%90%86%E6%97%A0%E7%94%A8%E4%BE%9D%E8%B5%96%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/05/11/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Javascript/Nodejs%E6%B8%85%E7%90%86%E6%97%A0%E7%94%A8%E4%BE%9D%E8%B5%96%E5%8C%85/" class="post-title-link" itemprop="url">Nodejs清理无用依赖包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-05-11 00:00:00" itemprop="dateCreated datePublished" datetime="2019-05-11T00:00:00+08:00">2019-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:24" itemprop="dateModified" datetime="2025-09-09T08:40:24+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">编程技术</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E6%9C%AF/Javascript/" itemprop="url" rel="index"><span itemprop="name">Javascript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>npm-check</p>
<p> npm-check 是一个检查依赖包是否存在过期、不正确、未使用等情况的工具。</p>
<p> 全局安装：</p>
<blockquote>
<p>npm  install  -g  npm-check</p>
</blockquote>
<p> 使用：</p>
<blockquote>
<p>npm-check</p>
</blockquote>
<p>上述指令会自动检查当前目录下的依赖包情况。</p>
<p> 这里我们重点关注下未使用的依赖包。npm-check 在检查依赖包是否使用时判断的依据是文件中是否存在 require（package） 这条语句，例如：</p>
<blockquote>
<p>const lodash &#x3D; require(‘lodash’);</p>
</blockquote>
<p>只要存在这条语句，即使我并未在其它任何地方使用（也就是说这是个无用的包），但是 npm-check 是不会将其判定为未使用的。</p>
<p> ESLint</p>
<p>为了解决上述存在的这种情况，我们可以借助 ESLint 先去检查代码是否存在未使用的变量（no-unused-vars），这样就可以检查某个包 require 了但并未在后续使用的情况。</p>
<p>全局安装：</p>
<blockquote>
<p>npm install -g eslint</p>
</blockquote>
<p>编写 .eslintrc.js 配置文件：</p>
<p> <img src="https://images2018.cnblogs.com/blog/1211559/201808/1211559-20180821151852625-130510713.jpg"></p>
<blockquote>
<p>eslint  –config  .eslintrc.js  .&#x2F;</p>
</blockquote>
<p>执行上述指令便会检查当前目录下的所有代码是否存在定义了但未使用的变量。删除掉未使用的变量（包含对依赖包的引用）之后，再运行 npm-check 便能正确的找出那些在项目中已不再使用的依赖包了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://chengming0916.github.io/2019/04/12/Git/Git%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Chemmy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Chemmy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/04/12/Git/Git%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Git配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-04-12 14:19:37" itemprop="dateCreated datePublished" datetime="2019-04-12T14:19:37+08:00">2019-04-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-09-09 08:40:23" itemprop="dateModified" datetime="2025-09-09T08:40:23+08:00">2025-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="配置用户信息"><a href="#配置用户信息" class="headerlink" title="配置用户信息"></a>配置用户信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#配置用户名和邮箱</span></span><br><span class="line">git config --global user.name </span><br><span class="line">git config --global user.email</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="配置编码"><a href="#配置编码" class="headerlink" title="配置编码"></a>配置编码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#中文路径和文件名乱码</span></span><br><span class="line">git config --global core.quotePath <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改commit编码方式</span></span><br><span class="line">git config --global i18n.commitEncoding utf-8</span><br><span class="line">git config --global i18n.logOutputEncoding</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="配置内网域名证书"><a href="#配置内网域名证书" class="headerlink" title="配置内网域名证书"></a>配置内网域名证书</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.<span class="string">&quot;内网域名&quot;</span>.sslCAInfo <span class="string">&quot;证书所在路径&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line">git config --global http.<span class="string">&quot;https://example.io&quot;</span>.sslCAInfo ~/.certs/selfsigned-root-ca.crt</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/14/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/16/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2015 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Chemmy</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="giscus" type="application/json">{"enable":true,"repo":"chengming0916/chengming0916.github.io","repo_id":"R_kgDOLemcag","category":"Announcements","category_id":"DIC_kwDOLemcas4CupMn","mapping":"title","strict":0,"reactions_enabled":1,"emit_metadata":1,"theme":"light","lang":"zh-CN","crossorigin":"anonymous","input_position":"bottom","loading":"lazy"}</script>

<script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.page.comments) return;

  NexT.utils.loadComments('.giscus-container')
    .then(() => NexT.utils.getScript('https://giscus.app/client.js', {
      attributes: {
        async                   : true,
        crossOrigin             : 'anonymous',
        'data-repo'             : CONFIG.giscus.repo,
        'data-repo-id'          : CONFIG.giscus.repo_id,
        'data-category'         : CONFIG.giscus.category,
        'data-category-id'      : CONFIG.giscus.category_id,
        'data-mapping'          : CONFIG.giscus.mapping,
        'data-strict'           : CONFIG.giscus.strict,
        'data-reactions-enabled': CONFIG.giscus.reactions_enabled,
        'data-emit-metadata'    : CONFIG.giscus.emit_metadata,
        'data-theme'            : CONFIG.giscus.theme,
        'data-lang'             : CONFIG.giscus.lang,
        'data-input-position'   : CONFIG.giscus.input_position,
        'data-loading'          : CONFIG.giscus.loading
      },
      parentNode: document.querySelector('.giscus-container')
    }));
});
</script>

</body>
</html>
